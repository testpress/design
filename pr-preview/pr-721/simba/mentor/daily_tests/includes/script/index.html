<script src="https://preline.co/assets/vendor/lodash/lodash.min.js"></script>
<script src="https://preline.co/assets/vendor/vanilla-calendar-pro/index.js"></script>
<script src="https://preline.co/assets/vendor/@floating-ui/core/dist/floating-ui.core.umd.min.js"></script>
<script src="https://preline.co/assets/vendor/@floating-ui/dom/dist/floating-ui.dom.umd.min.js"></script>
<script src="https://preline.co/assets/vendor/preline/dist/index.js?v=3.0.1"></script>
<script>
  window.addEventListener('load', () => requestAnimationFrame(() => {
    const datepickerInstance = HSDatepicker.getInstance('#hs-pro-vcead', true);
    const element = datepickerInstance.element;
    const vanillaCalendar = element.vanillaCalendar;
    const todayBtn = document.querySelector('#hs-pro-vcead-today');
    const prevBtn = document.querySelector('#hs-pro-vcead-prev');
    const nextBtn = document.querySelector('#hs-pro-vcead-next');
    const getCurrentDate = () => {
      const currentState = element.getCurrentState();

      if (currentState.selectedDates && currentState.selectedDates.length > 0) {
        const dateStr = currentState.selectedDates[0];

        if (dateStr === 'today') {
          return new Date();
        }

        const date = new Date(dateStr);

        if (!isNaN(date.getTime())) {
          return date;
        }
      }

      return new Date();
    };
    const formatDate = (date) => {
      if (!date || isNaN(date.getTime())) {
        return new Date().toISOString().split('T')[0];
      }

      return date.toISOString().split('T')[0];
    };
    const updateDate = (selectedDates) => {
      vanillaCalendar.set({ selectedDates: selectedDates });

      const inputElement = document.querySelector('#hs-pro-vcead');

      if (inputElement && selectedDates.length > 0) {
        const dateStr = selectedDates[0];

        if (dateStr === 'today') {
          const today = new Date();

          inputElement.value = 'Today, ' + today.getDate() + ' ' +
            today.toLocaleDateString('en-US', { month: 'long' }) + ' ' + today.getFullYear();
        } else {
          const date = new Date(dateStr);
          const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
          const day = date.getDate();
          const month = date.toLocaleDateString('en-US', { month: 'long' });
          const year = date.getFullYear();
          inputElement.value = `${dayName}, ${day} ${month} ${year}`;
        }
      }

      const changeEvent = new CustomEvent('change', {
        detail: {
          selectedDates: selectedDates,
          selectedTime: vanillaCalendar.context.selectedTime,
          rest: vanillaCalendar.context
        }
      });

      inputElement.dispatchEvent(changeEvent);
    };

    todayBtn.addEventListener('click', () => {
      updateDate(['today']);
    });

    prevBtn.addEventListener('click', () => {
      const currentDate = getCurrentDate();

      currentDate.setDate(currentDate.getDate() - 1);

      const prevDate = formatDate(currentDate);

      updateDate([prevDate]);
    });

    nextBtn.addEventListener('click', () => {
      const currentDate = getCurrentDate();

      currentDate.setDate(currentDate.getDate() + 1);

      const nextDate = formatDate(currentDate);

      updateDate([nextDate]);
    });
  }));
</script>