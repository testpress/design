<form method="POST" class="mt-4 space-y-6" x-data="{
  recurringMeeting:true,
  recurrence:'2',
  endCondition:'no_end',
  advancedOpen:false,
  showPreview:false,
  currentStep: 1, // 1 = form creation, 2 = preview
  formData: {},
  sessionPreview: [],
  suffixType: 'number', // 'number', 'date', 'both'
  
  captureFormData() {
    this.formData = {
      title: this.$refs.titleInput?.value || '',
      suffixType: this.suffixType,
      duration: this.$refs.durationInput?.value || '60',
      startDate: this.$refs.startDateInput?.value || '',
      startTime: this.$refs.startTimeInput?.value || '',
      selectedDays: Array.from(document.querySelectorAll('input[name=\'days[]\']')).filter(cb => cb.checked).map(cb => cb.nextElementSibling.textContent.trim()),
      endByDateValue: this.$refs.endByDateInput?.value || '',
      endAfterValue: this.$refs.endAfterInput?.value || '',
      host: this.$refs.hostInput?.value || 'staff1',
    }
  },

  get formDataCurrent() {
    return {
      title: this.$refs.titleInput?.value || '',
      suffixType: this.suffixType,
      duration: this.$refs.durationInput?.value || '60',
      startDate: this.$refs.startDateInput?.value || '',
      startTime: this.$refs.startTimeInput?.value || '',
      selectedDays: Array.from(document.querySelectorAll('input[name=\'days[]\']')).filter(cb => cb.checked).map(cb => cb.nextElementSibling.textContent.trim()),
      endByDateValue: this.$refs.endByDateInput?.value || '',
      endAfterValue: this.$refs.endAfterInput?.value || '',
      host: this.$refs.hostInput?.value || 'staff1',
    }
  },

  get activeFormData() {
    return this.currentStep === 2 ? this.formData : this.formDataCurrent;
  },

  proceedToPreview() {
    this.captureFormData();
    this.sessionPreview = this.calculateNextSessions();
    this.currentStep = 2;
  },

  goBackToForm() {
    this.currentStep = 1;
  },
  
  get recurrenceText() {
    const patterns = {'1': 'Daily', '2': 'Weekly', '3': 'Monthly'};
    return patterns[this.recurrence] || 'Weekly';
  },
  
  get endConditionText() {
    if (this.endCondition === 'no_end') return 'No end date';
    if (this.endCondition === 'end_by_date') return `End by: ${this.activeFormData.endByDateValue || 'Not set'}`;
    if (this.endCondition === 'end_after') return `End after: ${this.activeFormData.endAfterValue || '0'} occurrences`;
    return 'No end date';
  },
  
  calculateNextSessions() {
    const sessions = [];
    const startDate = this.activeFormData.startDate;
    const startTime = this.activeFormData.startTime;
    
    if (!startDate || !startTime) {
      return [{
        number: 1,
        date: 'Complete start date and time to see sessions',
        time: 'TBD',
        title: this.activeFormData.title || 'Class Title'
      }];
    }
    
    try {
      const baseDate = new Date(startDate + 'T' + startTime);
      
      // Determine the maximum number of sessions to calculate
      let maxSessions = 14; // Default limit
      let endDate = null;
      
      // Set limits based on end condition
      if (this.endCondition === 'end_after' && this.activeFormData.endAfterValue) {
        maxSessions = Math.min(parseInt(this.activeFormData.endAfterValue), 14);
      } else if (this.endCondition === 'end_by_date' && this.activeFormData.endByDateValue) {
        endDate = new Date(this.activeFormData.endByDateValue + 'T23:59:59');
      }
      
      if (this.recurrence === '1') { // Daily
        let sessionCount = 0;
        let currentDate = new Date(baseDate);
        
        while (sessionCount < maxSessions) {
          // Check if we've passed the end date
          if (endDate && currentDate > endDate) break;
          
          sessions.push({
            number: sessionCount + 1,
            date: currentDate.toLocaleDateString('en-US', { 
              weekday: 'short', 
              year: 'numeric', 
              month: 'short', 
              day: 'numeric' 
            }),
            time: startTime,
            title: this.generateSessionTitle(this.activeFormData.title, sessionCount + 1, currentDate),
            dateObj: new Date(currentDate) // For sorting/comparison
          });
          
          sessionCount++;
          currentDate.setDate(currentDate.getDate() + 1);
        }
      } else if (this.recurrence === '2') { // Weekly
        const selectedDayNumbers = Array.from(document.querySelectorAll('input[name=\'days[]\']')).filter(cb => cb.checked).map(cb => parseInt(cb.value));
        
        if (selectedDayNumbers.length === 0) {
          return [{
            number: 1,
            date: 'Select days of the week first',
            time: startTime,
            title: this.activeFormData.title || 'Class Title'
          }];
        }
        
        let sessionCount = 0;
        let currentWeekStart = new Date(baseDate);
        currentWeekStart.setDate(currentWeekStart.getDate() - currentWeekStart.getDay()); // Go to Sunday of the week
        
        let weekOffset = 0;
        while (sessionCount < maxSessions) {
          let hasSessionThisWeek = false;
          
          for (let day of selectedDayNumbers.sort()) {
            if (sessionCount >= maxSessions) break;
            
            const sessionDate = new Date(currentWeekStart);
            sessionDate.setDate(currentWeekStart.getDate() + day + (weekOffset * 7));
            
            // Check if session is after start date and before end date (if set)
            if (sessionDate >= baseDate && (!endDate || sessionDate <= endDate)) {
              sessions.push({
                number: sessionCount + 1,
                date: sessionDate.toLocaleDateString('en-US', { 
                  weekday: 'short', 
                  year: 'numeric', 
                  month: 'short', 
                  day: 'numeric' 
                }),
                time: startTime,
                title: this.generateSessionTitle(this.activeFormData.title, sessionCount + 1, sessionDate),
                dateObj: new Date(sessionDate)
              });
              sessionCount++;
              hasSessionThisWeek = true;
            } else if (endDate && sessionDate > endDate) {
              // If we've passed the end date, stop calculating
              break;
            }
          }
          
          // If end date is set and no sessions were added this week, we might be past the end date
          if (endDate && !hasSessionThisWeek && weekOffset > 0) {
            break;
          }
          
          weekOffset++;
          
          // Safety check to prevent infinite loops
          if (weekOffset > 100) break;
        }
      } else if (this.recurrence === '3') { // Monthly
        let sessionCount = 0;
        let currentDate = new Date(baseDate);
        
        while (sessionCount < maxSessions) {
          // Check if we've passed the end date
          if (endDate && currentDate > endDate) break;
          
          sessions.push({
            number: sessionCount + 1,
            date: currentDate.toLocaleDateString('en-US', { 
              weekday: 'short', 
              year: 'numeric', 
              month: 'short', 
              day: 'numeric' 
            }),
            time: startTime,
            title: this.generateSessionTitle(this.activeFormData.title, sessionCount + 1, currentDate),
            dateObj: new Date(currentDate)
          });
          
          sessionCount++;
          currentDate.setMonth(currentDate.getMonth() + 1);
        }
      }
      
      return sessions.length > 0 ? sessions : [{
        number: 1,
        date: 'No sessions match the selected criteria',
        time: 'Please adjust your settings',
        title: this.activeFormData.title || 'Class Title'
      }];
    } catch (error) {
      return [{
        number: 1,
        date: 'Invalid date/time format',
        time: 'Please check your inputs',
        title: this.activeFormData.title || 'Class Title'
      }];
    }
  },

  generateSessionTitle(baseTitle, sessionNumber, sessionDate) {
    if (!baseTitle) return 'Class Title';
    
    const suffixType = this.activeFormData.suffixType || this.suffixType;
    const formattedDate = sessionDate.toLocaleDateString('en-US', { 
      month: '2-digit', 
      day: '2-digit', 
      year: 'numeric' 
    });
    
    switch (suffixType) {
      case 'number':
        return `${baseTitle} ${sessionNumber}`;
      case 'date':
        return `${baseTitle} on ${formattedDate}`;
      case 'both':
        return `${baseTitle} ${sessionNumber} on ${formattedDate}`;
      default:
        return `${baseTitle} ${sessionNumber}`;
    }
  }
}">
  
  <!-- Progress Indicator -->
  <div class="mb-8">
    <nav aria-label="Progress">
      <ol role="list" class="flex items-center">
        <li class="relative">
          <div class="flex items-center">
            <div :class="currentStep >= 1 ? 'bg-emerald-600 text-white' : 'bg-gray-200 text-gray-500'" class="flex h-8 w-8 items-center justify-center rounded-full text-sm font-medium">
              1
            </div>
            <span :class="currentStep >= 1 ? 'text-emerald-600 font-medium' : 'text-gray-500'" class="ml-3 text-sm">Create Series</span>
          </div>
        </li>
        <li class="relative ml-8">
          <div class="flex items-center">
            <div :class="currentStep >= 2 ? 'bg-emerald-600 text-white' : 'bg-gray-200 text-gray-500'" class="flex h-8 w-8 items-center justify-center rounded-full text-sm font-medium">
              2
            </div>
            <span :class="currentStep >= 2 ? 'text-emerald-600 font-medium' : 'text-gray-500'" class="ml-3 text-sm">Preview & Confirm</span>
          </div>
        </li>
      </ol>
    </nav>
  </div>

  <!-- Step 1: Form Creation -->
  <div x-show="currentStep === 1" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-x-4" x-transition:enter-end="opacity-100 transform translate-x-0" class="space-y-6">
  <!-- SECTION 1 - Basic Information -->
  <div class="bg-white shadow-sm border border-gray-200 rounded-lg">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-medium text-gray-900">Basic Information</h3>
    </div>
    <div class="px-6 py-6 space-y-6">
      <div class="grid grid-cols-1 gap-6">
        <div>
          <label for="title" class="block text-sm font-medium text-gray-900">
            Title <span class="text-red-500">*</span>
          </label>
          <div class="mt-2">
            <input type="text" name="title" id="title" x-ref="titleInput" required placeholder="Enter class title..." value="Weekly Mathematics Class" class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-emerald-600 sm:text-sm sm:leading-6" />
          </div>
        </div>

        <!-- Set Suffix Section -->
        <div>
          <label class="block text-sm font-medium text-gray-900 mb-3">
            Set Suffix
          </label>
          <p class="text-sm text-gray-600 mb-4">Choose how to differentiate individual class titles in your series. This helps distinguish between recurring sessions.</p>
          
          <div class="space-y-3">
            <div class="flex items-start">
              <input id="suffix_number" name="suffix_type" type="radio" value="number" x-model="suffixType" class="mt-1 h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300">
              <div class="ml-3">
                <label for="suffix_number" class="block text-sm font-medium text-gray-900">Number</label>
                <p class="text-sm text-gray-600">Adds sequential numbers to class titles</p>
                <p class="text-xs text-gray-500 mt-1">Example: "Weekly Mathematics Class 1", "Weekly Mathematics Class 2"</p>
              </div>
            </div>
            
            <div class="flex items-start">
              <input id="suffix_date" name="suffix_type" type="radio" value="date" x-model="suffixType" class="mt-1 h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300">
              <div class="ml-3">
                <label for="suffix_date" class="block text-sm font-medium text-gray-900">Date</label>
                <p class="text-sm text-gray-600">Adds the class date to titles</p>
                <p class="text-xs text-gray-500 mt-1">Example: "Weekly Mathematics Class on 05.26.2025", "Weekly Mathematics Class on 05.28.2025"</p>
              </div>
            </div>
            
            <div class="flex items-start">
              <input id="suffix_both" name="suffix_type" type="radio" value="both" x-model="suffixType" class="mt-1 h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300">
              <div class="ml-3">
                <label for="suffix_both" class="block text-sm font-medium text-gray-900">Both Number and Date</label>
                <p class="text-sm text-gray-600">Combines sequential numbering with dates</p>
                <p class="text-xs text-gray-500 mt-1">Example: "Weekly Mathematics Class 1 on 05.26.2025", "Weekly Mathematics Class 2 on 05.28.2025"</p>
              </div>
            </div>
          </div>
        </div>
        
        <div>
          <label for="description" class="block text-sm font-medium text-gray-900">Description</label>
          <div class="mt-2">
            <textarea name="description" id="description" rows="3" class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-emerald-600 sm:text-sm sm:leading-6"></textarea>
          </div>
        </div>
        
        <div>
          <label for="host" class="block text-sm font-medium text-gray-900">Host</label>
          <div class="mt-2">
            <select name="host" id="host" x-ref="hostInput" class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-emerald-600 sm:text-sm sm:leading-6">
              <option value="staff1">Staff 1</option>
              <option value="staff2">Staff 2</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 2 - Schedule Configuration -->
  <div class="bg-white shadow-sm border border-gray-200 rounded-lg">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-medium text-gray-900">Schedule Configuration</h3>
    </div>
    <div class="px-6 py-6 space-y-6">
      <div>
        <label for="recurrence_pattern" class="block text-sm font-medium text-gray-900">Recurrence Pattern</label>
        <div class="mt-2">
          <select name="recurrence_pattern" id="recurrence_pattern" x-model="recurrence" class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-emerald-600 sm:text-sm sm:leading-6">
            <option value="1">Daily</option>
            <option value="2">Weekly</option>
            <option value="3">Monthly</option>
          </select>
        </div>
      </div>

      <!-- Weekly Options Panel -->
      <div x-show="recurrence=='2'" class="bg-gray-50 border border-gray-200 rounded-lg p-4 space-y-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-900">Repeat every</label>
            <div class="mt-2 flex items-center gap-2">
              <select name="repeat_interval" class="block w-20 rounded-md border-0 py-1.5 px-2 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-emerald-600 sm:text-sm">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
              </select>
              <span class="text-sm text-gray-700">week(s)</span>
            </div>
          </div>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-900 mb-3">On days</label>
          <div class="flex flex-wrap gap-2">
            <label class="inline-flex items-center">
              <input type="checkbox" name="days[]" value="1" class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
              <span class="ml-2 text-sm text-gray-700">Mon</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="days[]" value="2" checked class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
              <span class="ml-2 text-sm text-gray-700">Tue</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="days[]" value="3" class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
              <span class="ml-2 text-sm text-gray-700">Wed</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="days[]" value="4" checked class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
              <span class="ml-2 text-sm text-gray-700">Thu</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="days[]" value="5" class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
              <span class="ml-2 text-sm text-gray-700">Fri</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="days[]" value="6" class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
              <span class="ml-2 text-sm text-gray-700">Sat</span>
            </label>
            <label class="inline-flex items-center">
              <input type="checkbox" name="days[]" value="0" class="rounded border-gray-300 text-emerald-600 focus:ring-emerald-500">
              <span class="ml-2 text-sm text-gray-700">Sun</span>
            </label>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div>
          <label for="start_date" class="block text-sm font-medium text-gray-900">
            Start Date <span class="text-red-500">*</span>
          </label>
          <div class="mt-2">
            <input type="date" name="start_date" id="start_date" x-ref="startDateInput" required value="2025-05-26" class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-emerald-600 sm:text-sm sm:leading-6" />
          </div>
        </div>
        
        <div>
          <label for="start_time" class="block text-sm font-medium text-gray-900">
            Start Time <span class="text-red-500">*</span>
          </label>
          <div class="mt-2">
            <input type="time" name="start_time" id="start_time" x-ref="startTimeInput" required value="10:00" class="block w-full rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-emerald-600 sm:text-sm sm:leading-6" />
          </div>
        </div>
      </div>

      <div>
        <label for="duration" class="block text-sm font-medium text-gray-900">
          Duration <span class="text-red-500">*</span>
        </label>
        <div class="mt-2 flex items-center gap-2">
          <input type="number" name="duration" id="duration" x-ref="durationInput" value="60" required min="1" class="block w-20 rounded-md border-0 py-2 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-emerald-600 sm:text-sm sm:leading-6" />
          <span class="text-sm text-gray-700">minutes</span>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 3 - End Conditions -->
  <div class="bg-white shadow-sm border border-gray-200 rounded-lg">
    <div class="px-6 py-4 border-b border-gray-200">
      <h3 class="text-lg font-medium text-gray-900">End Conditions</h3>
    </div>
    <div class="px-6 py-6 space-y-4">
      <div class="space-y-4">
        <div class="flex items-center">
          <input id="end_by_date" name="end_condition" type="radio" value="end_by_date" x-model="endCondition" class="h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300">
          <label for="end_by_date" class="ml-3 block text-sm font-medium text-gray-900">End by date</label>
        </div>
        <div x-show="endCondition == 'end_by_date'" class="ml-7">
          <input type="date" name="end_by_date_value" x-ref="endByDateInput" class="block w-full sm:w-48 rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-emerald-600 sm:text-sm sm:leading-6" />
        </div>
        
        <div class="flex items-center">
          <input id="end_after" name="end_condition" type="radio" value="end_after" x-model="endCondition" class="h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300">
          <label for="end_after" class="ml-3 block text-sm font-medium text-gray-900">End after</label>
        </div>
        <div x-show="endCondition == 'end_after'" class="ml-7 flex items-center gap-2">
          <input type="number" name="end_after_value" x-ref="endAfterInput" min="1" class="block w-20 rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-emerald-600 sm:text-sm sm:leading-6" />
          <span class="text-sm text-gray-700">occurrences</span>
        </div>
        
        <div class="flex items-center">
          <input id="no_end" name="end_condition" type="radio" value="no_end" x-model="endCondition" checked class="h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300">
          <label for="no_end" class="ml-3 block text-sm font-medium text-gray-900">No end date</label>
        </div>
      </div>
    </div>
  </div>

  <!-- SECTION 4 - Advanced Options (Collapsible) -->
  <div class="bg-white shadow-sm border border-gray-200 rounded-lg">
    <div class="px-6 py-4 border-b border-gray-200">
      <button type="button" @click="advancedOpen = !advancedOpen" class="flex w-full items-center justify-between text-left">
        <h3 class="text-lg font-medium text-gray-900">Advanced Options</h3>
        <svg :class="{'rotate-180': advancedOpen}" class="h-5 w-5 text-gray-500 transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
      </button>
    </div>
    <div x-show="advancedOpen" x-transition class="px-6 py-6 space-y-6">
      <div class="space-y-4">
        <div class="flex items-start">
          <div class="flex items-center h-5">
            <input id="auto_start" name="auto_start" type="checkbox" checked class="h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300 rounded">
          </div>
          <div class="ml-3 text-sm">
            <label for="auto_start" class="font-medium text-gray-900">Auto-start meetings</label>
            <p class="text-gray-500">Automatically start the meeting at the scheduled time</p>
          </div>
        </div>
        
        <div class="flex items-start">
          <div class="flex items-center h-5">
            <input id="email_reminders" name="email_reminders" type="checkbox" checked class="h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300 rounded">
          </div>
          <div class="ml-3 text-sm">
            <label for="email_reminders" class="font-medium text-gray-900">Send email reminders</label>
            <p class="text-gray-500">Send automated email reminders to participants before each session</p>
          </div>
        </div>
        
        <div class="flex items-start">
          <div class="flex items-center h-5">
            <input id="auto_record" name="auto_record" type="checkbox" class="h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300 rounded">
          </div>
          <div class="ml-3 text-sm">
            <label for="auto_record" class="font-medium text-gray-900">Record sessions automatically</label>
            <p class="text-gray-500">Automatically record all sessions in this series</p>
          </div>
        </div>
        
        <div class="flex items-start">
          <div class="flex items-center h-5">
            <input id="allow_before_host" name="allow_before_host" type="checkbox" class="h-4 w-4 text-emerald-600 focus:ring-emerald-500 border-gray-300 rounded">
          </div>
          <div class="ml-3 text-sm">
            <label for="allow_before_host" class="font-medium text-gray-900">Allow participants before host</label>
            <p class="text-gray-500">Allow participants to join the meeting before the host arrives</p>
          </div>
        </div>
      </div>
    </div>
  </div>

    <!-- Footer Actions for Step 1 -->
    <div class="flex items-center justify-end gap-x-4 pt-6">
      <button type="button" class="text-sm font-medium text-gray-900 hover:text-gray-700">
        Cancel
      </button>
      <button type="button" @click="proceedToPreview()" class="inline-flex justify-center rounded-md bg-emerald-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
        Create Series
      </button>
    </div>
  </div>

  <!-- Step 2: Preview & Confirm -->
  <div x-show="currentStep === 2" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-x-4" x-transition:enter-end="opacity-100 transform translate-x-0" class="space-y-6">
    
    <!-- Class Overview Card -->
    <div class="bg-white shadow-sm border border-gray-200 rounded-lg">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-medium text-gray-900">Class Overview</h3>
      </div>
      <div class="px-6 py-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-4">
            <div>
              <dt class="text-sm font-medium text-gray-500">Title</dt>
              <dd class="mt-1 text-sm text-gray-900" x-text="formData.title || 'Untitled Class'"></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Duration</dt>
              <dd class="mt-1 text-sm text-gray-900" x-text="(formData.duration || '60') + ' minutes'"></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Host</dt>
              <dd class="mt-1 text-sm text-gray-900" x-text="formData.host === 'staff1' ? 'Staff 1' : 'Staff 2'"></dd>
            </div>
          </div>
          <div class="space-y-4">
            <div>
              <dt class="text-sm font-medium text-gray-500">Recurrence Pattern</dt>
              <dd class="mt-1 text-sm text-gray-900" x-text="recurrenceText"></dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Start Date & Time</dt>
              <dd class="mt-1 text-sm text-gray-900" x-text="(formData.startDate || 'Not set') + ' at ' + (formData.startTime || 'Not set')"></dd>
            </div>
            <div x-show="recurrence === '2' && formData.selectedDays && formData.selectedDays.length > 0">
              <dt class="text-sm font-medium text-gray-500">Days of Week</dt>
              <dd class="mt-1 text-sm text-gray-900" x-text="formData.selectedDays ? formData.selectedDays.join(', ') : 'No days selected'"></dd>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Schedule Details Card -->
    <div class="bg-white shadow-sm border border-gray-200 rounded-lg">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-medium text-gray-900">Schedule Details</h3>
      </div>
      <div class="px-6 py-6">
        <div class="space-y-4">
          <div>
            <dt class="text-sm font-medium text-gray-500">End Condition</dt>
            <dd class="mt-1 text-sm text-gray-900" x-text="endConditionText"></dd>
          </div>
        </div>
      </div>
    </div>

    <!-- Upcoming Sessions Card -->
    <div class="bg-white shadow-sm border border-gray-200 rounded-lg">
      <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div>
            <h3 class="text-lg font-medium text-gray-900">Upcoming Sessions Preview</h3>
            <p class="mt-1 text-sm text-gray-500" x-text="sessionPreview.length > 0 ? `Showing ${Math.min(sessionPreview.length, 14)} session${sessionPreview.length !== 1 ? 's' : ''} based on your schedule` : 'Configure your schedule to see sessions'"></p>
          </div>
          <div class="text-right">
            <div class="text-sm font-medium text-gray-900" x-text="sessionPreview.length + (sessionPreview.length === 14 && (endCondition === 'no_end' || (endCondition === 'end_after' && parseInt(activeFormData.endAfterValue || '0') > 14)) ? '+' : '')"></div>
            <div class="text-xs text-gray-500">
              <span x-show="sessionPreview.length === 14 && endCondition === 'no_end'">More sessions scheduled...</span>
              <span x-show="sessionPreview.length === 14 && endCondition === 'end_after' && parseInt(activeFormData.endAfterValue || '0') > 14">+ <span x-text="parseInt(activeFormData.endAfterValue || '0') - 14"></span> more scheduled</span>
              <span x-show="sessionPreview.length < 14 || endCondition === 'end_by_date'">Total sessions</span>
            </div>
          </div>
        </div>
      </div>
      <div class="px-6 py-6">
        <div x-show="sessionPreview.length > 0" class="space-y-3">
          <template x-for="session in sessionPreview" :key="session.number">
            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border hover:bg-gray-100 transition-colors">
              <div class="flex items-center space-x-4">
                <div class="flex-shrink-0">
                  <div class="w-8 h-8 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center text-sm font-medium" x-text="session.number"></div>
                </div>
                <div>
                  <p class="text-sm font-medium text-gray-900" x-text="session.title || 'Session ' + session.number"></p>
                  <p class="text-sm text-gray-500" x-text="session.date"></p>
                </div>
              </div>
              <div class="text-right">
                <div class="text-sm text-gray-500" x-text="session.time"></div>
                <div class="text-xs text-gray-400" x-text="(formData.duration || '60') + ' min'"></div>
              </div>
            </div>
          </template>
        </div>
        
        <!-- Empty state -->
        <div x-show="sessionPreview.length === 0" class="text-center py-8">
          <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <h3 class="mt-2 text-sm font-medium text-gray-900">No sessions to display</h3>
          <p class="mt-1 text-sm text-gray-500">Complete the form to see your session preview</p>
        </div>
        
        <!-- Warning for end date conflicts -->
        <div x-show="endCondition === 'end_by_date' && activeFormData.endByDateValue && sessionPreview.length === 0" class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
              </svg>
            </div>
            <div class="ml-3">
              <h3 class="text-sm font-medium text-yellow-800">No sessions within date range</h3>
              <p class="mt-1 text-sm text-yellow-700">The selected end date may be too early. Please check your start date, end date, and recurrence pattern.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Actions for Step 2 -->
    <div class="flex items-center justify-between pt-6">
      <button type="button" @click="goBackToForm()" class="inline-flex justify-center rounded-md bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500">
        ← Go Back & Edit
      </button>
      <div class="flex items-center gap-x-4">
        <button type="button" class="text-sm font-medium text-gray-900 hover:text-gray-700">
          Cancel
        </button>
        <button type="submit" class="inline-flex justify-center rounded-md bg-green-600 px-6 py-2 text-sm font-medium text-white shadow-sm hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
          Confirm & Create Series
        </button>
      </div>
    </div>
</form>