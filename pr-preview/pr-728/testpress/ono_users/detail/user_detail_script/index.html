<script>
  function onoUserDetail() {
    return {
      user: null,
      userId: null,
      allUsers: [],
      currentIndex: 0,

      init() {
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        this.userId = urlParams.get('id');

        // Load users
        this.loadUsers();

        // Find and set current user
        if (this.userId) {
          this.findUserById(this.userId);
        } else if (this.allUsers.length > 0) {
          this.user = this.allUsers[0];
          this.updateCurrentIndex();
        }
      },

      loadUsers() {
        // Sample data - in production, this would come from an API
        this.allUsers = [
          {
            id: 1,
            name: 'Rajesh Kumar',
            email: 'rajesh.kumar@example.com',
            phone: '+91 98765 43210',
            aadhaar_number: '123456789012',
            work_permit_number: null,
            gender: 'Male',
            date_added: '2024-01-15',
            image_url: 'https://images.unsplash.com/photo-1568602471122-7832951cc4c5?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=facearea&facepad=2.5&w=320&h=320&q=80',
            org_name: 'Delhi Airport Authority',
            org_id: 'ORG-001',
            aep_number: 'AEP-12345',
            document_url: '/documents/rajesh_doc.pdf',
            document_name: 'rajesh_document.pdf',
            document_size: '2.4 MB',
            enrolled_cohorts: [
              {
                id: 1,
                name: 'Fire Safety Training - January 2026',
                product_name: 'Fire Safety Course',
                status: 'completed',
                enrolled_date: '2024-01-20'
              },
              {
                id: 2,
                name: 'AvSec Awareness - February 2026',
                product_name: 'AvSec Course',
                status: 'paid',
                enrolled_date: '2024-02-10'
              }
            ],
            certificates: [
              {
                id: 1,
                course_name: 'Fire Safety Training',
                product_name: 'Fire Safety Course',
                issue_date: '2024-03-15',
                valid_until: '2025-03-15',
                download_url: '/certificates/fire_safety_rajesh.pdf'
              }
            ]
          },
          {
            id: 2,
            name: 'Priya Sharma',
            email: 'priya.sharma@example.com',
            phone: '+91 98765 43211',
            aadhaar_number: null,
            work_permit_number: 'WP-2024-001',
            gender: 'Female',
            date_added: '2024-01-20',
            image_url: null,
            org_name: 'Mumbai Airport Authority',
            org_id: 'ORG-002',
            aep_number: null,
            document_url: null,
            enrolled_cohorts: [
              {
                id: 3,
                name: 'Emergency Response - March 2026',
                product_name: 'Emergency Response Course',
                status: 'pending_verification',
                enrolled_date: '2024-03-05'
              }
            ],
            certificates: []
          }
        ];
      },

      findUserById(id) {
        const found = this.allUsers.find(u => u.id == id);
        if (found) {
          this.user = found;
          this.updateCurrentIndex();
        }
      },

      updateCurrentIndex() {
        if (this.user) {
          this.currentIndex = this.allUsers.findIndex(u => u.id == this.user.id);
          if (this.currentIndex === -1) this.currentIndex = 0;
        }
      },

      editUser() {
        // Navigate to edit page or open edit modal
        if (this.user) {
          window.location.href = `/testpress/ono_users/edit/?id=${this.user.id}`;
        }
      },

      proceed() {
        // Handle proceed action - could be enrollment, payment, etc.
        alert('Proceed action - to be implemented');
      },

      getInitials(name) {
        if (!name) return 'U';
        return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
      },

      formatDate(dateString) {
        if (!dateString) return 'N/A';
        const date = new Date(dateString);
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const month = months[date.getMonth()];
        const day = date.getDate();
        const year = date.getFullYear();
        return `${month} ${day}, ${year}`;
      },

      formatCohortStatus(status) {
        const statusMap = {
          'pending_verification': 'Pending Review',
          'verified': 'Verified',
          'paid': 'In Training',
          'completed': 'Completed',
          'rejected': 'Rejected'
        };
        return statusMap[status] || status;
      }
    };
  }
</script>