<div class="overflow-hidden" x-data="installmentsData()">
  <table class="min-w-full divide-y divide-gray-200">
    <thead>
      <tr>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-left text-sm font-semibold text-gray-900">
          <div class="flex items-center gap-x-2">
            <svg class="shrink-0 size-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
            Product
          </div>
        </th>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-right text-sm font-semibold text-gray-900">
          Paid
        </th>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-right text-sm font-semibold text-gray-900">
          Remaining
        </th>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-left text-sm font-semibold text-gray-900">
          Due
        </th>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-left text-sm font-semibold text-gray-900">
          Last Paid
        </th>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-right text-sm font-semibold text-gray-900">
          Action
        </th>
      </tr>
    </thead>
    <template x-for="installment in installments" :key="installment.id">
      <tbody class="divide-y divide-gray-200 bg-white" 
             x-show="selectedFilter === 'all' || (selectedFilter === 'paid' && installment.isPaid) || (selectedFilter === 'pending' && !installment.isPaid && !installment.isOverdue) || (selectedFilter === 'overdue' && installment.isOverdue)">
        
        <tr class="select-none hover:bg-gray-50 transition-colors duration-150">
          
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500 text-left truncate sm:max-w-44">
            <div class="font-medium text-gray-900" x-text="installment.product"></div>
            <div class="text-xs text-gray-400" x-text="installment.course"></div>
          </td>
          
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500 text-right">
            <span class="font-medium text-gray-900" x-text="'₹' + (installment.amountPaid || 0).toLocaleString()"></span>
            INR
          </td>
          
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500 text-right">
            <span class="font-medium text-gray-900" x-text="'₹' + (installment.amountDue || 0).toLocaleString()"></span>
            INR
          </td>
          
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500 text-left">
            <template x-if="installment.isPaid">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Paid</span>
            </template>
            <template x-if="installment.isDueSoon && !installment.isPaid">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800" x-text="installment.dueDate"></span>
            </template>
            <template x-if="installment.isOverdue && !installment.isPaid">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800" x-text="installment.overdueDays == -1 ? 'Since yesterday' : 'Overdue by ' + installment.overdueDays + ' days'"></span>
            </template>
            <template x-if="!installment.isPaid && !installment.isDueSoon && !installment.isOverdue">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800" x-text="'In ' + installment.daysUntilDue + ' days'"></span>
            </template>
          </td>
          
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500 text-left">
            <span x-text="installment.lastPaid"></span>
          </td>

          <td class="whitespace-nowrap px-6 py-4 text-sm text-right">
            <template x-if="!installment.isPaid">
              <button 
                @click="payNow(installment)"
                type="button" 
                class="py-1.5 px-2 inline-flex items-center gap-x-2 text-xs font-medium rounded-lg border border-transparent bg-primary-600 text-white hover:bg-primary-700 focus:outline-hidden focus:bg-primary-700 disabled:opacity-50 disabled:pointer-events-none"
              >
                <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                Pay Now
              </button>
            </template>
            <template x-if="installment.isPaid">
              <button 
                @click="viewReceipt(installment)"
                type="button" 
                class="py-1.5 px-2 inline-flex items-center gap-x-2 text-xs font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 focus:outline-hidden focus:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none"
              >
                <svg class="shrink-0 size-3.5 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                Receipt
              </button>
            </template>
          </td>
        </tr>
      </tbody>
    </template>
    
    <!-- Empty State -->
    <tbody x-show="getFilteredInstallments(selectedFilter).length === 0">
      <tr>
        <td colspan="6" class="p-12 text-center text-sm text-gray-500">
          No installments found <span x-show="selectedFilter !== 'all'" x-text="'for ' + selectedFilter"></span>.
        </td>
      </tr>
    </tbody>
  </table>
</div>
