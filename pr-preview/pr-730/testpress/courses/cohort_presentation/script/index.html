<script>
  function cohortPresentation() {
    return {
      activeTab: 'ready_to_start',
      searchQuery: '',

      readyToStart: [
        {
          id: 1,
          name: 'Fire Safety Training - January 2026',
          course_name: 'Fire Safety Training',
          course_id: 1,
          learners_count: 25,
          payment_date: '2024-01-15T10:00:00Z'
        },
        {
          id: 2,
          name: 'AvSec Awareness - February 2026',
          course_name: 'AvSec Awareness',
          course_id: 2,
          learners_count: 30,
          payment_date: '2024-02-20T11:30:00Z'
        },
        {
          id: 3,
          name: 'Emergency Response - March 2026',
          course_name: 'Emergency Response',
          course_id: 3,
          learners_count: 15,
          payment_date: '2024-03-10T09:15:00Z'
        },
        {
          id: 4,
          name: 'Fire Safety Training - April 2026',
          course_name: 'Fire Safety Training',
          course_id: 1,
          learners_count: 20,
          payment_date: '2024-04-05T14:20:00Z'
        },
        {
          id: 5,
          name: 'AvSec Awareness - May 2026',
          course_name: 'AvSec Awareness',
          course_id: 2,
          learners_count: 22,
          payment_date: '2024-05-12T10:45:00Z'
        }
      ],

      activeSessions: [
        {
          id: 1,
          cohort_id: 3,
          cohort_name: 'Emergency Response - March 2026',
          course_name: 'Emergency Response',
          course_id: 3,
          presenter_name: 'John Doe',
          progress: 65,
          last_content: 'Chapter 5: Emergency Procedures',
          learners_count: 15
        },
        {
          id: 2,
          cohort_id: 4,
          cohort_name: 'Fire Safety Training - April 2026',
          course_name: 'Fire Safety Training',
          course_id: 1,
          presenter_name: 'Jane Smith',
          progress: 100,
          last_content: 'Certificate Award Content',
          learners_count: 20
        },
        {
          id: 3,
          cohort_id: 5,
          cohort_name: 'AvSec Awareness - May 2026',
          course_name: 'AvSec Awareness',
          course_id: 2,
          presenter_name: 'Robert Johnson',
          progress: 45,
          last_content: 'Chapter 3: Security Protocols',
          learners_count: 22
        }
      ],

      completed: [
        {
          id: 1,
          cohort_name: 'Fire Safety Training - December 2025',
          course_name: 'Fire Safety Training',
          presenter_name: 'John Doe',
          completed_date: '2024-12-20T15:30:00Z',
          learners_count: 18
        },
        {
          id: 2,
          cohort_name: 'AvSec Awareness - November 2025',
          course_name: 'AvSec Awareness',
          presenter_name: 'Jane Smith',
          completed_date: '2024-11-15T14:20:00Z',
          learners_count: 25
        },
        {
          id: 3,
          cohort_name: 'Emergency Response - October 2025',
          course_name: 'Emergency Response',
          presenter_name: 'Robert Johnson',
          completed_date: '2024-10-10T11:45:00Z',
          learners_count: 12
        },
        {
          id: 4,
          cohort_name: 'Fire Safety Training - September 2025',
          course_name: 'Fire Safety Training',
          presenter_name: 'Sarah Williams',
          completed_date: '2024-09-05T16:00:00Z',
          learners_count: 30
        }
      ],

      get filteredReadyToStart() {
        if (!this.searchQuery) return this.readyToStart;
        const query = this.searchQuery.toLowerCase();
        return this.readyToStart.filter(c =>
          c.name.toLowerCase().includes(query) ||
          c.course_name.toLowerCase().includes(query)
        );
      },

      get filteredActiveSessions() {
        if (!this.searchQuery) return this.activeSessions;
        const query = this.searchQuery.toLowerCase();
        return this.activeSessions.filter(s =>
          s.cohort_name.toLowerCase().includes(query) ||
          s.course_name.toLowerCase().includes(query) ||
          s.presenter_name.toLowerCase().includes(query)
        );
      },

      get filteredCompleted() {
        if (!this.searchQuery) return this.completed;
        const query = this.searchQuery.toLowerCase();
        return this.completed.filter(s =>
          s.cohort_name.toLowerCase().includes(query) ||
          s.course_name.toLowerCase().includes(query) ||
          s.presenter_name.toLowerCase().includes(query)
        );
      },

      get readyToStartCount() {
        return this.filteredReadyToStart.length;
      },

      get activeSessionsCount() {
        return this.filteredActiveSessions.length;
      },

      get completedCount() {
        return this.filteredCompleted.length;
      },

      get totalLearnersCount() {
        return this.readyToStart.reduce((sum, c) => sum + c.learners_count, 0) +
          this.activeSessions.reduce((sum, s) => sum + (s.learners_count || 0), 0) +
          this.completed.reduce((sum, s) => sum + (s.learners_count || 0), 0);
      },

      filterCohorts() {
        // Filtering is handled by computed properties
      },

      issueCertificates(session) {
        // Handle certificate issuance
        if (confirm('Issue certificates to all learners in ' + session.cohort_name + '?')) {
          // API call to issue certificates
          alert('Certificates are being issued for: ' + session.cohort_name);
        }
      },

      formatDate(dateString) {
        if (!dateString) return 'N/A';
        const date = new Date(dateString);
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const month = months[date.getMonth()];
        const day = date.getDate();
        const year = date.getFullYear();
        return `${month} ${day}, ${year}`;
      }
    };
  }
</script>