<div
  class="flex flex-col bg-white border border-stone-200 overflow-hidden rounded-xl shadow-2xs dark:bg-neutral-800 dark:border-neutral-700">
  <!-- Header -->
  <div class="py-3 px-4 border-b border-gray-200 dark:border-neutral-700 flex items-center justify-between gap-3">
    <div>
      <h2 class="text-sm font-medium text-gray-800 dark:text-neutral-200">
        Add Users
      </h2>
      <p class="mt-1 text-xs text-slate-500 dark:text-neutral-400">
        Select users to enroll in this training.
      </p>
    </div>

    <button
      class="py-2 px-3 inline-flex items-center gap-x-2 text-xs font-medium rounded-lg border border-transparent bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50 disabled:pointer-events-none focus:outline-none focus:ring-2 focus:ring-emerald-500"
      type="button">
      <svg class="hidden sm:block shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round">
        <path d="M5 12h14"></path>
        <path d="M12 5v14"></path>
      </svg>
      Add New User
    </button>
  </div>

  <!-- Body -->
  <div>
    <div class="p-5 space-y-4">
      <!-- Search -->
      <div class="relative">
        <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-1/2 -translate-y-1/2 size-4 text-slate-400"
          viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.3-4.3"></path>
        </svg>
        <input type="search" x-model="filters.search"
          class="block w-full rounded-md border border-slate-300 bg-white py-2.5 pl-9 pr-3 text-sm text-slate-900 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-100"
          placeholder="Search by name, Aadhaar, work permit, or phone...">
      </div>

      <!-- Select all -->
      <div class="flex items-center justify-between px-3 py-2 bg-slate-50 rounded-lg dark:bg-neutral-800">
        <div class="flex items-center gap-2">
          <input id="select-all" type="checkbox"
            class="shrink-0 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500"
            @change="toggleSelectAll($event.target.checked)">
          <label for="select-all" class="text-sm text-slate-700 dark:text-neutral-200 cursor-pointer">
            Select All Available (<span x-text="filteredUsers.length"></span>)
          </label>
        </div>
      </div>
    </div>

    <!-- Users list (cards) -->
    <div class="border-t border-gray-200 dark:border-neutral-800">
      <div class="max-h-[420px] overflow-y-auto px-4 py-3 space-y-2">
        <template x-for="user in filteredUsers" :key="user.id">
          <div
            class="flex items-center gap-3 p-3 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors cursor-pointer dark:border-neutral-700 dark:hover:bg-neutral-800"
            @click="toggleWorker(user)">
            <input type="checkbox" class="shrink-0 rounded border-slate-300 text-emerald-600 focus:ring-emerald-500"
              :checked="selectedWorkersIds.includes(user.id)" @click.stop @change="toggleWorker(user)">

            <div class="flex-1 min-w-0 flex items-center gap-3">
              <template x-if="user.image_url">
                <img class="shrink-0 size-9 rounded-full" :src="user.image_url" :alt="user.name">
              </template>
              <template x-if="!user.image_url">
                <span x-text="user.initials"
                  class="flex shrink-0 justify-center items-center size-9 bg-white border border-gray-200 text-gray-700 text-xs font-medium uppercase rounded-full dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-300"></span>
              </template>

              <div class="flex-1 min-w-0">
                <p class="font-medium text-slate-900 dark:text-neutral-100 text-sm truncate" x-text="user.name"></p>
                <div class="flex flex-wrap items-center gap-2 mt-1 text-xs text-slate-600 dark:text-neutral-400">
                  <span class="font-mono" x-text="user.id_display"></span>
                  <span class="w-px h-3 bg-slate-300 dark:bg-neutral-600"></span>
                  <span x-text="user.phone"></span>
                </div>
              </div>

              <div class="hidden sm:flex flex-col items-end gap-1 text-xs">
                <span class="text-slate-500 dark:text-neutral-400" x-text="user.date_added"></span>

                <!-- Enrolled cohorts tooltip -->
                <template x-if="user.enrolled_cohorts && user.enrolled_cohorts.length">
                  <div class="hs-tooltip hover:z-10">
                    <span
                      class="hs-tooltip-toggle py-1 px-2 inline-flex items-center gap-1.5 rounded-full bg-blue-50 text-blue-700 dark:bg-blue-500/10 dark:text-blue-400 cursor-pointer">
                      <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span>
                      <span
                        x-text="user.enrolled_cohorts.length + ' cohort' + (user.enrolled_cohorts.length !== 1 ? 's' : '')"></span>
                    </span>
                    <span
                      class="hs-tooltip-content hs-tooltip-shown:opacity-100 hs-tooltip-shown:visible opacity-0 inline-block absolute invisible z-20 py-1.5 px-2.5 bg-white text-xs text-slate-800 rounded-lg shadow-2xs border border-gray-200 dark:bg-neutral-900 dark:text-neutral-100 dark:border-neutral-700"
                      role="tooltip">
                      <span class="block text-[11px] font-medium mb-1 text-slate-800 dark:text-neutral-100">Enrolled
                        cohorts</span>
                      <ul class="space-y-0.5">
                        <template x-for="cohort in user.enrolled_cohorts" :key="cohort.name">
                          <li class="flex items-start gap-1.5">
                            <span class="mt-1 w-1.5 h-1.5 rounded-full bg-gray-400"></span>
                            <span x-text="cohort.name"></span>
                          </li>
                        </template>
                      </ul>
                    </span>
                  </div>
                </template>

                <!-- Not enrolled pill -->
                <template x-if="!user.enrolled_cohorts || user.enrolled_cohorts.length === 0">
                  <span
                    class="py-1 px-2 inline-flex items-center gap-1.5 rounded-full bg-gray-100 text-gray-700 dark:bg-neutral-700 dark:text-neutral-200">
                    Not enrolled
                  </span>
                </template>
              </div>
            </div>
          </div>
        </template>

        <template x-if="!filteredUsers.length">
          <p class="text-sm text-slate-500 dark:text-neutral-400 px-2 py-4 text-center">
            No users found. Try adjusting your search.
          </p>
        </template>
      </div>
    </div>
  </div>
</div>