<script>
  window.addEventListener('load', () => {
    // Revenue by Plan data for different billing periods
    const revenueData = {
      monthly: {
        categories: ['Standard', 'Basic', 'Premium'],
        data: [850000, 720000, 650000]
      },
      quarterly: {
        categories: ['Standard', 'Basic', 'Premium'],
        data: [2400000, 2100000, 1900000]
      },
      annual: {
        categories: ['Standard', 'Basic', 'Premium'],
        data: [9500000, 8500000, 7800000]
      }
    };

    let revenueByPlanChart;

    // Function to render/update the chart
    function renderRevenueByPlanChart(billingPeriod = 'monthly') {
      const chartData = revenueData[billingPeriod];

      const chartOptions = {
        chart: {
          type: 'bar',
          height: 300,
          toolbar: {
            show: false
          },
          zoom: {
            enabled: false
          }
        },
        series: [
          {
            name: 'Revenue',
            data: chartData.data
          }
        ],
        fill: {
          pattern: {
            width: 6,
            height: 6,
            strokeWidth: 2
          }
        },
        grid: {
          strokeDashArray: 2,
          borderColor: '#e5e7eb'
        },
        plotOptions: {
          bar: {
            horizontal: false,
            columnWidth: '35%',
            borderRadius: 4,
          }
        },
        legend: {
          show: false
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          show: true,
          width: 3,
          colors: ['transparent']
        },
        xaxis: {
          categories: chartData.categories,
          axisBorder: {
            show: false
          },
          axisTicks: {
            show: false
          },
          crosshairs: {
            show: false
          },
          labels: {
            style: {
              colors: '#a8a29e',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            }
          }
        },
        yaxis: {
          labels: {
            align: 'left',
            minWidth: 0,
            maxWidth: 140,
            style: {
              colors: '#a8a29e',
              fontSize: '12px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            formatter: (value) => {
              if (value >= 10000000) return `₹${(value / 10000000).toFixed(1)}Cr`;
              if (value >= 100000) return `₹${(value / 100000).toFixed(1)}L`;
              if (value >= 1000) return `₹${(value / 1000).toFixed(0)}k`;
              return `₹${value}`;
            }
          }
        },
        tooltip: {
          y: {
            formatter: (value) => {
              if (value >= 10000000) return `₹${(value / 10000000).toFixed(2)}Cr`;
              if (value >= 100000) return `₹${(value / 100000).toFixed(2)}L`;
              if (value >= 1000) return `₹${(value / 1000).toFixed(1)}k`;
              return `₹${value}`;
            }
          },
          custom: function (props) {
            const { categories } = props.ctx.opts.xaxis;
            const { dataPointIndex } = props;
            const value = props.series[0][dataPointIndex];

            const formatValue = (val) => {
              if (val >= 10000000) return `₹${(val / 10000000).toFixed(2)}Cr`;
              if (val >= 100000) return `₹${(val / 100000).toFixed(2)}L`;
              if (val >= 1000) return `₹${(val / 1000).toFixed(1)}k`;
              return `₹${val}`;
            };

            return `
              <div class="ms-0.5 mb-2 bg-white border border-gray-200 text-gray-800 rounded-lg shadow-md dark:bg-neutral-800 dark:border-neutral-700 min-w-28">
                <div class="apexcharts-tooltip-title flex justify-between font-semibold !text-sm !bg-white !border-gray-200 text-gray-800 rounded-t-lg dark:!bg-neutral-800 dark:!border-neutral-700 dark:text-neutral-200 p-2">
                  <span>${categories[dataPointIndex]}</span>
                </div>
                <div class="p-2 space-y-1">
                  <div class="flex justify-between items-center gap-x-4">
                    <span class="text-xs text-gray-600 dark:text-neutral-400">Revenue</span>
                    <span class="text-xs font-medium text-gray-800 dark:text-neutral-200">${formatValue(value)}</span>
                  </div>
                </div>
              </div>
            `;
          }
        },
        states: {
          hover: {
            filter: {
              type: 'darken',
              value: 0.9
            }
          }
        },
        responsive: [{
          breakpoint: 568,
          options: {
            chart: {
              height: 300
            },
            stroke: {
              width: 2
            },
            xaxis: {
              labels: {
                style: {
                  colors: '#a8a29e',
                  fontSize: '11px',
                  fontFamily: 'Inter, ui-sans-serif',
                  fontWeight: 400
                }
              }
            },
            yaxis: {
              labels: {
                align: 'left',
                minWidth: 0,
                maxWidth: 140,
                style: {
                  colors: '#a8a29e',
                  fontSize: '11px',
                  fontFamily: 'Inter, ui-sans-serif',
                  fontWeight: 400
                },
                formatter: (value) => {
                  if (value >= 10000000) return `₹${(value / 10000000).toFixed(1)}Cr`;
                  if (value >= 100000) return `₹${(value / 100000).toFixed(1)}L`;
                  if (value >= 1000) return `₹${(value / 1000).toFixed(0)}k`;
                  return `₹${value}`;
                }
              }
            }
          }
        }]
      };

      buildChart('#hs-revenue-by-plan-bar-chart', (mode) => chartOptions, {
        colors: ['#6366f1'], // Indigo color
        grid: {
          borderColor: '#e5e7eb'
        },
        xaxis: {
          labels: {
            style: {
              colors: '#a8a29e'
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#a8a29e'
            }
          }
        }
      }, {
        colors: ['#818cf8'], // Lighter indigo for dark mode
        grid: {
          borderColor: '#44403c'
        },
        xaxis: {
          labels: {
            style: {
              colors: '#a3a3a3'
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#a3a3a3'
            }
          }
        }
      });
    }

    // Initial chart render
    renderRevenueByPlanChart('monthly');

    // Listen for dropdown changes
    const selectElement = document.getElementById('hs-plan-billing-period-select');
    if (selectElement) {
      // Use event delegation or direct listener
      selectElement.addEventListener('change', function (e) {
        const selectedPeriod = this.value;
        renderRevenueByPlanChart(selectedPeriod);
      });
    }
  });
</script>