<script src="https://preline.co/pro/assets/vendor/lodash/lodash.min.js"></script>
<script src="https://preline.co/pro/assets/vendor/apexcharts/dist/apexcharts.min.js"></script>
<script src="https://preline.co/pro/assets/js/hs-apexcharts-helpers.js"></script>

<script>
  window.addEventListener('load', () => {
    // Apex User Growth Line Chart
    (function () {
      // Create categories array once
      const categories = Array.from({ length: 30 }, (_, i) => {
        const date = new Date();
        date.setDate(date.getDate() - (29 - i));
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      });

      buildChart('#hs-user-growth-line-chart', (mode) => ({
        chart: {
          height: 300,
          type: 'line',
          toolbar: {
            show: false
          },
          zoom: {
            enabled: false
          }
        },
        series: [
          {
            name: 'New Users',
            data: [120, 150, 130, 180, 160, 200, 170, 220, 190, 240, 210, 250, 230, 270, 240, 280, 260, 300, 280, 320, 290, 340, 310, 360, 330, 350, 320, 380, 350, 400]
          },
          {
            name: 'Total Users',
            data: [24000, 24150, 24280, 24460, 24620, 24820, 24990, 25210, 25400, 25640, 25850, 26100, 26330, 26600, 26840, 27120, 27380, 27680, 27960, 28280, 28570, 28910, 29220, 29580, 29910, 30260, 30580, 30960, 31310, 31710]
          }
        ],
        dataLabels: {
          enabled: false
        },
        stroke: {
          curve: 'smooth',
          width: [3, 3],
          dashArray: [0, 10] // Solid for New Users, dashed for Total Users
        },
        legend: {
          show: false
        },
        xaxis: {
          type: 'category',
          categories: categories,
          axisBorder: {
            show: false
          },
          axisTicks: {
            show: false
          },
          tooltip: {
            enabled: false
          },
          labels: {
            style: {
              colors: '#a8a29e',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            formatter: function (value) {
              // Show only 8 labels to reduce clutter: 0, 4, 8, 12, 16, 20, 24, 29
              const index = categories.indexOf(value);
              // Show labels at: 0, 4, 8, 12, 16, 20, 24, 29 (8 labels total)
              // Exclude index 28 to avoid crowding with index 29
              if (index !== -1 && (index === 0 || index === 29 || (index > 0 && index % 4 === 0 && index < 28))) {
                let t = value;
                if (t) {
                  const newT = t.split(' ');
                  t = `${newT[0]} ${newT[1]}`;
                }
                return t;
              }
              return ''; // Hide label for other dates
            },
            hideOverlappingLabels: true
          }
        },
        yaxis: {
          labels: {
            align: 'left',
            minWidth: 0,
            maxWidth: 140,
            style: {
              colors: '#a8a29e',
              fontSize: '12px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            formatter: (value) => {
              if (value >= 1000) return `${(value / 1000).toFixed(0)}k`;
              return value;
            }
          }
        },
        tooltip: {
          custom: function (props) {
            const { categories } = props.ctx.opts.xaxis;
            const { dataPointIndex } = props;
            const title = categories[dataPointIndex];

            return buildTooltip(props, {
              title: title,
              mode,
              hasTextLabel: true,
              wrapperExtClasses: 'min-w-36',
              labelDivider: ':',
              labelExtClasses: 'ms-2',
              valuePrefix: '',
            });
          }
        },
        responsive: [{
          breakpoint: 568,
          options: {
            chart: {
              height: 300
            },
            labels: {
              style: {
                colors: '#a8a29e',
                fontSize: '11px',
                fontFamily: 'Inter, ui-sans-serif',
                fontWeight: 400
              },
              offsetX: -2,
              formatter: function (value) {
                const index = categories.indexOf(value);
                // Show labels at: 0, 4, 8, 12, 16, 20, 24, 29 (8 labels total)
                // Exclude index 28 to avoid crowding with index 29
                if (index !== -1 && (index === 0 || index === 29 || (index > 0 && index % 4 === 0 && index < 28))) {
                  let t = value;
                  if (t) {
                    const newT = t.split(' ');
                    t = `${newT[0].slice(0, 3)} ${newT[1]}`;
                  }
                  return t;
                }
                return '';
              },
              hideOverlappingLabels: true
            },
            yaxis: {
              labels: {
                align: 'left',
                minWidth: 0,
                maxWidth: 140,
                style: {
                  colors: '#a8a29e',
                  fontSize: '11px',
                  fontFamily: 'Inter, ui-sans-serif',
                  fontWeight: 400
                },
                formatter: (value) => {
                  if (value >= 1000) return `${(value / 1000).toFixed(0)}k`;
                  return value;
                }
              }
            }
          }
        }]
      }), {
        colors: ['#3b82f6', '#8b5cf6'], // Blue for New Users, Purple for Total Users
        xaxis: {
          labels: {
            style: {
              colors: '#a8a29e',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#a8a29e'
            }
          }
        },
        grid: {
          borderColor: '#e5e7eb',
          strokeDashArray: 2
        }
      }, {
        colors: ['#60a5fa', '#a78bfa'], // Lighter blue and purple for dark mode
        xaxis: {
          labels: {
            style: {
              colors: '#a3a3a3',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#a3a3a3'
            }
          }
        },
        grid: {
          borderColor: '#404040',
          strokeDashArray: 2
        }
      });
    })();
  });
</script>