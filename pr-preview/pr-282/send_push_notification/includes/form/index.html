<div class="px-4 py-6 sm:px-6 lg:px-8 overflow-x-auto bg-white border-b border-gray-200 shadow sm:rounded-lg">
  <form>
    <div class="space-y-12">
      <fieldset>
        <div class="mt-4 space-y-6" x-data="{ selectedTab: 'All users'}">
          <div class="col-span-full sm:mx-4">
            <h2 class="text-base font-semibold leading-7 text-gray-900">Send Push Notifications</h2>
            <label for="id_email_subject" class="mt-6 block text-sm font-medium text-gray-900">Notification Title</label>
            <div class="mt-2">
              <div class="flex rounded-md shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-inset focus-within:ring-green-600">
                <input type="text" class="w-full block flex-1 border-0 bg-transparent py-1.5 text-gray-900 placeholder:text-gray-400 focus:ring-0 sm:text-sm sm:leading-6" />
              </div>
            </div>
          </div>
          <div class="col-span-full sm:mx-4">
            <label for="about" class="block text-sm font-medium leading-6 text-gray-900">Notification Message</label>
            <div class="mt-2">
              <div class="mt-2">
                <textarea class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6" rows="3"></textarea>
              </div>
            </div>
          </div>
          <div class="col-span-full sm:mx-4">
            <label for="about" class="block text-sm font-medium leading-6 text-gray-900">Recipient Type</label>
            <div class="mt-2">
              <div class="mt-2">
                <select id="tabs" name="tabs" x-model="selectedTab" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
                  <option selected="">All users</option>
                  <option>Product buyers</option>
                  <option>Course enrollees</option>
                  <option>Selected users</option>
                  <option>Selected category</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="col-span-full sm:mx-4" data-label="Products" x-show="selectedTab === 'Product buyers'">
            <div x-data="getItems()" x-init="label = $el.closest('[data-label]').getAttribute('data-label'); init()">
        <label
            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
            Select <span x-text="label"></span>
        </label>

    <div class="mt-2">
        <div class="m-y-1 overflow-y-auto max-h-20" x-show="selected.length > 0">
            <ul class="my-2 flex flex-wrap gap-2">
                <template x-for="item in selected" :key="item">
                    <span
                        class="inline-flex items-center py-0.5 pl-2 pr-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700 h-5">
                        <span x-text="item"></span>
                        <button @click="onClick(item)" type="button"
                            class="flex-shrink-0 ml-0.5 h-4 w-4 rounded-full inline-flex items-center justify-center text-green-400 hover:bg-green-200 hover:text-green-500 focus:outline-none focus:bg-green-500 focus:text-white">
                            <span class="sr-only">Remove item</span>
                            <svg class="h-2 w-2" stroke="currentColor" fill="none"
                                viewBox="0 0 8 8">
                                <path stroke-linecap="round" stroke-width="1.5"
                                    d="M1 1l6 6m0-6L1 7" />
                            </svg>
                        </button>
                    </span>
                </template>
            </ul>
        </div>
        <div @click.away="closeDropdown()">
        <!-- Search Input -->
        <input x-model="search" 
        :placeholder="`Search for ${label}`"
            @keydown.window="handleKeyDown($event)" x-on:focus="openDropdown()"
            class="py-2.5 px-3 pe-9 block w-full border-stone-200 rounded-lg text-sm placeholder:text-stone-400 focus:border-green-500 focus:ring-green-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-transparent dark:border-neutral-700 dark:text-neutral-300 dark:placeholder:text-white/60 dark:focus:ring-neutral-600" />

        <!-- Filtered Items Dropdown -->
        <div x-show="dropdownOpen">
            <ul x-ref="dropdown"
                class="my-2 max-h-60 overflow-auto rounded-md py-1 text-base leading-6 shadow-xs focus:outline-none sm:text-sm sm:leading-5 ring-1 ring-black ring-opacity-5"
                @mouseover="resetActiveIndex()">
                <template x-for="(item, index) in filteredItems" :key="item">
                    <li @click="onClick(item)" :class="{
                            'text-green-700': selected.includes(item),
                            'hover:bg-gray-200': !selected.includes(item),
                            'bg-gray-200': index === activeIndex
                        }"
                        class="cursor-pointer text-gray-900 cursor-default select-none relative py-2 pl-3 pr-9">
                        <span x-text="item"></span>
                    </li>
                </template>
                <template x-if="filteredItems.length === 0">
                    <li class="text-gray-500 cursor-default select-none relative py-2 pl-3 pr-9">
                        No items found
                    </li>
                </template>
            </ul>
        </div>
    </div>
    </div>
</div>
<script>
    function getItems() {
      return {
          search: '',
          label: '', // Initialize an empty label; you can set it from the Alpine.js context
    items: [], // Start with an empty array of items

    init() {
      // Set the items array based on the current label
      switch (this.label) {
        case 'Courses':
          this.items = [
            "Bio Chemistry",
            "Anatomy",
            "Pharmacology",
            "Community health",
            "Pathology",
            "General Medicine"
          ];
          break;
        case 'Users':
          this.items = [
            "John Doe",
            "Jane Smith",
            "Alice Johnson",
            "Bob Brown",
            "Charlie Wilson"
          ];
          break;
        case 'Products':
          this.items = [
            "Product A",
            "Product B",
            "Product C",
            "Product D",
            "Product E"
          ];
          break;
        default:
          this.items = [];
      }
    },
          selected: [],
          dropdownOpen: false,
          activeIndex: -1,
          get filteredItems() {
              return this.items.filter(
                  i => i.toLowerCase().startsWith(this.search.toLowerCase())
              );
          },
          onClick(item) {
              if (this.selected.includes(item)) {
                  this.selected = this.selected.filter(p => p !== item);
              } else {
                  this.selected.push(item);
              }
              this.search = ''; // Clear search after selecting an item
          },
          toggleDropdown() {
              this.dropdownOpen = true;
              if (this.dropdownOpen) {
                  this.activeIndex = -1; // Reset active index when opening dropdown
              }
          },
          closeDropdown() {
              console.log("this is the end");
              this.dropdownOpen = false;
              this.activeIndex = -1; // Reset active index when closing dropdown
          },
          openDropdown() {
              this.dropdownOpen = true;
          },
          resetActiveIndex() {
              this.activeIndex = -1; // Reset active index on mouse hover
          },
          handleKeyDown(event) {
              if (this.dropdownOpen) {
                  const dropdown = this.$refs.dropdown;
                  const items = dropdown.querySelectorAll('li');
                  if (event.key === 'ArrowDown') {
                      event.preventDefault();
                      this.activeIndex = (this.activeIndex + 1) % items.length;
                      this.scrollToActiveItem(items[this.activeIndex]);
                  } else if (event.key === 'ArrowUp') {
                      event.preventDefault();
                      this.activeIndex = (this.activeIndex - 1 + items.length) % items.length;
                      this.scrollToActiveItem(items[this.activeIndex]);
                  } else if (event.key === 'Enter') {
                      event.preventDefault();
                      if (this.activeIndex > -1) {
                          this.onClick(this.filteredItems[this.activeIndex]);
                      }
                  }
                  else if (event.key === "Escape") { // For character keys
                      this.closeDropdown();
                  }
                  if (event.key === "Tab") {
                      this.closeDropdown();
                  }
              }
          },
          scrollToActiveItem(item) {
              const dropdown = this.$refs.dropdown;
              const itemRect = item.getBoundingClientRect();
              const dropdownRect = dropdown.getBoundingClientRect();
  
              if (itemRect.top < dropdownRect.top) {
                  dropdown.scrollTop -= (dropdownRect.top - itemRect.top);
              } else if (itemRect.bottom > dropdownRect.bottom) {
                  dropdown.scrollTop += (itemRect.bottom - dropdownRect.bottom);
              }
          },
          resetActiveIndex() {
              this.activeIndex = -1; // Reset active index on mouse hover
          }
      }
  }
  </script> 
          </div>
        
          <!-- Courses section -->
          <div class="col-span-full sm:mx-4" data-label="Courses" x-show="selectedTab === 'Course enrollees'">
            <div x-data="getItems()" x-init="label = $el.closest('[data-label]').getAttribute('data-label'); init()">
        <label
            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
            Select <span x-text="label"></span>
        </label>

    <div class="mt-2">
        <div class="m-y-1 overflow-y-auto max-h-20" x-show="selected.length > 0">
            <ul class="my-2 flex flex-wrap gap-2">
                <template x-for="item in selected" :key="item">
                    <span
                        class="inline-flex items-center py-0.5 pl-2 pr-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700 h-5">
                        <span x-text="item"></span>
                        <button @click="onClick(item)" type="button"
                            class="flex-shrink-0 ml-0.5 h-4 w-4 rounded-full inline-flex items-center justify-center text-green-400 hover:bg-green-200 hover:text-green-500 focus:outline-none focus:bg-green-500 focus:text-white">
                            <span class="sr-only">Remove item</span>
                            <svg class="h-2 w-2" stroke="currentColor" fill="none"
                                viewBox="0 0 8 8">
                                <path stroke-linecap="round" stroke-width="1.5"
                                    d="M1 1l6 6m0-6L1 7" />
                            </svg>
                        </button>
                    </span>
                </template>
            </ul>
        </div>
        <div @click.away="closeDropdown()">
        <!-- Search Input -->
        <input x-model="search" 
        :placeholder="`Search for ${label}`"
            @keydown.window="handleKeyDown($event)" x-on:focus="openDropdown()"
            class="py-2.5 px-3 pe-9 block w-full border-stone-200 rounded-lg text-sm placeholder:text-stone-400 focus:border-green-500 focus:ring-green-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-transparent dark:border-neutral-700 dark:text-neutral-300 dark:placeholder:text-white/60 dark:focus:ring-neutral-600" />

        <!-- Filtered Items Dropdown -->
        <div x-show="dropdownOpen">
            <ul x-ref="dropdown"
                class="my-2 max-h-60 overflow-auto rounded-md py-1 text-base leading-6 shadow-xs focus:outline-none sm:text-sm sm:leading-5 ring-1 ring-black ring-opacity-5"
                @mouseover="resetActiveIndex()">
                <template x-for="(item, index) in filteredItems" :key="item">
                    <li @click="onClick(item)" :class="{
                            'text-green-700': selected.includes(item),
                            'hover:bg-gray-200': !selected.includes(item),
                            'bg-gray-200': index === activeIndex
                        }"
                        class="cursor-pointer text-gray-900 cursor-default select-none relative py-2 pl-3 pr-9">
                        <span x-text="item"></span>
                    </li>
                </template>
                <template x-if="filteredItems.length === 0">
                    <li class="text-gray-500 cursor-default select-none relative py-2 pl-3 pr-9">
                        No items found
                    </li>
                </template>
            </ul>
        </div>
    </div>
    </div>
</div>
<script>
    function getItems() {
      return {
          search: '',
          label: '', // Initialize an empty label; you can set it from the Alpine.js context
    items: [], // Start with an empty array of items

    init() {
      // Set the items array based on the current label
      switch (this.label) {
        case 'Courses':
          this.items = [
            "Bio Chemistry",
            "Anatomy",
            "Pharmacology",
            "Community health",
            "Pathology",
            "General Medicine"
          ];
          break;
        case 'Users':
          this.items = [
            "John Doe",
            "Jane Smith",
            "Alice Johnson",
            "Bob Brown",
            "Charlie Wilson"
          ];
          break;
        case 'Products':
          this.items = [
            "Product A",
            "Product B",
            "Product C",
            "Product D",
            "Product E"
          ];
          break;
        default:
          this.items = [];
      }
    },
          selected: [],
          dropdownOpen: false,
          activeIndex: -1,
          get filteredItems() {
              return this.items.filter(
                  i => i.toLowerCase().startsWith(this.search.toLowerCase())
              );
          },
          onClick(item) {
              if (this.selected.includes(item)) {
                  this.selected = this.selected.filter(p => p !== item);
              } else {
                  this.selected.push(item);
              }
              this.search = ''; // Clear search after selecting an item
          },
          toggleDropdown() {
              this.dropdownOpen = true;
              if (this.dropdownOpen) {
                  this.activeIndex = -1; // Reset active index when opening dropdown
              }
          },
          closeDropdown() {
              console.log("this is the end");
              this.dropdownOpen = false;
              this.activeIndex = -1; // Reset active index when closing dropdown
          },
          openDropdown() {
              this.dropdownOpen = true;
          },
          resetActiveIndex() {
              this.activeIndex = -1; // Reset active index on mouse hover
          },
          handleKeyDown(event) {
              if (this.dropdownOpen) {
                  const dropdown = this.$refs.dropdown;
                  const items = dropdown.querySelectorAll('li');
                  if (event.key === 'ArrowDown') {
                      event.preventDefault();
                      this.activeIndex = (this.activeIndex + 1) % items.length;
                      this.scrollToActiveItem(items[this.activeIndex]);
                  } else if (event.key === 'ArrowUp') {
                      event.preventDefault();
                      this.activeIndex = (this.activeIndex - 1 + items.length) % items.length;
                      this.scrollToActiveItem(items[this.activeIndex]);
                  } else if (event.key === 'Enter') {
                      event.preventDefault();
                      if (this.activeIndex > -1) {
                          this.onClick(this.filteredItems[this.activeIndex]);
                      }
                  }
                  else if (event.key === "Escape") { // For character keys
                      this.closeDropdown();
                  }
                  if (event.key === "Tab") {
                      this.closeDropdown();
                  }
              }
          },
          scrollToActiveItem(item) {
              const dropdown = this.$refs.dropdown;
              const itemRect = item.getBoundingClientRect();
              const dropdownRect = dropdown.getBoundingClientRect();
  
              if (itemRect.top < dropdownRect.top) {
                  dropdown.scrollTop -= (dropdownRect.top - itemRect.top);
              } else if (itemRect.bottom > dropdownRect.bottom) {
                  dropdown.scrollTop += (itemRect.bottom - dropdownRect.bottom);
              }
          },
          resetActiveIndex() {
              this.activeIndex = -1; // Reset active index on mouse hover
          }
      }
  }
  </script> 
          </div>
        
          <!-- Users section -->
          <div class="col-span-full sm:mx-4" data-label="Users" x-show="selectedTab === 'Selected users'">
            <div x-data="getItems()" x-init="label = $el.closest('[data-label]').getAttribute('data-label'); init()">
        <label
            class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
            Select <span x-text="label"></span>
        </label>

    <div class="mt-2">
        <div class="m-y-1 overflow-y-auto max-h-20" x-show="selected.length > 0">
            <ul class="my-2 flex flex-wrap gap-2">
                <template x-for="item in selected" :key="item">
                    <span
                        class="inline-flex items-center py-0.5 pl-2 pr-0.5 rounded-full text-xs font-medium bg-green-100 text-green-700 h-5">
                        <span x-text="item"></span>
                        <button @click="onClick(item)" type="button"
                            class="flex-shrink-0 ml-0.5 h-4 w-4 rounded-full inline-flex items-center justify-center text-green-400 hover:bg-green-200 hover:text-green-500 focus:outline-none focus:bg-green-500 focus:text-white">
                            <span class="sr-only">Remove item</span>
                            <svg class="h-2 w-2" stroke="currentColor" fill="none"
                                viewBox="0 0 8 8">
                                <path stroke-linecap="round" stroke-width="1.5"
                                    d="M1 1l6 6m0-6L1 7" />
                            </svg>
                        </button>
                    </span>
                </template>
            </ul>
        </div>
        <div @click.away="closeDropdown()">
        <!-- Search Input -->
        <input x-model="search" 
        :placeholder="`Search for ${label}`"
            @keydown.window="handleKeyDown($event)" x-on:focus="openDropdown()"
            class="py-2.5 px-3 pe-9 block w-full border-stone-200 rounded-lg text-sm placeholder:text-stone-400 focus:border-green-500 focus:ring-green-500 disabled:opacity-50 disabled:pointer-events-none dark:bg-transparent dark:border-neutral-700 dark:text-neutral-300 dark:placeholder:text-white/60 dark:focus:ring-neutral-600" />

        <!-- Filtered Items Dropdown -->
        <div x-show="dropdownOpen">
            <ul x-ref="dropdown"
                class="my-2 max-h-60 overflow-auto rounded-md py-1 text-base leading-6 shadow-xs focus:outline-none sm:text-sm sm:leading-5 ring-1 ring-black ring-opacity-5"
                @mouseover="resetActiveIndex()">
                <template x-for="(item, index) in filteredItems" :key="item">
                    <li @click="onClick(item)" :class="{
                            'text-green-700': selected.includes(item),
                            'hover:bg-gray-200': !selected.includes(item),
                            'bg-gray-200': index === activeIndex
                        }"
                        class="cursor-pointer text-gray-900 cursor-default select-none relative py-2 pl-3 pr-9">
                        <span x-text="item"></span>
                    </li>
                </template>
                <template x-if="filteredItems.length === 0">
                    <li class="text-gray-500 cursor-default select-none relative py-2 pl-3 pr-9">
                        No items found
                    </li>
                </template>
            </ul>
        </div>
    </div>
    </div>
</div>
<script>
    function getItems() {
      return {
          search: '',
          label: '', // Initialize an empty label; you can set it from the Alpine.js context
    items: [], // Start with an empty array of items

    init() {
      // Set the items array based on the current label
      switch (this.label) {
        case 'Courses':
          this.items = [
            "Bio Chemistry",
            "Anatomy",
            "Pharmacology",
            "Community health",
            "Pathology",
            "General Medicine"
          ];
          break;
        case 'Users':
          this.items = [
            "John Doe",
            "Jane Smith",
            "Alice Johnson",
            "Bob Brown",
            "Charlie Wilson"
          ];
          break;
        case 'Products':
          this.items = [
            "Product A",
            "Product B",
            "Product C",
            "Product D",
            "Product E"
          ];
          break;
        default:
          this.items = [];
      }
    },
          selected: [],
          dropdownOpen: false,
          activeIndex: -1,
          get filteredItems() {
              return this.items.filter(
                  i => i.toLowerCase().startsWith(this.search.toLowerCase())
              );
          },
          onClick(item) {
              if (this.selected.includes(item)) {
                  this.selected = this.selected.filter(p => p !== item);
              } else {
                  this.selected.push(item);
              }
              this.search = ''; // Clear search after selecting an item
          },
          toggleDropdown() {
              this.dropdownOpen = true;
              if (this.dropdownOpen) {
                  this.activeIndex = -1; // Reset active index when opening dropdown
              }
          },
          closeDropdown() {
              console.log("this is the end");
              this.dropdownOpen = false;
              this.activeIndex = -1; // Reset active index when closing dropdown
          },
          openDropdown() {
              this.dropdownOpen = true;
          },
          resetActiveIndex() {
              this.activeIndex = -1; // Reset active index on mouse hover
          },
          handleKeyDown(event) {
              if (this.dropdownOpen) {
                  const dropdown = this.$refs.dropdown;
                  const items = dropdown.querySelectorAll('li');
                  if (event.key === 'ArrowDown') {
                      event.preventDefault();
                      this.activeIndex = (this.activeIndex + 1) % items.length;
                      this.scrollToActiveItem(items[this.activeIndex]);
                  } else if (event.key === 'ArrowUp') {
                      event.preventDefault();
                      this.activeIndex = (this.activeIndex - 1 + items.length) % items.length;
                      this.scrollToActiveItem(items[this.activeIndex]);
                  } else if (event.key === 'Enter') {
                      event.preventDefault();
                      if (this.activeIndex > -1) {
                          this.onClick(this.filteredItems[this.activeIndex]);
                      }
                  }
                  else if (event.key === "Escape") { // For character keys
                      this.closeDropdown();
                  }
                  if (event.key === "Tab") {
                      this.closeDropdown();
                  }
              }
          },
          scrollToActiveItem(item) {
              const dropdown = this.$refs.dropdown;
              const itemRect = item.getBoundingClientRect();
              const dropdownRect = dropdown.getBoundingClientRect();
  
              if (itemRect.top < dropdownRect.top) {
                  dropdown.scrollTop -= (dropdownRect.top - itemRect.top);
              } else if (itemRect.bottom > dropdownRect.bottom) {
                  dropdown.scrollTop += (itemRect.bottom - dropdownRect.bottom);
              }
          },
          resetActiveIndex() {
              this.activeIndex = -1; // Reset active index on mouse hover
          }
      }
  }
  </script> 
          </div>
          
          <div class="col-span-full sm:mx-4" x-show="selectedTab === 'Selected category'">
            <label for="about" class="block text-sm font-medium leading-6 text-gray-900">Select Category</label>
            <select class="mt-2 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
              <option selected="">Residency</option>
              <option>NEETPG/NeXT PG</option>
              <option>BDS/NEET MDS</option>
            </select>
          </div>

          <div class="col-span-full sm:mx-4" x-show="selectedTab === 'Selected category'">
            <label for="about" class="block text-sm font-medium leading-6 text-gray-900">Select Sub-category</label>
            <select class="mt-2 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md">
              <option selected="">Psychiatry</option>
              <option>Anatomy</option>
              <option>Forensics</option>
            </select>
          </div>
        </div>
        </div>
        <div class="mt-6 flex items-center justify-end gap-x-6">
          <button type="button" class="text-sm font-semibold leading-6 text-gray-900">Cancel</button>
          <button type="submit" class="rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">Send</button>
        </div>
      </fieldset>
      
    </div>
  </form>
</div>