<script>
  function paymentsComponent() {
    return {
      payments: [
        {
          transaction_id: 'TXN-2024-001',
          cohort_id: 1,
          cohort_name: 'Fire Safety Training - January 2026',
          amount_paid: 40000,
          approved_workers: 20,
          price_per_worker: 2000,
          payment_date: '2024-01-15',
          order_id: 13
        },
        {
          transaction_id: 'TXN-2024-002',
          cohort_id: 2,
          cohort_name: 'AvSec Awareness - February 2026',
          amount_paid: 60000,
          approved_workers: 30,
          price_per_worker: 2000,
          payment_date: '2024-02-10',
          order_id: 14
        },
        {
          transaction_id: 'TXN-2024-003',
          cohort_id: 3,
          cohort_name: 'Emergency Response - March 2026',
          amount_paid: 30000,
          approved_workers: 15,
          price_per_worker: 2000,
          payment_date: '2024-03-05',
          order_id: 15
        },
        {
          transaction_id: 'TXN-2024-004',
          cohort_id: 4,
          cohort_name: 'Fire Safety Training - April 2026',
          amount_paid: 50000,
          approved_workers: 25,
          price_per_worker: 2000,
          payment_date: '2024-04-20',
          order_id: 16
        },
        {
          transaction_id: 'TXN-2024-005',
          cohort_id: 5,
          cohort_name: 'AvSec Awareness - May 2026',
          amount_paid: 80000,
          approved_workers: 40,
          price_per_worker: 2000,
          payment_date: '2024-05-12',
          order_id: 17
        },
        {
          transaction_id: 'TXN-2024-006',
          cohort_id: 6,
          cohort_name: 'Emergency Response - June 2026',
          amount_paid: 36000,
          approved_workers: 18,
          price_per_worker: 2000,
          payment_date: '2024-06-08',
          order_id: 18
        },
        {
          transaction_id: 'TXN-2024-007',
          cohort_id: 7,
          cohort_name: 'Fire Safety Training - July 2026',
          amount_paid: 42000,
          approved_workers: 21,
          price_per_worker: 2000,
          payment_date: '2024-07-15',
          order_id: 19
        },
        {
          transaction_id: 'TXN-2024-008',
          cohort_id: 8,
          cohort_name: 'AvSec Awareness - August 2026',
          amount_paid: 70000,
          approved_workers: 35,
          price_per_worker: 2000,
          payment_date: '2024-08-22',
          order_id: 20
        },
        {
          transaction_id: 'TXN-2024-009',
          cohort_id: 9,
          cohort_name: 'Emergency Response - September 2026',
          amount_paid: 28000,
          approved_workers: 14,
          price_per_worker: 2000,
          payment_date: '2024-09-10',
          order_id: 21
        },
        {
          transaction_id: 'TXN-2024-010',
          cohort_id: 10,
          cohort_name: 'Fire Safety Training - October 2026',
          amount_paid: 46000,
          approved_workers: 23,
          price_per_worker: 2000,
          payment_date: '2024-10-05',
          order_id: 22
        },
        {
          transaction_id: 'TXN-2024-011',
          cohort_id: 11,
          cohort_name: 'AvSec Awareness - November 2026',
          amount_paid: 54000,
          approved_workers: 27,
          price_per_worker: 2000,
          payment_date: '2024-11-18',
          order_id: 23
        },
        {
          transaction_id: 'TXN-2024-012',
          cohort_id: 12,
          cohort_name: 'Emergency Response - December 2026',
          amount_paid: 32000,
          approved_workers: 16,
          price_per_worker: 2000,
          payment_date: '2024-12-03',
          order_id: 24
        }
      ],
      searchQuery: '',
      showFilterModal: false,
      selectedDateRange: 'all',
      customDateStart: null,
      customDateEnd: null,
      sortField: null,
      sortDirection: 'asc',
      currentPage: 1,
      itemsPerPage: 10,

      get hasActiveFilters() {
        return this.selectedDateRange !== 'all' || this.searchQuery !== '';
      },

      get activeFilterCount() {
        let count = 0;
        if (this.selectedDateRange !== 'all') count++;
        if (this.searchQuery !== '') count++;
        return count;
      },

      get filteredPayments() {
        let filtered = [...this.payments];

        // Apply search filter
        if (this.searchQuery) {
          const query = this.searchQuery.toLowerCase();
          filtered = filtered.filter(payment =>
            payment.transaction_id.toLowerCase().includes(query) ||
            payment.cohort_name.toLowerCase().includes(query)
          );
        }

        // Apply date range filter
        if (this.selectedDateRange !== 'all') {
          const now = new Date();
          const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          filtered = filtered.filter(payment => {
            const paymentDate = new Date(payment.payment_date);
            if (this.selectedDateRange === 'today') {
              return paymentDate >= today;
            }
            if (this.selectedDateRange === 'last-7-days') {
              const sevenDaysAgo = new Date(today);
              sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
              return paymentDate >= sevenDaysAgo;
            }
            if (this.selectedDateRange === 'last-30-days') {
              const thirtyDaysAgo = new Date(today);
              thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
              return paymentDate >= thirtyDaysAgo;
            }
            if (this.selectedDateRange === 'custom' && this.customDateStart && this.customDateEnd) {
              return paymentDate >= new Date(this.customDateStart) && paymentDate <= new Date(this.customDateEnd);
            }
            return true;
          });
        }

        // Apply sorting
        if (this.sortField) {
          filtered.sort((a, b) => {
            let aVal, bVal;
            if (this.sortField === 'amount') {
              aVal = a.amount_paid;
              bVal = b.amount_paid;
            } else if (this.sortField === 'date') {
              aVal = new Date(a.payment_date);
              bVal = new Date(b.payment_date);
            }

            if (this.sortDirection === 'asc') {
              return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
            } else {
              return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
            }
          });
        }

        return filtered;
      },

      get totalPages() {
        return Math.ceil(this.filteredPayments.length / this.itemsPerPage);
      },

      get paginatedPayments() {
        const start = (this.currentPage - 1) * this.itemsPerPage;
        const end = start + this.itemsPerPage;
        return this.filteredPayments.slice(start, end);
      },

      sortBy(field, direction) {
        if (this.sortField === field && this.sortDirection === direction) {
          this.sortField = null;
          this.sortDirection = 'asc';
        } else {
          this.sortField = field;
          this.sortDirection = direction;
        }
        this.currentPage = 1; // Reset to first page when sorting
      },

      previousPage() {
        if (this.currentPage > 1) {
          this.currentPage--;
        }
      },

      nextPage() {
        if (this.currentPage < this.totalPages) {
          this.currentPage++;
        }
      },

      searchPayments() {
        // Search happens automatically via x-model binding
        this.currentPage = 1; // Reset to first page when searching
      },

      clearAllFilters() {
        this.searchQuery = '';
        this.selectedDateRange = 'all';
        this.customDateStart = null;
        this.customDateEnd = null;
        this.currentPage = 1;
      },

      formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        return `${date.getDate()} ${months[date.getMonth()]}, ${date.getFullYear()}`;
      }
    }
  }
</script>