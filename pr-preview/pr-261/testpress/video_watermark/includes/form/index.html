<head>
    <link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet" />
    <script defer src="https://unpkg.com/alpinejs@3.x.x" ></script>
    <style>
        .vjs-watermark {
            position: absolute;
            top: 0;
            left: 100%;
            white-space: nowrap;
            font-weight: bold;
            z-index: 10;
        }
        .vjs-big-play-button {
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            font-size: 3em;
        }

        @keyframes scrollWatermark {
            0% {
                left: 100%;
            }
            50% {
                left: 50%;
            }
            100% {
                left: -50%;
            }
        }
    </style>
    <!-- Include Pickr.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
</head>

<div class="flex w-full flex-wrap">
<form class = "box-border w-full lg:w-1/2 pr-8">
    <div class="space-y-12">
        <div class="border-b border-gray-900/10 pb-12">

            <div class="grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6" id="form-body">
                <div class="sm:col-span-6">
                    <label for="type" class="block text-sm font-medium leading-6 text-gray-900">Watermark Type</label>
                    <div class="mt-2">
                      <select id="type" name="watermark_type" autocomplete="watermark_type" class="block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6 w-full">
                        <option value="dynamic">Dynamic</option>
                        <option value="static">Static</option>
                        <option value="none">None</option>
                      </select>
                    </div>
                </div>

                <div class="sm:col-span-4 hidden">
                    <label for="position" class="block text-sm font-medium leading-6 text-gray-900">Watermark Position</label>
                    <div class="mt-2">
                      <select id="position" name="watermark_position" autocomplete="country-name" class="block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6 w-full">
                        <option value="top-left">Top Left</option>
                        <option value="top-right">Top Right</option>
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-right">Bottom Right</option>
                        <option value="middle">Middle</option>
                      </select>
                    </div>
                </div>

                <div class="sm:col-span-6">
                    <label for="interval" class="block text-sm font-medium leading-6 text-gray-900">Interval (seconds)</label>
                    <div class="mt-2">
                      <input type="number" id="interval" name="watermark_interval" min="1" autocomplete="email" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                    </div>
                </div>
                <div class="sm:col-span-6">
                    <label for="skip" class="block text-sm font-medium leading-6 text-gray-900">Skip (seconds)</label>
                    <div class="mt-2">
                      <input type="number" id="skip" name="watermark_skip" min="1" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                    </div>
                </div>
                <div class="sm:col-span-6">
                    <label for="size" class="block text-sm font-medium leading-6 text-gray-900">Size</label>
                    <div class="mt-2">
                      <input type="number" id="size" name="watermark_size" x-model="size" min="1" max="100" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" @change="setFontSize">
                    </div>
                </div>
                <div class="sm:col-span-4">
                    <label for="color" class="block text-sm font-medium leading-6 text-gray-900">Color & Opacity</label>
                    <div class="mt-2 flex items-center gap-2">
                        <div class="pickr">
                            <button id="color" name="watermark_color" x-model="color" type="button" class="pcr-button" role="button" aria-label="toggle color picker dialog" 
                                style="transition: none; --pcr-color: rgba(3, 164, 235, 1);"  readonly></button>
                        </div>
                        <input type="range" id="opacity" name="watermark_opacity" min="0" max="100"  step="0.5" class="w-full h-2 rounded-lg appearance-none cursor-pointer bg-gray-100 dark:bg-gray-700 border-1"  style="background:linear-gradient(to right, rgba(3, 164, 235, 0) 0%, rgba(3, 164, 235, 1) 100%)">                  
                    </div>
                </div>
           
            </div>
        </div>
        <div class="mt-4 flex items-center justify-end gap-x-6">
            <button type="button" class="text-sm font-semibold leading-6 text-gray-900">Cancel</button>
            <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Save</button>
        </div>
    </div>
</form>
<div class="space-y-12 border-l pl-8">
    <div class="relative w-full truncate rounded-lg shadow-md">
        <video id="my-video" class="video-js vjs-default-skin h-[169px] lg:h-[299px] w-[350px] md:w-[400px] lg:w-[530px]" controls preload="auto" poster="https://www.w3schools.com/html/mov_bbb.jpg" data-setup="{}" height="299px" muted autoplay>
            <source src='http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4' type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
</div>
</div>

    <!-- Video.js CDN -->
    <script src="https://vjs.zencdn.net/7.17.0/video.min.js"></script>
    <script>
        let watermarkText = 'Watermark';
        let type = 'dynamic';
        let position = 'top-left';
        let interval = 5;
        let skip = 3;
        let size = 15;
        let color = '#03A4EB';
        let opacity = 50;
        let positionY = 10;

        const formElements = document.querySelectorAll("#form-body>div");
        const watermarkTypeElement = document.getElementById('type');
        const watermarkPositionElement = document.getElementById('position');
        const watermarkIntervalElement = document.getElementById('interval');
        const watermarkSkipElement = document.getElementById('skip');
        const watermarkSizeElement = document.getElementById('size');
        const watermarkOpacityElement = document.getElementById('opacity');
        watermarkTypeElement.addEventListener('change', (e) => {
            type = e.target.value;
            formElements[4].style.display = "block";
            formElements[5].style.display = "block";
            watermark.style.color = rgbaColor();
            watermark.style.fontSize = `${size}px`;
            if(type === "dynamic"){
                formElements[1].style.display = "none";
                formElements[2].style.display = "block";
                formElements[3].style.display = "block";
                watermark.style = "";
            }else if(type === "static"){
                formElements[1].style.display = "block";
                formElements[2].style.display = "none";
                formElements[3].style.display = "none";
                staticWatermark()
            }else{
                formElements[1].style.display = "none";
                formElements[2].style.display = "none";
                formElements[3].style.display = "none";
                formElements[4].style.display = "none";
                formElements[5].style.display = "none";
                watermark.style = "";
            }
        })
        watermarkPositionElement.addEventListener('change', (e) => {
            position = e.target.value;
            staticWatermark()
        })
        watermarkIntervalElement.addEventListener('change', (e) => {
            interval = Number(e.target.value);
        })
        watermarkSkipElement.addEventListener('change', (e) => {
            skip = Number(e.target.value);
            scrollWatermark()
        })
        watermarkSizeElement.addEventListener('change', (e) => {
            size = e.target.value;
            watermark.style.fontSize = `${size}px`;
        })
        watermarkOpacityElement.addEventListener('change', (e) => {
            opacity = e.target.value;
            watermark.style.color = rgbaColor();
        })

        function setColor(hexaColor) {
            color = hexaColor;
            const red = parseInt(color.slice(1, 3), 16);
            const green = parseInt(color.slice(3, 5), 16);
            const blue = parseInt(color.slice(5, 7), 16);
            
            const gradient = `linear-gradient(to right, rgba(${red}, ${green}, ${blue}, 0) 0%, rgba(${red}, ${green}, ${blue}, 1) 100%)`;

            document.getElementById('opacity').style.background = gradient;
            watermark.style.color = rgbaColor();
        }

        initializeColorPicker()
        function initializeColorPicker() {
            const pickr = Pickr.create({
                el: '.pcr-button',
                theme: 'classic',
                default: 'rgba(3, 164, 235, 1)',
        
                swatches: [
                    'rgba(0, 0, 0, 1)',
                    'rgba(244, 67, 54, 1)',
                    'rgba(255, 255, 255, 1)',
                    'rgba(233, 30, 99, 1)',
                    'rgba(156, 39, 176, 1)',
                    'rgba(103, 58, 183, 1)',
                    'rgba(63, 81, 181, 1)',
                    'rgba(3, 164, 235, 1)',
                    'rgba(0, 150, 136, 1)',
                    'rgba(76, 175, 80, 1)',
                    'rgba(139, 195, 74, 1)',
                    'rgba(205, 220, 57, 1)',
                    'rgba(255, 235, 59, 1)',
                    'rgba(255, 193, 7, 1)'
                ],
        
                components: {
                    preview: true,
                    opacity: false,
                    hue: true,
        
                    interaction: {
                        hex: false,
                        rgba: false,
                        input: true,
                        clear: false,
                        save: false,
                        opacity: false
                    }
                }
            });
            pickr.on('change', (color) => {
                const hexaColor = color.toHEXA().toString();
                document.getElementsByClassName('pcr-button')[0].style = `--pcr-color: ${hexaColor}`;
                setColor(hexaColor);
            });
        }

        function rgbaColor() {
            let hex = color.replace('#', '');
            let r = parseInt(hex.substring(0, 2), 16);
            let g = parseInt(hex.substring(2, 4), 16);
            let b = parseInt(hex.substring(4, 6), 16);
            let a = opacity / 100;
            return `rgba(${r}, ${g}, ${b}, ${a})`;
        }

        (function init() {
            initializePlayer();
        })()

        function initializePlayer() {
            var myplayer = videojs('my-video', {
                controls: true,
                autoplay: true,
                preload: 'auto',
            });

            myplayer.on('ready', () => {
                addScrollingWatermark(myplayer);
            });
        }

        let watermark;

        function addScrollingWatermark(player) {
            watermark = document.createElement('div');
            watermark.classList.add('vjs-watermark');
            watermark.textContent = watermarkText;

            var videoContainer = player.el();
            videoContainer.appendChild(watermark);
            watermark.style.color = rgbaColor();

            scrollWatermark();
        }

        let scrollInterval = null;
        function scrollWatermark() {
            if (scrollInterval !== null) {
                clearInterval(scrollInterval);
            }
            scrollInterval = setInterval(() => {
                if(type !=="dynamic"){
                return;
                }
                watermark.style.animation = 'scrollWatermark ' + interval + 's linear';
                watermark.style.display = 'block';
                watermark.style.top = `${positionY}%`;
                watermark.style.color = rgbaColor();
                watermark.style.fontSize = `${size}px`;

                setTimeout(() => {
                    watermark.style.animation = '';
                }, interval * 1000);
                positionY += 20;
                if (positionY > 100) {
                    positionY = 10;
                }
            }, (interval + skip) * 1000);
        }

        function staticWatermark() {
            watermark.style.animation = "none";
            if(position === "top-left"){
                watermark.style.top = '10%';
                watermark.style.left = '10%';
            }else if(position === "top-right"){
                watermark.style.top = '10%';
                watermark.style.left = '80%';
            }else if(position === "bottom-left"){
                watermark.style.top = '80%';
                watermark.style.left = '10%';
            }else if(position === "bottom-right"){
                watermark.style.top = '80%';
                watermark.style.left = '80%';
            }else{
                watermark.style.top = '50%';
                watermark.style.left = '50%';
            }

        }
    </script>
</form>
