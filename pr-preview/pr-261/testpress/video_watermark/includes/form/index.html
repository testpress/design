<head>
    <link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet" />
    <script defer src="https://unpkg.com/alpinejs@3.x.x" ></script>
    <style>
        .vjs-watermark {
            position: absolute;
            top: 0;
            left: 100%;
            white-space: nowrap;
            font-weight: bold;
            z-index: 10;
        }
        .vjs-big-play-button {
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            font-size: 3em;
        }

        @keyframes scrollWatermark {
            0% {
                left: 100%;
            }
            50% {
                left: 50%;
            }
            100% {
                left: -50%;
            }
        }
    </style>
</head>

<form class="m-5">
    <div class="max-w-lg mx-auto">
        <div class="border-b border-gray-900/10 pb-12">
            <h2 class="text-2xl font-semibold leading-7 text-gray-900 my-5 text-center">Video Watermark Settings</h2>
            <h2 class="text-sm font-medium text-gray-700 mb-4">
                Configure the settings for the watermark that will be displayed on your videos.
            </h2>

            <div x-data="watermarkForm()" class="max-w-lg mx-auto p-4 border border-gray-300 rounded-lg shadow-md bg-white">
                <div class="mb-4">
                    <label for="type" class="block text-sm font-medium text-gray-700">Watermark Type</label>
                    <select id="type" x-model="type" name="watermark_type" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="dynamic">Dynamic</option>
                        <option value="static">Static</option>
                        <option value="none">None</option>
                    </select>
                </div>

                <div x-show="type === 'static'" class="mb-4">
                    <label for="position" class="block text-sm font-medium text-gray-700">Position</label>
                    <select id="position" x-model="position" name="watermark_position" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="top-left">Top Left</option>
                        <option value="top-right">Top Right</option>
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-right">Bottom Right</option>
                        <option value="middle">Middle</option>
                    </select>
                </div>

                <div x-show="type === 'dynamic'" class="mb-4">
                    <label for="interval" class="block text-sm font-medium text-gray-700">Interval (seconds)</label>
                    <input type="number" id="interval" name="watermark_interval" x-model="interval" min="1" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">

                    <label for="skip" class="block mt-4 text-sm font-medium text-gray-700">Skip (seconds)</label>
                    <input type="number" id="skip" name="watermark_skip" x-model="skip" min="1" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div x-show="type !== 'none'" class="mb-4">
                    <label for="size" class="block text-sm font-medium text-gray-700">Size</label>
                    <input type="number" id="size" name="watermark_size" x-model="size" min="1" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                </div>

                <div x-show="type !== 'none'" class="mb-4">
                    <label for="color" class="block text-sm font-medium text-gray-700">Color & Opacity</label>
                    <div class="flex items-center space-x-2 mt-1">
                        <input type="color" id="color" name="watermark_color" x-model="color" class="p-1 w-15 h-12 border border-gray-300 rounded-md shadow-sm">
                        <input type="range" id="opacity" name="watermark_opacity" x-model="opacity" min="0" max="100" class="w-full">
                        <span class="text-sm font-medium text-gray-700" x-text="opacity + '%'"></span>
                    </div>
                </div>

                <div x-show="type !== 'none'" class="mb-4">
                    <label for="preview-video" class="block text-sm font-medium text-gray-700">Watermark Preview</label>

                    <div x-show="type === 'static'" class="relative my-4">
                        <video id="preview-video" class="w-full h-auto rounded-lg shadow-md" controls>
                            <source src="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <div :style="previewStyles" class="absolute font-bold" x-text="watermarkText"></div>
                    </div>

                    <div x-show="type === 'dynamic'" class="my-4 w-full truncate rounded-lg shadow-md">
                        <video id="my-video" class="video-js vjs-default-skin" controls preload="auto" poster="https://www.w3schools.com/html/mov_bbb.jpg" data-setup="{}" height="269px">
                            <source src='http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4' type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>

                <div class="mt-6 flex justify-center">
                    <button type="submit" class="w-full rounded-md bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Submit</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Video.js CDN -->
    <script src="https://vjs.zencdn.net/7.17.0/video.min.js"></script>

    <script>
        function watermarkForm() {
            return {
                watermarkText: 'Watermark',
                type: 'dynamic',
                position: 'top-left',
                interval: 5,
                skip: 3,
                size: 50,
                color: '#ff0000',
                opacity: 50,
                positionY: 0,

                init() {
                    this.initializePlayer();
                },

                get rgbaColor() {
                    let hex = this.color.replace('#', '');
                    let r = parseInt(hex.substring(0, 2), 16);
                    let g = parseInt(hex.substring(2, 4), 16);
                    let b = parseInt(hex.substring(4, 6), 16);
                    let a = this.opacity / 100;
                    return `rgba(${r}, ${g}, ${b}, ${a})`;
                },

                initializePlayer() {
                    var myplayer = videojs('my-video', {
                        controls: true,
                        autoplay: false,
                        preload: 'auto',
                    });

                    myplayer.on('ready', () => {
                        this.addScrollingWatermark(myplayer);
                    });
                },

                addScrollingWatermark(player) {
                    var watermark = document.createElement('div');
                    watermark.classList.add('vjs-watermark');
                    watermark.textContent = this.watermarkText;

                    var videoContainer = player.el();
                    videoContainer.appendChild(watermark);

                    this.scrollWatermark(watermark);
                },

                scrollWatermark(watermarkElement) {
                    setInterval(() => {
                        watermarkElement.style.animation = 'scrollWatermark ' + this.interval + 's linear';
                        watermarkElement.style.display = 'block';
                        watermarkElement.style.top = `${this.positionY}%`;
                        watermarkElement.style.color = this.rgbaColor;
                        watermarkElement.style.fontSize = `${this.size}px`;

                        setTimeout(() => {
                            watermarkElement.style.animation = '';
                        }, this.interval * 1000);
                        this.positionY += 20;
                        if (this.positionY > 100) {
                            this.positionY = 0;
                        }
                    }, (this.interval + this.skip) * 1000);
                },

                get previewStyles() {
                    const positions = {
                      'top-left': { top: '10px', left: '10px' },
                      'top-right': { top: '10px', right: '10px' },
                      'bottom-left': { bottom: '10px', left: '10px' },
                      'bottom-right': { bottom: '10px', right: '10px' },
                      'middle': { top: '50%', left: '50%', transform: 'translate(-50%, -50%)' }
                    };
      
                    const positionStyle = this.type === 'static' ? positions[this.position] : {};
      
                    return {
                      ...positionStyle,
                      fontSize: `${this.size}px`,
                      color: this.rgbaColor,
                    };
                  }
            };
        }
    </script>
</form>
