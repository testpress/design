<script>
  function examComponent() {
    return {
      exam: {
        name: "Real CAT 2025 - Take Home Mock Test 01",
        sections: [
          {
            name: "Quantitative Aptitude",
            duration: 2,
            questions: [
              {
                q_no: 1,
                type: "mcq",
                is_multi_choice:false,
                mark: "1.00",
                negative: "0.25",
                text: "If the cost price of 15 items is equal to the selling price of 12 items, what is the profit percentage?",
                options: ["20%", "25%", "30%", "15%"]
              },
              {
                q_no: 2,
                type: "mcq",
                is_multi_choice:true,
                mark: "1.00",
                negative: "0.25",
                text: "A train 240 m long passes a pole in 24 seconds. What is the speed of the train in km/hr?",
                options: ["36", "54", "72", "90"]
              },
              {
              q_no: 3,
              type: "essay",
              mark: "5.00",
              negative: "0.00",
              text: "Explain the impact of globalization on rural economies in India."
            },
            {
              q_no: 4,
              type: "gap_fill",
              mark: "5.00",
              negative: "0.00",
              text_with_blanks: `
            The [BLANK_1] Revolution was a turning point. It began in [BLANK_2] and changed [BLANK_3]. People moved to [BLANK_4] areas, and innovations like the steam engine revolutionized [BLANK_5].
            `
            },
            {
              q_no: 5,
              type: "match",
              mark: "2.00",
              negative: "0.05",
              text: "Match the countries with their capitals:",
              questions: ["France", "Japan", "India", "Germany"],
              answers: ["Berlin", "Tokyo", "Paris", "New Delhi"] // already in correct order
            },
            {
              q_no: 6,
              type: "file",
              mark: "1.00",
              negative: "0.00",
              text: "Describe the impact of social media on modern communication. Include both positive and negative aspects in your response"
            },
            {
              q_no: 7,
              type: "mcq",
              is_multi_choice: false,
              mark: "1.00",
              negative: "0.25",
              passage: "A train traveling at a speed of 90 km/h takes 2 hours to reach its destination. If the train had traveled at 60 km/h, it would have taken 3 hours. The difference in time is due to the variation in speed.",
              text: "Based on the passage, what is the distance between the starting point and the destination?",
              options: ["120 km", "150 km", "180 km", "210 km"]
            },                   
          {
            "q_no": 8,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "Who wrote the play 'Romeo and Juliet'?",
            "options": ["William Wordsworth", "William Shakespeare", "John Keats", "George Bernard Shaw"]
          },
          {
            "q_no": 9,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "Which element has the chemical symbol 'O'?",
            "options": ["Osmium", "Oxygen", "Gold", "Iron"]
          },
          {
            "q_no": 10,
            "type": "mcq",
            "is_multi_choice": true,
            "mark": "1.00",
            "negative": "0.25",
            "text": "Select all prime numbers from the following.",
            "options": ["2", "4", "5", "9"]
          },
          {
            "q_no": 11,
            "type": "essay",
            "mark": "5.00",
            "negative": "0.00",
            "text": "Discuss the advantages and disadvantages of remote working in the modern economy."
          },
          {
            "q_no": 12,
            "type": "gap_fill",
            "mark": "5.00",
            "negative": "0.00",
            "text_with_blanks": "The [BLANK_1] War ended in [BLANK_2], marking a turning point in [BLANK_3] history."
          },
          {
            "q_no": 13,
            "type": "match",
            "mark": "2.00",
            "negative": "0.05",
            "text": "Match the following scientists with their discoveries:",
            "questions": ["Newton", "Einstein", "Darwin", "Curie"],
            "answers": ["Gravity", "Relativity", "Evolution", "Radioactivity"]
          },
          {
            "q_no": 14,
            "type": "file",
            "mark": "1.00",
            "negative": "0.00",
            "text": "Upload your research report on climate change impacts in your region."
          },
          {
            "q_no": 15,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "Which is the longest river in the world?",
            "options": ["Amazon", "Nile", "Yangtze", "Mississippi"]
          },
          {
            "q_no": 16,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "What gas do plants absorb from the atmosphere?",
            "options": ["Oxygen", "Carbon Dioxide", "Nitrogen", "Hydrogen"]
          },
          {
            "q_no": 17,
            "type": "essay",
            "mark": "5.00",
            "negative": "0.00",
            "text": "Write an essay on the role of technology in modern education."
          },
          {
            "q_no": 18,
            "type": "gap_fill",
            "mark": "5.00",
            "negative": "0.00",
            "text_with_blanks": "The capital of France is [BLANK_1], known for landmarks like the [BLANK_2]."
          },
          {
            "q_no": 19,
            "type": "match",
            "mark": "2.00",
            "negative": "0.05",
            "text": "Match the countries with their currencies:",
            "questions": ["USA", "UK", "Japan", "India"],
            "answers": ["Dollar", "Pound", "Yen", "Rupee"]
          },
          {
            "q_no": 20,
            "type": "file",
            "mark": "1.00",
            "negative": "0.00",
            "text": "Submit a scanned copy of your handwritten notes on photosynthesis."
          },
          {
            "q_no": 21,
            "type": "essay",
            "mark": "5.00",
            "negative": "0.00",
            "text": "Explain the importance of biodiversity and conservation efforts."
          },
          {
            "q_no": 22,
            "type": "gap_fill",
            "mark": "5.00",
            "negative": "0.00",
            "text_with_blanks": "The process of [BLANK_1] involves the conversion of sunlight into [BLANK_2] energy in plants."
          },
          {
            "q_no": 23,
            "type": "match",
            "mark": "2.00",
            "negative": "0.05",
            "text": "Match the following:",
            "questions": ["Python", "Java", "HTML", "SQL"],
            "answers": ["Programming Language", "Object-Oriented Language", "Markup Language", "Database Language"]
          },
          {
            "q_no": 24,
            "type": "file",
            "mark": "1.00",
            "negative": "0.00",
            "text": "Upload a summary of your internship experience."
          },
          {
            "q_no": 25,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "Which is the largest planet in our solar system?",
            "options": ["Earth", "Jupiter", "Mars", "Saturn"]
          },
          {
            "q_no": 26,
            "type": "essay",
            "mark": "5.00",
            "negative": "0.00",
            "text": "Describe the effects of globalization on local cultures."
          },
          {
            "q_no": 27,
            "type": "gap_fill",
            "mark": "5.00",
            "negative": "0.00",
            "text_with_blanks": "[BLANK_1] is known as the Father of the Nation in [BLANK_2]."
          },
          {
            "q_no": 28,
            "type": "match",
            "mark": "2.00",
            "negative": "0.05",
            "text": "Match the following:",
            "questions": ["H2O", "CO2", "NaCl", "O2"],
            "answers": ["Water", "Carbon Dioxide", "Salt", "Oxygen"]
          },
          {
            "q_no": 29,
            "type": "file",
            "mark": "1.00",
            "negative": "0.00",
            "text": "Provide an image or scan of your solution to the assigned problem."
          },
          {
            "q_no": 30,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "What is the freezing point of water?",
            "options": ["0°C", "32°C", "100°C", "273°C"]
          },
          {
            "q_no": 31,
            "type": "essay",
            "mark": "5.00",
            "negative": "0.00",
            "text": "Analyze the impact of social media on human communication."
          },
          {
            "q_no": 32,
            "type": "gap_fill",
            "mark": "5.00",
            "negative": "0.00",
            "text_with_blanks": "The [BLANK_1] Revolution transformed [BLANK_2] societies with machinery."
          },
          {
            "q_no": 33,
            "type": "match",
            "mark": "2.00",
            "negative": "0.05",
            "text": "Match the following:",
            "questions": ["Newton", "Einstein", "Darwin", "Curie"],
            "answers": ["Gravity", "Relativity", "Evolution", "Radioactivity"]
          },
          {
            "q_no": 34,
            "type": "file",
            "mark": "1.00",
            "negative": "0.00",
            "text": "Submit a PDF report of your mini project work."
          },
          {
            "q_no": 35,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "Who painted the Mona Lisa?",
            "options": ["Michelangelo", "Leonardo da Vinci", "Van Gogh", "Picasso"]
          },
          {
            "q_no": 36,
            "type": "essay",
            "mark": "5.00",
            "negative": "0.00",
            "text": "Discuss the ethical implications of artificial intelligence."
          },
          {
            "q_no": 37,
            "type": "gap_fill",
            "mark": "5.00",
            "negative": "0.00",
            "text_with_blanks": "In [BLANK_1], the [BLANK_2] Agreement was signed to reduce carbon emissions."
          },
          {
            "q_no": 38,
            "type": "match",
            "mark": "2.00",
            "negative": "0.05",
            "text": "Match the following countries with their capitals:",
            "questions": ["France", "India", "Germany", "Japan"],
            "answers": ["Paris", "New Delhi", "Berlin", "Tokyo"]
          },
          {
            "q_no": 39,
            "type": "file",
            "mark": "1.00",
            "negative": "0.00",
            "text": "Attach a copy of your research paper draft."
          },
          {
            "q_no": 40,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "Which ocean is the largest?",
            "options": ["Atlantic", "Indian", "Pacific", "Arctic"]
          },
          {
            "q_no": 41,
            "type": "essay",
            "mark": "5.00",
            "negative": "0.00",
            "text": "Evaluate the pros and cons of nuclear energy."
          },
          {
            "q_no": 42,
            "type": "gap_fill",
            "mark": "5.00",
            "negative": "0.00",
            "text_with_blanks": "The [BLANK_1] is the largest organ in the human body and helps in [BLANK_2]."
          },
          {
            "q_no": 43,
            "type": "match",
            "mark": "2.00",
            "negative": "0.05",
            "text": "Match the following instruments to their types:",
            "questions": ["Guitar", "Piano", "Flute", "Drums"],
            "answers": ["String", "Keyboard", "Wind", "Percussion"]
          },
          {
            "q_no": 44,
            "type": "file",
            "mark": "1.00",
            "negative": "0.00",
            "text": "Upload your written reflection on this week’s lecture topic."
          },
          {
            "q_no": 45,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "What gas do humans need to breathe in to survive?",
            "options": ["Nitrogen", "Oxygen", "Carbon Dioxide", "Hydrogen"]
          },
          {
            "q_no": 46,
            "type": "essay",
            "mark": "5.00",
            "negative": "0.00",
            "text": "Write an essay on the importance of financial literacy."
          },
          {
            "q_no": 47,
            "type": "gap_fill",
            "mark": "5.00",
            "negative": "0.00",
            "text_with_blanks": "The human heart has [BLANK_1] chambers and pumps [BLANK_2] throughout the body."
          },
          {
            "q_no": 48,
            "type": "match",
            "mark": "2.00",
            "negative": "0.05",
            "text": "Match the following inventions with their inventors:",
            "questions": ["Telephone", "Light Bulb", "Airplane", "Computer"],
            "answers": ["Bell", "Edison", "Wright Brothers", "Charles Babbage"]
          },
          {
            "q_no": 49,
            "type": "file",
            "mark": "1.00",
            "negative": "0.00",
            "text": "Upload your assignment submission in PDF format."
          },
          {
            "q_no": 50,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "Which country is known as the Land of the Rising Sun?",
            "options": ["China", "South Korea", "Japan", "Thailand"]
          },
          {
            "q_no": 51,
            "type": "essay",
            "mark": "5.00",
            "negative": "0.00",
            "text": "Explain the role of women in India's freedom struggle."
          },
          {
            "q_no": 52,
            "type": "gap_fill",
            "mark": "5.00",
            "negative": "0.00",
            "text_with_blanks": "The first man to walk on the moon was [BLANK_1] in the year [BLANK_2]."
          },
          {
            "q_no": 53,
            "type": "match",
            "mark": "2.00",
            "negative": "0.05",
            "text": "Match the authors to their famous works:",
            "questions": ["J.K. Rowling", "Tolstoy", "Homer", "George Orwell"],
            "answers": ["Harry Potter", "War and Peace", "The Iliad", "1984"]
          },
          {
            "q_no": 54,
            "type": "file",
            "mark": "1.00",
            "negative": "0.00",
            "text": "Submit your audio recording for the speaking assessment."
          },
          {
            "q_no": 55,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "Which blood group is known as the universal donor?",
            "options": ["A", "B", "O", "AB"]
          },
          {
            "q_no": 56,
            "type": "essay",
            "mark": "5.00",
            "negative": "0.00",
            "text": "Write about the effects of deforestation on the environment."
          },
          {
            "q_no": 57,
            "type": "gap_fill",
            "mark": "5.00",
            "negative": "0.00",
            "text_with_blanks": "The Great Wall of [BLANK_1] was built to protect against invasions."
          },
          {
            "q_no": 58,
            "type": "match",
            "mark": "2.00",
            "negative": "0.05",
            "text": "Match the countries with their national animals:",
            "questions": ["India", "Australia", "USA", "Russia"],
            "answers": ["Tiger", "Kangaroo", "Bald Eagle", "Bear"]
          },
          {
            "q_no": 59,
            "type": "file",
            "mark": "1.00",
            "negative": "0.00",
            "text": "Upload your coding assignment zip file."
          },
          {
            "q_no": 60,
            "type": "mcq",
            "is_multi_choice": false,
            "mark": "1.00",
            "negative": "0.25",
            "text": "Which planet has the most moons?",
            "options": ["Jupiter", "Saturn", "Uranus", "Neptune"]
          }

 
            ]
          },
          {
            name: "Verbal Ability & Reading Comprehension",
            duration: 1,
            questions: [
              {
                q_no: 1,
                type: "mcq",
                mark: "1.00",
                negative: "0.25",
                text: "Choose the most appropriate word to fill in the blank: Despite the odds, she remained ___ throughout the ordeal.",
                options: ["placid", "desperate", "resilient", "apathetic"]
              },
              {
                q_no: 2,
                type: "mcq",
                mark: "1.00",
                negative: "0.25",
                text: "Identify the grammatically correct sentence.",
                options: [
                  "Each of the players have a unique skill.",
                  "Neither the manager nor his assistants was available.",
                  "He don’t like going to the gym.",
                  "There is many reasons for this conclusion."
                ]
              }
            ]
          },
          {
            name: "Data Interpretation & Logical Reasoning",
            duration: 1,
            questions: [
                {
                  q_no: 1,
                  type: "mcq",
                  mark: "1.00",
                  negative: "0.25",
                  text: "Five friends—A, B, C, D, and E—are sitting in a row. A is to the immediate right of B but not next to E. Who is sitting in the middle if C is at one end?",
                  options: ["A", "B", "D", "E"]
                },
                {
                  q_no: 2,
                  type: "mcq",
                  mark: "1.00",
                  negative: "0.25",
                  text: "In a certain code, if BOOK is coded as 43 and PEN as 35, then what is the code for COPY?",
                  options: ["56", "62", "59", "65"]
                }
              ]
          },
        ],
      },

      currentSectionIndex: 0,
      currentQuestionIndex: 0,
      totalSeconds: 0,
      interval: null,
      isLocked: false,
      selectedOption: [],
      essayDraft: '',
      show_exam_ended_modal :false,
      responses: {},
      gapFillAnswers: [],
      matchAnswers: [],
      uploaded_files: [],

      get currentSection() {
        return this.exam.sections[this.currentSectionIndex];
      },

      get currentQuestion() {
        return this.currentSection.questions[this.currentQuestionIndex];
      },

      get formattedTime() {
        const mins = Math.floor(this.totalSeconds / 60).toString().padStart(2, '0');
        const secs = (this.totalSeconds % 60).toString().padStart(2, '0');
        return `${mins}:${secs}`;
      },

      startTimer() {
      this.totalSeconds = this.currentSection.duration * 60;
      this.isLocked = true;

      const tick = () => {
        if (this.totalSeconds > 0) {
          this.totalSeconds--;
          this.timeout = setTimeout(tick, 1000);
        } else {
          this.moveToNextSection();
        }
      };

      // Clear previous timeout if any
      if (this.timeout) clearTimeout(this.timeout);
      tick(); // Start ticking
    },


      selectSection(index) {
        if (index !== this.currentSectionIndex && this.isLocked) return;
        this.currentSectionIndex = index;
        this.currentQuestionIndex = 0;
        this.startTimer();
        this.goToQuestion(0);
      },

      isActive(index) {
        return this.currentSectionIndex === index;
      },

      initUploadFile() {
      window.addEventListener('load', () => {
        const instance = HSFileUpload.getInstance('#file-upload', true);
        if (!instance) return;

        const { element } = instance;
        const { dropzone } = element;

        dropzone.on('complete', () => {
          this.uploaded_files = ['mock-upload'];
        });
      });
     },



      goToQuestion(index) {
        this.currentQuestionIndex = index;
        const sectionKey = this.currentSection.name;
        const questionKey = this.currentQuestion.q_no;

        if (!this.responses[sectionKey]) this.responses[sectionKey] = {};
        if (!this.responses[sectionKey][questionKey]) {
          this.responses[sectionKey][questionKey] = { selected: null, visited: true, markedForReview: false };
        } else {
          this.responses[sectionKey][questionKey].visited = true;
        }
        if (this.currentQuestion.type === 'mcq') {
          const saved = this.responses[sectionKey][questionKey]?.selected;
          this.selectedOption = saved ?? [];
        }

        if (this.currentQuestion.type === 'essay') {
          const saved = this.responses[sectionKey][questionKey]?.text;
          this.essayDraft = saved ?? '';
        }
        if (this.currentQuestion.type === 'gap_fill') {
          const sectionKey = this.currentSection.name;
          const questionKey = this.currentQuestion.q_no;

          const blankCount = (this.currentQuestion.text_with_blanks.match(/\[BLANK_\d+\]/g) || []).length;

          const saved = this.responses[sectionKey]?.[questionKey]?.answers;
          this.gapFillAnswers = saved ? [...saved] : Array(blankCount).fill('');
        }
        if (this.currentQuestion.type === 'match') {
          const blanks = this.currentQuestion.questions.length;
          this.matchAnswers = Array(blanks).fill('');

          const saved = this.responses[this.currentSection.name]?.[this.currentQuestion.q_no]?.matches;
          if (saved) this.matchAnswers = [...saved];
       }

      },
      

      saveMCQAnswer() {
        const sectionKey = this.currentSection.name;
        const questionKey = this.currentQuestion.q_no;

        if (!this.responses[sectionKey]) this.responses[sectionKey] = {};

        this.responses[sectionKey][questionKey] = {
          selected: this.selectedOption,
          markedForReview: false,
          visited: true
        };
      },

      saveEssayAnswer() {
        if(this.essayDraft == ''){
          this.essayDraft =  null;
        }
        const sectionKey = this.currentSection.name;
        const questionKey = this.currentQuestion.q_no;

        if (!this.responses[sectionKey]) this.responses[sectionKey] = {};
        this.responses[sectionKey][questionKey] = {
          text: this.essayDraft,
          markedForReview: false,
          visited: true
        };
      },

      saveGapFillAnswer() {
        const sectionKey = this.currentSection.name;
        const questionKey = this.currentQuestion.q_no;

        if (!this.responses[sectionKey]) this.responses[sectionKey] = {};
        this.responses[sectionKey][questionKey] = {
          answers: [...this.gapFillAnswers],
          visited: true
        };
      },

      saveMatchAnswer() {
        const sectionKey = this.currentSection.name;
        const questionKey = this.currentQuestion.q_no;

        if (!this.responses[sectionKey]) this.responses[sectionKey] = {};

        this.responses[sectionKey][questionKey] = {
          matches: this.matchAnswers.slice(),
          markedForReview: false,
          visited: true
        };
       },

       saveFileAnswer() {
        const sectionKey = this.currentSection.name;
        const questionKey = this.currentQuestion.q_no;

        if (!this.responses[sectionKey]) this.responses[sectionKey] = {};

        this.responses[sectionKey][questionKey] = {
          uploaded_files: this.uploaded_files,
          markedForReview: false,
          visited: true
        };
       },


       saveCurrentAnswer() {
        const type = this.currentQuestion.type;

        if (type === 'mcq') this.saveMCQAnswer();
        else if (type === 'essay') this.saveEssayAnswer();
        else if (type === 'gap_fill') this.saveGapFillAnswer();
        else if (type === 'match') this.saveMatchAnswer();
        else if (type === 'file') this.saveFileAnswer();
       },

      getGapFillHTML() {
      if (this.currentQuestion.type !== 'gap_fill') return '';

      const text = this.currentQuestion.text_with_blanks;
      const blanks = (text.match(/\[BLANK_\d+\]/g) || []).length;

      // Ensure gapFillAnswers array is initialized
      if (this.gapFillAnswers.length !== blanks) {
        this.gapFillAnswers = Array(blanks).fill('');
      }

      const parts = text.split(/\[BLANK_\d+\]/g);

      // Build HTML string using Alpine-compatible bindings
      return parts.map((part, index) => {
        const input = index < blanks
          ? `<input x-model='gapFillAnswers[${index}]' type='text' class='inline-block h-6 min-w-36 align-middle w-20 px-2 py-1 text-sm border border-gray-300 rounded-md placeholder:text-gray-400 focus:border-emerald-500 focus:ring-emerald-500' placeholder='answer here' />`
          : '';
        return `${part}${input}`;
      }).join('');
    },

      markForReview() {
        const sectionKey = this.currentSection.name;
        const questionKey = this.currentQuestion.q_no;

        if (!this.responses[sectionKey]) this.responses[sectionKey] = {};
        if (!this.responses[sectionKey][questionKey]) {
          this.responses[sectionKey][questionKey] = { selected: null, visited: true };
        }
        this.responses[sectionKey][questionKey].markedForReview = true;
      },

      getQuestionStatus(sectionName, q_no) {
        const resp = this.responses[sectionName]?.[q_no];
        if (!resp) return 'not_visited';
        if (resp.markedForReview) return 'review';
        if (
          (resp.selected && resp.selected.length > 0) ||
          resp.text != null ||
          (resp.answers && resp.answers.some(ans => ans.trim() !== "")) ||
          (resp.matches && resp.matches.some(match => match.trim() !== "")) ||
          (resp.uploaded_files && resp.uploaded_files.length > 0)
        )
          return 'answered';

        return 'visited';
      },

      get currentSectionStats() {
        const sectionKey = this.currentSection.name;
        const total = this.currentSection.questions.length;
        let answered = 0, visited = 0, notVisited = 0, review = 0;

        for (let q of this.currentSection.questions) {
          const status = this.getQuestionStatus(sectionKey, q.q_no);
          if (status === 'answered') answered++;
          else if (status === 'review') review++;
          else if (status === 'visited') visited++;
          else if (status === 'not_visited') notVisited++;
        }

        return { total, answered, visited, notVisited, review };
      },

      moveToNextSection() {
        if (this.currentSectionIndex < this.exam.sections.length - 1) {
          this.currentSectionIndex++;
          this.currentQuestionIndex = 0;
          this.startTimer();
          this.goToQuestion(0);
        } else {
          this.isLocked = false;
          this.show_exam_ended_modal = true;
        }
      },

      clearResponse() {
        const sectionKey = this.currentSection.name;
        const questionKey = this.currentQuestion.q_no;

        if (this.responses[sectionKey]?.[questionKey]) {
          delete this.responses[sectionKey][questionKey];
        }

        this.responses[sectionKey][questionKey] = {
          visited: true,
          markedForReview: false
        };

        // Reset local UI state
        this.selectedOption = [];
        this.essayDraft = '';
        this.gapFillAnswers = [];
        this.matchAnswers = [];
      },
    }
  }
</script>