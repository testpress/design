<script>
  function feedbacks_filter_components(){
    return {
      showMobileFilter:false,
      courses : JSON.parse('[{"id":1,"name":"General Studies Program","fee":"2,500.00","discount":"200.00","total":"2,300.00"},{"id":2,"name":"Free Learning Path - Beginners","fee":"0.00","discount":"0.00","total":"0.00"},{"id":3,"name":"UPSC Comprehensive Program - 2024","fee":"15,000.00","discount":"1,500.00","total":"13,500.00"},{"id":4,"name":"2023 Mains Crash Course","fee":"5,000.00","discount":"500.00","total":"4,500.00"},{"id":1,"title":"Introduction to Programming"},{"id":2,"title":"Data Structures and Algorithms"},{"id":3,"title":"Web Development"},{"id":4,"title":"Machine Learning"},{"id":5,"title":"Database Management"},{"id":6,"title":"Computer Networks"},{"id":7,"title":"Software Engineering"},{"id":8,"title":"Artificial Intelligence"},{"id":9,"title":"Cybersecurity"},{"id":10,"title":"Mobile App Development"}]'),
      ratings : JSON.parse('[{"id":1,"title":"5"},{"id":2,"title":"4"},{"id":3,"title":"3"},{"id":4,"title":"2"},{"id":5,"title":"1"}]'),
      contentTypes : JSON.parse('[{"id":1,"title":"Exams"},{"id":2,"title":"Quizes"},{"id":3,"title":"Videos"},{"id":4,"title":"Notes"},{"id":5,"title":"Attachments"},{"id":5,"title":"Video conferences"},{"id":5,"title":"Live classes"}]'),
      hoverRating:0,
      selected_filters:[],
      showRatingFilter:false,
      showCourseFilter:false,
      showContentTypeFilter:false,
      active_filters: null,
      initialize_selected_filter() {
        const searchParams = new URLSearchParams(window.location.search);

        for (let [key, value] of searchParams) {
          let filterItem;
          let type;
          this.active_filters = Array.from(searchParams.entries()).length;

          switch(key) {
            case 'course':
              filterItem = this.courses.find(item => item.id === parseInt(value));
              type = 'course';
              break;
            case 'rating':
              filterItem = this.ratings.find(item => item.id === parseInt(value));
              type = 'rating';
              break;
            case 'content type':
              filterItem = this.contentTypes.find(item => item.id === parseInt(value));
              type = 'content type';
              break;
          }
          if (filterItem) {
            filterItem.type = type;
            this.selected_filters.push(filterItem);
          }
        }
      },

      isItemSelected(item, type) {
        return this.selected_filters.some(e => e.id === item.id && e.type === type);
      },

      addToSelectedFilter(filter, type){
        if (this.isItemSelected(filter,type)){
          return
        }
        console.log(filter, type)
        filter.type = type;
        this.selected_filters.push(filter)
      },

      removeSelectedFilter(filter) {
        this.selected_filters = this.selected_filters.filter(item => item.id !== filter.id || item.type !== filter.type);
      },

      submitFeedbacksFilter(){
        const params = this.selected_filters.map(filter => `${filter.type}=${filter.id}`).join('&');
        window.location.href = `${window.location.origin}${window.location.pathname}?${params}`;
      }
    }
  };
</script>
