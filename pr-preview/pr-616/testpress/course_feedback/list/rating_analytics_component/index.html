<script src="https://preline.co/pro/assets/vendor/lodash/lodash.min.js"></script>
<script src="https://preline.co/pro/assets/vendor/apexcharts/dist/apexcharts.min.js"></script>
<script src="https://preline.co/pro/assets/js/hs-apexcharts-helpers.js"></script>


<script>
  window.addEventListener('load', () => {
    // Apex Bar Chart
    (function () {
      buildChart('#rating-chart', (mode) => ({
        chart: {
          type: 'bar',
          height: 350,
          toolbar: {
            show: false
          },
          zoom: {
            enabled: false
          }
        },
        series: [
          {
            name: 'Responses',
            data: [82, 48, 18, 6, 2]
          }
        ],
        fill: {
          pattern: {
            width: 6,
            height: 6,
            strokeWidth: 2
          }
        },
        grid: {
          strokeDashArray: 3,
        },
        plotOptions: {
          bar: {
            horizontal: false,
            columnWidth: '95%',
            borderRadius: 2,
          }
        },
        legend: {
          show: false
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          show: true,
          width: 3,
          colors: ['transparent']
        },
        xaxis: {
          categories: [
            '5 Star',
            '4 Stars',
            '3 Stars',
            '2 Stars',
            '1 Star'
          ],
          axisBorder: {
            show: false
          },
          axisTicks: {
            show: false
          },
          crosshairs: {
            show: false
          },
          labels: {
            style: {
              colors: 'oklch(0.707 0.022 261.325)',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            offsetX: -2
          }
        },
        yaxis: {
          labels: {
            align: 'left',
            minWidth: 0,
            maxWidth: 140,
            style: {
              colors: 'oklch(0.707 0.022 261.325)',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            formatter: (value) => value >= 1000 ? `${value / 1000}k` : value
          }
        },
        tooltip: {
          custom: function (props) {
            const { categories } = props.ctx.opts.xaxis;
            const { dataPointIndex } = props;

            return buildTooltip(props, {
              title: categories[dataPointIndex],
              mode,
              hasCategory: false,
              hasTextLabel: true,
              wrapperExtClasses: 'min-w-28',
              labelDivider: ':',
              labelExtClasses: 'ms-2',
              valuePrefix: '',
            });
          }
        },
        states: {
          hover: {
            filter: {
              type: 'darken',
              value: 0.9
            }
          }
        },
        responsive: [{
          breakpoint: 568,
          options: {
            chart: {
              height: 300
            },
            stroke: {
              width: 8
            },
            responsive: [{
              breakpoint: 568,
              options: {
                chart: {
                  height: 300
                },
                stroke: {
                  width: 8
                },
                labels: {
                  style: {
                    colors: 'oklch(0.707 0.022 261.325)',
                    fontSize: '11px',
                    fontFamily: 'Inter, ui-sans-serif',
                    fontWeight: 400
                  },
                  offsetX: -2
                },
                yaxis: {
                  labels: {
                    align: 'left',
                    minWidth: 0,
                    maxWidth: 140,
                    style: {
                      colors: 'oklch(0.707 0.022 261.325)',
                      fontSize: '11px',
                      fontFamily: 'Inter, ui-sans-serif',
                      fontWeight: 400
                    },
                    formatter: (value) => value >= 1000 ? `${value / 1000}k` : value
                  }
                },
              },
            }]
          },
        }]
      }), {
        colors: [
          'oklch(0.55 0.25 250)'
        ],
        grid: {
          borderColor: 'oklch(0.928 0.006 264.531)'
        },
        xaxis: {
          labels: {
            style: {
              colors: 'oklch(0.707 0.022 261.325)'
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: 'oklch(0.707 0.022 261.325)'
            }
          }
        }
      }, {
        colors: [
          'oklch(0.55 0.25 250)'
        ],
        grid: {
          borderColor: 'oklch(0.371 0 0)'
        },
        xaxis: {
          labels: {
            style: {
              colors: 'oklch(0.556 0 0)',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: 'oklch(0.556 0 0)'
            }
          }
        }
      });
    })();
  });
</script>
<script>
  window.addEventListener('load', () => {
    // Apex Curved Line Charts
    (function () {
      const responsesData = [12, 18, 22, 25, 28, 31, 20]; // update this array as needed
      const maxResponse = Math.max(...responsesData);
      // Always show up to 8 y-axis ticks, rounded up to nearest 5 or 10
      let step;
      if (maxResponse <= 40) {
        step = 5;
      } else if (maxResponse <= 80) {
        step = 10;
      } else {
        step = Math.ceil(maxResponse / 8 / 5) * 5;
      }
      const maxY = Math.ceil(maxResponse / step) * step;
      const tickAmount = Math.min(8, Math.floor(maxY / step));

      buildChart('#rating-over-time', (mode) => ({
        chart: {
          height: 300,
          type: 'line',
          toolbar: {
            show: false
          },
          zoom: {
            enabled: false
          }
        },
        series: [
          {
            name: 'Average Rating',
            data: [3.8, 4.0, 4.2, 4.1, 4.4, 4.5, 4.3]
          },
          {
            name: 'Responses',
            data: responsesData
          }
        ],
        dataLabels: {
          enabled: false
        },
        stroke: {
          curve: 'smooth',
          width: [4, 4],
          dashArray: [0, 10] // solid for blue, dashed for green
        },
        title: {
          show: false
        },
        legend: {
          show: false
        },
        xaxis: {
          type: 'category',
          categories: [
            'Week 1',
            'Week 2',
            'Week 3',
            'Week 4',
            'Week 5',
            'Week 6',
            'Week 7'
          ],
          axisBorder: {
            show: false
          },
          axisTicks: {
            show: false
          },
          tooltip: {
            enabled: false
          },
          labels: {
            show: true,
            style: {
              colors: 'oklch(0.707 0.022 261.325)',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            offsetX: 2,
            offsetY: 4,

            // Show all week labels
            formatter: function (value, index) {
              return value;
            }
          }
        },
        yaxis: {
          min: 0,
          max: maxY,
          tickAmount: tickAmount,
          labels: {
            align: 'left',
            minWidth: 0,
            maxWidth: 140,
            style: {
              colors: 'oklch(0.707 0.022 261.325)',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            offsetX: -2,
            formatter: (value) => {
              // Show only multiples of step up to maxY, max 8 values
              if (value % step === 0 && value <= maxY) return value;
              return '';
            }
          }
        },
        tooltip: {
          custom: function (props) {
            const { categories } = props.ctx.opts.xaxis;
            const { dataPointIndex } = props;
            const title = categories[dataPointIndex];

            return buildTooltip(props, {
              title: title,
              mode,
              hasTextLabel: true,
              wrapperExtClasses: 'min-w-36',
              labelDivider: ':',
              labelExtClasses: 'ms-2',
              valuePrefix: '',
            });
          }
        },
      }), {
        colors: ['#2563EB', '#22c55e'], // blue for Average Rating, green for Responses
        xaxis: {
          labels: {
            style: {
              colors: '#9ca3af',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#9ca3af'
            }
          }
        },
        grid: {
          borderColor: '#e5e7eb'
        }
      }, {
        colors: ['#3b82f6', '#22c55e'],
        xaxis: {
          labels: {
            style: {
              colors: '#a3a3a3',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#a3a3a3'
            }
          }
        },
        grid: {
          borderColor: '#404040'
        }
      });
    })();
  });
</script>