<script>
  function assigneeData(multiple = true) {
  return {
      selectedItems: [],
      showSearchResults: true,
      showAddAssigneeInputBox: false,
      multiple: multiple,
  
      isItemSelected(item) {
      return this.selectedItems.some(e => e.id === item.id)
      },
  
      onItemSelect(selectedItem) {
      if (this.isItemSelected(selectedItem)) {
          this.removeItem(selectedItem)
      } else {
          if (!this.multiple) {
          this.selectedItems.pop();
          }
          this.selectedItems.push(selectedItem)
      }
      },
  
      removeItem(itemToRemove) {
      this.selectedItems = this.selectedItems.filter(item => item.id !== itemToRemove.id)
      },
  
      items: [
      {
          id: 1,
          display_name: "John Corlos",
          image_url: "https://i.pravatar.cc/256?img=1"
      },
      {
          id: 2,
          display_name: "Karthik",
          image_url: "https://i.pravatar.cc/256?img=2"
      },
      {
          id: 3,
          display_name: "Logesh",
          image_url: "https://i.pravatar.cc/256?img=3"
      },
      {
          id: 4,
          display_name: "Hari",
          image_url: "https://i.pravatar.cc/256?img=4"
      },
      {
          id: 5,
          display_name: "Dinesh",
          image_url: "https://i.pravatar.cc/256?img=5"
      },
      {
          id: 6,
          display_name: "Sarath",
          image_url: "https://i.pravatar.cc/256?img=6"
      },
      {
          id: 7,
          display_name: "Bharath",
          image_url: "https://i.pravatar.cc/256?img=7"
      },
      {
          id: 8,
          display_name: "Dominic",
          image_url: "https://i.pravatar.cc/256?img=8"
      }],
  }
  }
  
  function doubtsComponent() {
    return {
        open: false,
        showLoading:false,
        fetchingDoubtDetail:false,
        showAddAssigneeInputBox: false,
        showsimilarQs:false,
        showRelatedDoubtsList: false,
        selectedDoubtId: null,
        isContentFetched: false,
        fetchedDetailIds: {},

        fetchAndShowRelatedDoubtsList() {
            if (this.isContentFetched) {
                this.showsimilarQs = true;
                this.showRelatedDoubtsList = true;
                return;
            }
            this.showLoading = true;
            setTimeout(() => {
                fetch('/doubts/partials/related_doubts_list_modal/')
                    .then(response => response.text())
                    .then(html => {
                        this.$refs.relatedDoubtList.innerHTML = html;
                        this.showsimilarQs = true;
                        this.showRelatedDoubtsList = true;
                        this.isContentFetched = true;
                    })
                    .finally(() => {
                        this.showLoading = false;
                    });
            }, 1000);
        },

        fetchAndShowDoubtDetail(id) {
            if (this.fetchedDetailIds[id]) {
                this.showsimilarQs = true;
                this.showRelatedDoubtsList = false;
                this.selectedDoubtId = id;
                return;
            }
            this.showsimilarQs = false;
            this.showRelatedDoubtsList = false;
            this.showLoading = true;
            this.fetchingDoubtDetail = true;

            setTimeout(() => {
            fetch('/doubts/partials/related_doubt_detail_modal/')
                .then(response => response.text())
                .then(html => {
                    const refName = 'relatedDoubtDetail_'+ id;
                    this.$refs[refName].innerHTML = html;
                    this.showsimilarQs = true;
                    this.selectedDoubtId = id;
                    this.fetchedDetailIds[id] = true;
                })
                .finally(() => {
                    this.showLoading = false;
                    this.fetchingDoubtDetail = false;
                });
        }, 1000);
    },

        getDoubtById(id){
            let doubts = JSON.parse('[{"id":1,"title":"Basic Maths","description":"Is there any other way to do this or is this the right way?","reported_by":"Nisma Abdul Azeez","time_created":"7 minutes ago","image_src":"https://images.unsplash.com/photo-1550525811-e5869dd03032?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","follow_ups":[{"id":101,"comment":"No we can do it in alternative ways but make sure it does not affect the expected result","image_src":"https://images.unsplash.com/photo-1519244703995-f4e0f30006d5?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","commented_by":"admin"},{"id":110,"comment":"The Pythagorean Theorem states that in a right-angled triangle, the square of the length of the hypotenuse (the side opposite the right angle) is equal to the sum of the squares of the lengths of the other two sides.","image_src":"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","commented_by":"Suresh"}]},{"id":2,"title":"Current Electricity Study Material","description":"Level 1 Q.no 15 - Answer option 2 is correct, but can you explain the steps?","reported_by":"Arsha R G","time_created":"14 minutes ago","image_src":"https://d1j3vi2u94ebt0.cloudfront.net/institute/brilliantpalalms/user_profiles/102547/8ae89c3a6f0445ad9a8ea2827c307090.jpeg","follow_ups":[{"id":101,"comment":"How is the ratio of velocity of red colour light to velocity of violet colour of light in vaccum equal to 1?","commented_by":"Math Expert","image_src":"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"}]},{"id":3,"title":"Organism and Population","description":"Why is biotic community the answer and not ecological niche?","reported_by":"Shamseena Ali","time_created":"22 minutes ago","image_src":"https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","follow_ups":[{"id":101,"comment":"A rod of length 1000mm and coeficient of linear expansion degree celcius is placed symmetrically between two fixed supports srperated by 1001mm. The youngs modulus of rod is10^11N/m2.If the temperature is increased by 20 degree celcius then stress developed in the rod is","commented_by":"Math Expert","image_src":"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"}]},{"id":4,"title":"Geometry Problem","description":"Unable to solve this question about four square lamina.","reported_by":"Naveena Santhosh Reshma Gopi","image_src":"https://d1j3vi2u94ebt0.cloudfront.net/institute/brilliantpalalms/user_profiles/33570/7ffc26423ee54a82bcf247e832c46f8f.jpg","time_created":"22 minutes ago","follow_ups":[{"id":101,"comment":"Benzene is a fundamental building block in organic chemistry, characterized by its simple yet stable ring structure. Comprising six carbon atoms connected in a planar hexagonal ring, it possesses alternating double bonds, a configuration known as aromaticity.","commented_by":"Math Expert","image_src":"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"},{"id":112,"comment":"A simple pendulum consists of a weight suspended from a pivot so that it can swing freely back and forth, a classic example of harmonic motion. The time it takes to complete one full swing, the period, is dependent on the length of the pendulum and the acceleration due to gravity.","commented_by":"Math Expert","image_src":"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"}]},{"id":5,"title":"Wheatstone Bridge","description":"How to solve an unbalanced wheatstone bridge?","reported_by":"Souparnika R Krishna","time_created":"49 minutes ago","image_src":"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","follow_ups":[{"id":101,"comment":"monochromatic light of wavelength 500nm is incident on a two parallel slits seperated by a distance of 5 x 10-4. the interference pattern is obtained on a screen at a distance of 1m from the slits. the intensity of the central maximum is Io. when one of the slits is covered by a glass sheet of thickness 1.5x 10-6 m and refractive index 1.5, the intensity at the centre of the screen will be equal to","commented_by":"Akash","image_src":"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"}]},{"id":6,"title":"Biology Query","description":"Discussion on exceptions like hummingbirds in the context of All birds are regulators.","reported_by":"Alfiya J A","time_created":"1 hour ago","image_src":"https://static.testpress.in/static/img/default_medium_small_image.png","follow_ups":[{"id":101,"comment":"Ncert statementaa but humming birds,shrews okke exception ullethallee ..appo generaliseyth parayaan pattillalooo","image_src":"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","commented_by":"admin"},{"id":101,"comment":"No we can do it in alternative ways but make sure it does not affect the expected result","image_src":"https://images.unsplash.com/photo-1519244703995-f4e0f30006d5?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","commented_by":"admin"},{"id":110,"comment":"The Pythagorean Theorem states that in a right-angled triangle, the square of the length of the hypotenuse (the side opposite the right angle) is equal to the sum of the squares of the lengths of the other two sides.","image_src":"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","commented_by":"Suresh"},{"id":101,"comment":"No we can do it in alternative ways but make sure it does not affect the expected result","image_src":"https://images.unsplash.com/photo-1519244703995-f4e0f30006d5?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","commented_by":"admin"},{"id":110,"comment":"The Pythagorean Theorem states that in a right-angled triangle, the square of the length of the hypotenuse (the side opposite the right angle) is equal to the sum of the squares of the lengths of the other two sides.","image_src":"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80","commented_by":"Suresh"}]}]');
            return doubts.find(doubt => doubt.id == id);
        }
    };
  }

  function recordAudio() {
    return {
      audioUrl: null,
      recorder: null,
      beingRecorded: false,
      micPermissionError: false,
      uploading: false,
      action: "",
      isPaused: false,
      timerId: null,
      timerSeconds: 0,

      async init() {
        this.initializeUppy();
      },

      async initializeRecorder() {
        try {
          this.recorder = await window.audioRecorder();
          this.micPermissionError = false;
        } catch (error) {
          this.micPermissionError = true;
        }
      },

      startTimer() {
        this.timerId = setInterval(() => {
          this.timerSeconds++;
        }, 1000)
      },

      stopTimer() {
        clearInterval(this.timerId)
        this.timerId = null;
      },

      clearTimer() {
        this.stopTimer();
        this.timerSeconds = 0;
      },

      initializeUppy() {
        // this.uppy_record = new UppyFileUploader()
        // this.uppy_record.on('upload-success', this.uploadSuccess.bind(this));
        // this.uppy_record.on('upload-error', this.uploadError.bind(this));
      },

      uploadSuccess(file, response) {
        this.uploading = false;
        this.$dispatch("submit-audio-recording", {comment: response.uploadURL})
      },

      uploadError(file, error, response) {
        this.uploading = false;
      },

      async startRecording() {
        if (!this.recorder) {
          await this.initializeRecorder();
        }

        if (this.micPermissionError) {
          return;
        }

        this.audioUrl = null;
        this.beingRecorded = true;
        this.startTimer();
        this.recorder.start();
      },

      async stopRecording() {
        this.clearTimer();
        if (this.recorder.isRecording()) {
          const audio = await this.recorder.stop();
          this.audioUrl = audio.audioUrl
        }
        this.isPaused = false;
        this.beingRecorded = false;
      },

      async uploadRecording() {
        this.uploading = true;
        // let file = await fetch(this.audioUrl)
        //   .then(r => r.blob())
        //   .then(blobFile => new File([blobFile], "audio.wav", { type: "audio/wav" }))
        // this.uppy_record.addFile({file: file})
        
        // Set a delay before calling uploadSuccess
        setTimeout(() => {
          this.uploadSuccess();
        }, 2000);  
      },

      async submitRecording() {
        await this.stopRecording();
        await this.uploadRecording();
      },

      async resumeRecording() {
        this.recorder.resume();
        this.isPaused = false;
        this.startTimer();
      },

      async pauseRecording() {
        this.stopTimer();
        this.recorder.pause();
        this.isPaused = true;
      },
  };
}
</script>
