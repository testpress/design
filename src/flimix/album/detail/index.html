---
permalink: flimix/album/detail/
tags: flimix
customer_view: "Album detail"
---

{% extends "src/flimix/layouts/viewer_layout.html" %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/wavesurfer.js@7.7.3/dist/wavesurfer.min.js"></script>
<script type="module" src="https://cdn.jsdelivr.net/npm/media-chrome@3/+esm"></script>
{% endblock extra_head %}

{% block main_content %}
<div x-data="albumPlayer()">
  <div class="max-w-[85rem] mx-auto py-16 px-4 sm:px-6 lg:px-8 space-y-16"
    :class="showPlayer ? 'pb-[320px] md:pb-64' : ''">
    {% include "./content.html" %}
    {% include "./tracks.html" %}
  </div>

  <footer x-cloak x-show="showPlayer" x-transition class="fixed bottom-0 left-0 right-0 z-50 shadow-2xl">
    {% include "./player.html" %}
  </footer>
</div>
{% endblock main_content %}

{% block script %}
<script>
  function albumPlayer() {
    return {
      showPlayer: false,
      currentTrack: null,
      isPlaying: false,

      playTrack(trackNumber) {
        const audio = document.querySelector('audio');
        
        // If clicking the same track that's already playing, toggle play/pause
        if (this.currentTrack === trackNumber && this.showPlayer) {
          if (this.isPlaying) {
            audio.pause();
            this.isPlaying = false;
          } else {
            audio.play();
            this.isPlaying = true;
          }
        } else {
          // New track selected
          this.currentTrack = trackNumber;
          this.showPlayer = true;
          this.isPlaying = true;
          
          // Start playing after a short delay to ensure player is visible
          setTimeout(() => {
            audio.play();
          }, 100);
        }
      },

      init() {
        // Listen to audio events to sync state
        this.$nextTick(() => {
          const audio = document.querySelector('audio');
          if (audio) {
            audio.addEventListener('play', () => {
              this.isPlaying = true;
            });
            audio.addEventListener('pause', () => {
              this.isPlaying = false;
            });
            audio.addEventListener('ended', () => {
              this.isPlaying = false;
            });
          }
        });
      }
    }
  }
</script>
{% endblock script %}