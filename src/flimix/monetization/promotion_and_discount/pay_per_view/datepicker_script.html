<script src="/node_modules/preline/dist/preline.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    const startDateInput = document.querySelector('[name="start_date"]');
    const endDateInput = document.querySelector('[name="end_date"]');
    const startDateButton = document.querySelector('#start-date');
    const endDateButton = document.querySelector('#end-date');

    let startDate = startDateInput.value ? moment(startDateInput.value, 'YYYY-MM-DD') : null;
    let endDate = endDateInput.value ? moment(endDateInput.value, 'YYYY-MM-DD') : null;

    const updateButtonText = (button, date) => {
      if (date) {
        const textElement = button.querySelector('.date-text');
        if (textElement) {
          textElement.textContent = date.format('D MMM YYYY');
        }
      }
    };

    updateButtonText(startDateButton, startDate);
    updateButtonText(endDateButton, endDate);

    function initializeDatePicker(selector, button, inputField, show_default_date = true) {
      const options = {
        singleDatePicker: true,
        showDropdowns: true,
        maxYear: parseInt(moment().format('YYYY'), 10),
        locale: {
          format: 'YYYY-MM-DD'
        },
        drops: "auto",
        autoApply: true,
        autoUpdateInput: show_default_date,
      };

      $(selector).daterangepicker(options);

      $(selector).on('apply.daterangepicker', function(ev, picker) {
        inputField.value = picker.startDate.format('YYYY-MM-DD'); // Update input field
        updateButtonText(button, picker.startDate); // Update button text
      });
    }

    initializeDatePicker('#start-date', startDateButton, startDateInput, false);
    initializeDatePicker('#end-date', endDateButton, endDateInput, false);
  });
</script>
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', function() {
    const startDateInput = document.querySelector('[name="edit_start_date"]');
    const endDateInput = document.querySelector('[name="edit_end_date"]');
    const startDateButton = document.querySelector('#edit-start-date');
    const endDateButton = document.querySelector('#edit-end-date');

    let startDate = startDateInput.value ? moment(startDateInput.value, 'YYYY-MM-DD') : null;
    let endDate = endDateInput.value ? moment(endDateInput.value, 'YYYY-MM-DD') : null;

    const updateButtonText = (button, date) => {
      if (date) {
        const textElement = button.querySelector('.date-text');
        if (textElement) {
          textElement.textContent = date.format('D MMM YYYY');
        }
      }
    };

    updateButtonText(startDateButton, startDate);
    updateButtonText(endDateButton, endDate);

    function initializeDatePicker(selector, button, inputField, show_default_date = true) {
      const options = {
        singleDatePicker: true,
        showDropdowns: true,
        maxYear: parseInt(moment().format('YYYY'), 10),
        locale: {
          format: 'YYYY-MM-DD'
        },
        drops: "auto",
        autoApply: true,
        autoUpdateInput: show_default_date,
      };

      $(selector).daterangepicker(options);

      $(selector).on('apply.daterangepicker', function(ev, picker) {
        inputField.value = picker.startDate.format('YYYY-MM-DD'); // Update input field
        updateButtonText(button, picker.startDate); // Update button text
      });
    }

    initializeDatePicker('#edit-start-date', startDateButton, startDateInput, false);
    initializeDatePicker('#edit-end-date', endDateButton, endDateInput, false);
  });
</script>
