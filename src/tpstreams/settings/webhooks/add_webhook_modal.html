<form
  id="add_webhook_modal"
  class="hs-overlay hidden size-full fixed top-0 start-0 z-[100] overflow-x-hidden overflow-y-auto [--close-when-click-inside:true] pointer-events-none"
  role="dialog"
  tabindex="-1"
  aria-labelledby="add_webhook-label"
>
  <div
    class="hs-overlay-open:mt-7 hs-overlay-open:opacity-100 hs-overlay-open:duration-500 mt-0 opacity-0 ease-out transition-all sm:max-w-lg sm:w-full m-3 sm:mx-auto h-[calc(100%-3.5rem)] min-h-[calc(100%-3.5rem)] flex items-center"
  >
    <div
      class="w-full max-h-full flex flex-col bg-white rounded-xl pointer-events-auto shadow-[0_10px_40px_10px_rgba(0,0,0,0.08)]"
    >
      <!-- Header -->
      <div class="py-2.5 px-4 flex justify-between items-center border-b">
        <h3 id="add_webhook-label" class="font-medium text-gray-800">
          Add Webhook
        </h3>
        <button
          type="button"
          class="size-8 inline-flex justify-center items-center gap-x-2 rounded-full border border-transparent bg-gray-100 text-gray-800 hover:bg-gray-200 disabled:opacity-50 disabled:pointer-events-none focus:outline-none focus:bg-gray-200"
          aria-label="Close"
          data-hs-overlay="#add_webhook_modal"
        >
          <span class="sr-only">Close</span>
          <svg
            class="shrink-0 size-4"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 6 6 18" />
            <path d="m6 6 12 12" />
          </svg>
        </button>
      </div>
      <!-- End Header -->

      <!-- Body -->
      <div
        class="overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300"
        x-data="{
          sections:
        [
          { key: 'live_stream', title: 'Live Stream', events: ['not_started','streaming','disconnected','stopped','recording','completed'] },
          { key: 'video_status', title: 'Video', events: ['uploading','transcoding','completed','error'] },
          { key: 'video_trim', title: 'Video Trim', events: ['completed'] },
          { key: 'transcoding_job', title: 'Transcoding', events: ['queued','transcoding','completed','error'] },
        ],
          selectedEvents: [],
          statusDisplayMap: {
            'not_started': 'Not Started',
            'streaming': 'Streaming',
            'disconnected': 'Disconnected',
            'stopped': 'Stopped',
            'recording': 'Recording',
            'completed': 'Completed',
            'uploading': 'Uploading',
            'transcoding': 'Transcoding',
            'completed': 'Completed',
            'error': 'Error',
            'queued': 'Queued',
          },
          toggleSection(sectionKey, events) {
            const allSelected = events.every(e => this.selectedEvents.includes(`${sectionKey}::${e}`));
            if (allSelected) {
              this.selectedEvents = this.selectedEvents.filter(v => !v.startsWith(sectionKey + '::'));
            } else {
              events.forEach(e => {
                const val = `${sectionKey}::${e}`;
                if (!this.selectedEvents.includes(val)) this.selectedEvents.push(val);
              });
            }
          },
          isSectionChecked(sectionKey, events) {
            return events.every(e => this.selectedEvents.includes(`${sectionKey}::${e}`));
          }
        }"
        @hs-overlay:hide.window="selectedEvents = []"
      >
        <div class="p-4 space-y-5">
          <!-- Webhook URL -->
          <div>
            <label for="webhook_url" class="block mb-2 text-sm font-medium text-gray-800">
              Webhook URL
            </label>
            <input
              type="url"
              id="webhook_url"
              name="url"
              required
              class="py-2 px-3 block w-full border-gray-200 rounded-lg sm:text-sm placeholder:text-gray-400 focus:border-blue-500 focus:ring-blue-500"
              placeholder="Enter Endpoint URL"
            />
          </div>

          <!-- Secret Token -->
          <div>
            <label for="webhook_token" class="block mb-2 text-sm font-medium text-gray-800">
              Secret Token (optional)
            </label>
            <input
              type="password"
              id="webhook_token"
              name="secret_token"
              class="py-2 px-3 block w-full border-gray-200 rounded-lg sm:text-sm placeholder:text-gray-400 focus:border-blue-500 focus:ring-blue-500"
              placeholder="Enter secret token"
            />
          </div>

          <!-- Event Selection -->
          <div>
            <label class="block text-sm font-medium text-gray-800 mb-2">Events</label>
            <p class="text-xs text-gray-500">
              Select the events that should trigger your webhook.
            </p>
          </div>

          <!-- Collapsible Event Sections -->
          <div
            class="p-5 pt-0 space-y-8 flex flex-col bg-white border border-gray-200 shadow-2xs rounded-xl dark:bg-neutral-800 dark:border-neutral-700"
          >
            <template x-for="section in sections" :key="section.key">
              <div class="flex gap-3">
                <!-- parent checkbox -->
                <div class="flex h-6 shrink-0 items-center">
                  <div class="group grid size-4 grid-cols-1">
                    <input
                      type="checkbox"
                      :id="section.key"
                      :name="section.key"
                      @change="toggleSection(section.key, section.events)"
                      :checked="isSectionChecked(section.key, section.events)"
                      class="col-start-1 row-start-1 appearance-none rounded-sm text-blue-600 focus:ring-blue-600 border border-gray-300 bg-white checked:border-blue-600 checked:bg-blue-600 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600 dark:border-neutral-600 dark:bg-neutral-800 dark:checked:bg-blue-600 dark:checked:border-blue-600"
                    />
                    <svg
                      class="pointer-events-none col-start-1 row-start-1 size-3.5 self-center justify-self-center stroke-white"
                      viewBox="0 0 14 14"
                      fill="none"
                    >
                      <path
                        class="opacity-0 group-has-checked:opacity-100"
                        d="M3 8L6 11L11 3.5"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      ></path>
                    </svg>
                  </div>
                </div>

                <div class="text-sm/6 w-full">
                  <label
                    :for="section.key"
                    class="font-medium text-gray-900 dark:text-neutral-100"
                    x-text="section.title"
                  ></label>

                  <!-- inner status list -->
                  <div
                    x-show="isSectionChecked(section.key, section.events) || section.events.some(e => selectedEvents.includes(`${section.key}::${e}`))"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 transform -translate-y-2"
                    x-transition:enter-end="opacity-100 transform translate-y-0"
                    x-transition:leave="transition ease-in duration-200"
                    x-transition:leave-start="opacity-100 transform translate-y-0"
                    x-transition:leave-end="opacity-0 transform -translate-y-2"
                    class="space-y-5 rounded-lg py-4 mt-3"
                  >
                    <div class="flex flex-wrap gap-3">
                      <template x-for="event in section.events" :key="event">
                        <label
                          class="flex items-center px-3 py-2 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50 dark:border-neutral-700 dark:hover:bg-neutral-700"
                        >
                          <input
                            type="checkbox"
                            :value="`${section.key}::${event}`"
                            x-model="selectedEvents"
                            class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 dark:border-neutral-600 dark:bg-neutral-800 dark:checked:bg-blue-600 flex-shrink-0"
                          />
                          <span
                            class="ml-3 text-sm text-gray-800 dark:text-neutral-200 truncate max-w-[9rem]"
                            x-text="statusDisplayMap[event] || event"
                          ></span>
                        </label>
                      </template>
                    </div>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>
      </div>
      <!-- End Body -->

      <!-- Footer -->
      <div class="p-4 flex justify-end gap-x-2 border-t">
        <button
          type="button"
          class="py-2 px-3 inline-flex justify-center items-center bg-white border border-gray-200 text-gray-800 text-sm font-medium rounded-lg shadow-sm hover:bg-gray-50"
          data-hs-overlay="#add_webhook_modal"
        >
          Cancel
        </button>

        <button
          type="submit"
          class="py-2 px-3 inline-flex justify-center items-center bg-blue-600 border border-blue-600 text-white text-sm font-medium rounded-lg shadow-sm hover:bg-blue-700 focus:ring-1 focus:ring-blue-300"
          data-hs-overlay="#add_webhook_modal"
        >
          Add
        </button>
      </div>
      <!-- End Footer -->
    </div>
  </div>
</form>
