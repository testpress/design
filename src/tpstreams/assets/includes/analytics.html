<div x-data="chartComponent()" x-show="!disableAnalytics">
  <div class="flex items-center justify-end mt-4">
    <div class="flex items-center">
    <button type="button"
      class="relative inline-flex items-center justify-center flex-shrink-0 w-10 h-5 rounded-full cursor-pointer group focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-offset-2"
      role="switch" :aria-checked="showSeparate.toString()" @click="toggleCharts">
      <span class="sr-only">Use setting</span>
      <span aria-hidden="true" class="absolute w-full h-full bg-white rounded-md pointer-events-none"></span>
      <!-- Enabled: "bg-blue-600", Not Enabled: "bg-gray-200" -->
      <span aria-hidden="true"
        class="absolute h-4 mx-auto transition-colors duration-200 ease-in-out bg-gray-200 rounded-full pointer-events-none w-9"
        :class="{ 'bg-blue-600': showSeparate }"></span>
      <!-- Enabled: "translate-x-5", Not Enabled: "translate-x-0" -->
      <span aria-hidden="true"
        class="absolute left-0 inline-block w-5 h-5 transition-transform duration-200 ease-in-out transform translate-x-0 bg-white border border-gray-200 rounded-full shadow pointer-events-none ring-0"
        :class="{ 'translate-x-5': showSeparate }"></span>
    </button>
    <span class="ml-3 text-sm" id="annual-billing-label">
      <span class="font-medium text-gray-900">Split Charts</span>
    </span>
    </div>
    <div x-data="monthPicker()" class="relative ml-2">
      <button
        type="button"
        @click="isOpen = !isOpen"
        class="w-48 inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-500 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-600">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 mr-2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
      </svg>

        <span x-text="displayText"></span>
      </button>

      <div
        x-show="isOpen"
        @click.away="isOpen = false"
        class="absolute right-0 z-50 w-72 p-4 mt-2 bg-white border border-gray-200 rounded-lg shadow-lg"
        x-transition>

        <!-- Year navigation -->
        <div class="flex items-center justify-between mb-4">
          <button @click="currentYear--" class="p-2 rounded hover:bg-gray-100">
            ‹
          </button>
          <span class="text-lg font-semibold" x-text="currentYear"></span>
          <button @click="currentYear++" class="p-2 rounded hover:bg-gray-100">
            ›
          </button>
        </div>

        <!-- Months -->
        <div class="grid grid-cols-4 gap-2">
          <template x-for="(month, index) in months" :key="index">
            <button
              type="button"
              @click="selectMonth(index)"
              class="py-2 text-sm font-medium rounded hover:bg-blue-50 hover:text-blue-600"
              x-text="month">
            </button>
          </template>
        </div>

      </div>
    </div>
    </div>

  <div class="flex justify-center">
    <div id="views_chart" :hidden="!showSeparate" class="w-80 h-52 sm:w-[600px] sm:h-[400px] md:w-[700px] sm:w-[600px] sm:h-[400px] md:h-[400px] 2xl:w-[1000px] 2xl:h-[500px] mt-4"></div>
  </div>
  <div class="flex justify-center">
    <div id="minutes_watched_chart" :hidden="!showSeparate" class="w-80 h-52 sm:w-[600px] sm:h-[400px] md:w-[700px] sm:w-[600px] sm:h-[400px] md:h-[400px] 2xl:w-[1000px] 2xl:h-[500px] mt-4"></div>
  </div>
  <div class="flex justify-center">
    <div id="chart" :hidden="showSeparate" class="w-80 h-52 sm:w-[600px] sm:h-[400px] md:w-[700px] sm:w-[600px] sm:h-[400px] md:h-[400px] 2xl:w-[1000px] 2xl:h-[500px] mt-4"></div>
  </div>

  <div class="flex flex-wrap gap-6 px-4 mb-6 mt-6">
    {% include "./analytics_location.html" %}
    {% include "./analytics_devices.html" %}
  </div>
</div>
{% raw %}
<script>
function monthPicker() {
  return {
    isOpen: false,
    selectedMonth: '',
    currentYear: new Date().getFullYear(),
    months: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],

    get displayText() {
      if (!this.selectedMonth) return 'Select month';
      const [year, month] = this.selectedMonth.split('-');
      return `${this.months[month - 1]} ${year}`;
    },

    selectMonth(index) {
      const month = String(index + 1).padStart(2, '0');
      this.selectedMonth = `${this.currentYear}-${month}`;
      this.isOpen = false;

      // Design-only hook
      console.log('Selected month:', this.selectedMonth);
    }
  };
}
</script>
{% endraw %}
