<script>
  function roleDetailData() {
    return {
      roleName: "{{ roles_list[0].name }}",
      selectedUsers: [],
      showSearchResults: true,
      showAddAssigneeInputBox: false,
      showRemoveUserModal: false,
      assignedUserToRemove: null,
      rolePermissions: [{% for permission in roles_list[0].permissions %}"{{permission}}", {% endfor %}],
      showAlert: null,
      alertText: "",
      assignedUserSearchText: "",

      isPermissionEnabled(permission) {
        return this.rolePermissions.includes(permission);
      },

      getPermissionAction(permission) {
        let action = permission.split("_")[0];
        if (action == 'change') return 'edit';
        return action;
      },

      isUserSelected(user) {
        return this.selectedUsers.some(e => e.id === user.id)
      },

      onUserSelect(selectedUser) {
        if (this.isUserSelected(selectedUser)) {
          this.unselectUser(selectedUser)
        } else {
          this.selectedUsers.push(selectedUser)
        }
      },

      unselectUser(userToRemove) {
        this.selectedUsers = this.selectedUsers.filter(user => user.id !== userToRemove.id)
      },

      assignedUsers: [
        {
          id: 1,
          display_name: "Leslie Alexander",
          email: "leslie.alexander@example.com",
        },
        {
          id: 2,
          display_name: "Michael Foster",
          email: "michael.foster@example.com",
        },
        {
          id: 3,
          display_name: "Dries Vincent",
          email: "dries.vincent@example.com",
        },
        {
          id: 4,
          display_name: "Lindsay Walton",
          email: "lindsay.walton@example.com",
        },
        {
          id: 5,
          display_name: "Courtney Henry",
          email: "courtney.henry@example.com",
        },
        {
          id: 6,
          display_name: "Tom Cook",
          email: "tom.cook@example.com",
        },
      ],

      allUsers: [
        {
          id: 7,
          display_name: "John Corlos",
          email: "john.corlos@example.com",
        },
        {
          id: 8,
          display_name: "Karthik",
          email: "karthik@example.com",
        },
        {
          id: 9,
          display_name: "Shantanu",
          email: "shantanu@example.com",
        },
        {
          id: 10,
          display_name: "Hari",
          email: "hari@example.com",
        },
        {
          id: 11,
          display_name: "Dinesh",
          email: "dhinesh@example.com",
        },
        {
          id: 12,
          display_name: "Sarath",
          email: "sarath@example.com",
        },
        {
          id: 13,
          display_name: "Bharath",
          email: "bharath@example.com",
        },
        {
          id: 14,
          display_name: "Dominic",
          email: "dominic@example.com",
        }
      ],

      getFilteredAssignedUsers() {
        const searchText = this.assignedUserSearchText.toLowerCase();
        return this.assignedUsers.filter(user => user.display_name.toLowerCase().includes(searchText));
      },

      selectUserToRemove(id) {
        this.assignedUserToRemove = this.assignedUsers.filter(user => user.id === id)[0];
        this.showRemoveUserModal = true;
      },

      removeAssignedUser(id) {
        this.showRemoveUserModal = false;
        this.assignedUsers = this.assignedUsers.filter(user => user.id !== id)
      },

      togglePermission(permission, enable) {
        this.alertText = "Permission successfully updated";
        this.showAlert = true;
        const timeId = setTimeout(() => {this.showAlert = false;}, 3000);
        return () => {
          clearTimeout(timeId)
        }
      }
    }
  }
</script>
