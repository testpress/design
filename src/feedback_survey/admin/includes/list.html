<main class="pb-16 pt-4 mt-4">
    <div class="px-4 sm:px-0">
        <div class="px-4 py-6 sm:px-6 lg:px-8 overflow-hidden bg-gray-50 border-b border-gray-200 shadow sm:rounded-lg">
            <div x-data="selectedfeedbacks()" x-init="init()">
                <div class="sm:hidden">
                    <label for="tabs" class="sr-only">Select a tab</label>
                    <!-- Use an "onChange" listener to redirect the user to the selected tab URL. -->
                    <select id="tabs" name="tabs"
                        class="block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-base focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm">
                        <option>All Feedbacks</option>
                        <option>Draft Feedbacks</option>
                        <option selected>Published Feedbacks</option>
                    </select>
                </div>
                <div class="hidden sm:block">
                    <div class="border-b border-gray-200 relative">
                        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                            <!-- Current: "border-indigo-500 text-indigo-600", Default: "border-transparent text-gray-500 hover:border-gray-200 hover:text-gray-700" -->
                            <a href="#"
                                @click="selectedall=true,selectedraft=false,selectedpublished=false,removefilters()"
                                :class="selectedall ? 'border-indigo-500 text-indigo-600 flex whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium' : 'border-transparent text-gray-500 hover:border-gray-200 hover:text-gray-700 flex whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium'">
                                All Forms
                                <!-- Current: "bg-indigo-100 text-indigo-600", Default: "bg-gray-100 text-gray-900" -->
                                <span
                                    :class="selectedall ? 'bg-indigo-100 text-indigo-600 ml-3 hidden rounded-full py-0.5 px-2.5 text-xs font-medium md:inline-block' : 'bg-gray-100 text-gray-900 ml-3 hidden rounded-full py-0.5 px-2.5 text-xs font-medium md:inline-block'">20</span>
                            </a>
                            <a href="#"
                                @click="selectedall=false,selectedraft=true,selectedpublished=false,filterdraftfeedbacks()"
                                :class="selectedraft ? 'border-indigo-500 text-indigo-600 flex whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium' : 'border-transparent text-gray-500 hover:border-gray-200 hover:text-gray-700 flex whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium'">
                                Draft
                                <!-- Current: "bg-indigo-100 text-indigo-600", Default: "bg-gray-100 text-gray-900" -->
                                <span
                                    :class="selectedraft ? 'bg-indigo-100 text-indigo-600 ml-3 hidden rounded-full py-0.5 px-2.5 text-xs font-medium md:inline-block' : 'bg-gray-100 text-gray-900 ml-3 hidden rounded-full py-0.5 px-2.5 text-xs font-medium md:inline-block'">10</span>
                            </a>
                            <a href="#"
                                @click="selectedall=false,selectedraft=false,selectedpublished=true,filterpublishedfeedback()"
                                :class="selectedpublished ? 'border-indigo-500 text-indigo-600 flex whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium' : 'border-transparent text-gray-500 hover:border-gray-200 hover:text-gray-700 flex whitespace-nowrap border-b-2 py-4 px-1 text-sm font-medium'">
                                Published
                                <!-- Current: "bg-indigo-100 text-indigo-600", Default: "bg-gray-100 text-gray-900" -->
                                <span
                                    :class="selectedpublished ? 'bg-indigo-100 text-indigo-600 ml-3 hidden rounded-full py-0.5 px-2.5 text-xs font-medium md:inline-block' : 'bg-gray-100 text-gray-900 ml-3 hidden rounded-full py-0.5 px-2.5 text-xs font-medium md:inline-block'">10</span>
                            </a>
                        </nav>
                    </div>
                </div>
            </div>
            <ul role="list" class="divide-y divide-gray-100">
                {% for feedback_form in feedback_forms %}
                <li class="flex flex-wrap items-center justify-between gap-x-6 gap-y-4 py-5 sm:flex-nowrap">
                    <div>
                        <p class="text-sm font-semibold leading-6 text-gray-900">
                            <a href="/feedback_survey/admin/details/" class="hover:underline">{{ feedback_form.name}}</a>
                            {% if feedback_form.status=="open"%}
                            <span
                                class="ml-1 rounded-md whitespace-nowrap mt-0.5 px-1.5 py-0.5 text-xs font-medium ring-1 ring-inset text-green-700 bg-green-50 ring-green-600/20">Open</span>
                            {% elseif feedback_form.status=="upcoming"%}
                            <span
                            class="ml-2 rounded-md whitespace-nowrap mt-0.5 px-1.5 py-0.5 text-xs font-medium ring-1 ring-inset text-gray-600 bg-gray-50 ring-gray-500/10">Upcoming</span>
                            {% else %}
                            <span
                            class="ml-2 rounded-md whitespace-nowrap mt-0.5 px-1.5 py-0.5 text-xs font-medium ring-1 ring-inset text-yellow-800 bg-yellow-50 ring-yellow-600/20">Closed</span>
                            {% endif %}
                        </p>
                        <div class="mt-1 flex items-center gap-x-2 text-xs leading-5 text-gray-500">
                            <p>
                                <a href="#" class="hover:underline">End Date :</a>
                            </p>
                            <p><time datetime="2023-01-23T22:34Z">{{ feedback_form.end_date}}</time></p>
                        </div>
                    </div>
                    <dl class="flex w-full flex-none justify-between gap-x-8 sm:w-auto">
                        <div class="flex -space-x-0.5">
                            <dt class="sr-only">Commenters</dt>
                            {% for user in feedback_form.user %}
                            <dd>
                                <img class="h-6 w-6 rounded-full bg-gray-50 ring-2 ring-white"
                                    src="{{ user.image }}"
                                    alt="dummy">
                            </dd>
                            {% endfor %}
                        </div>
                        <div class="flex w-16 gap-x-2.5">
                            <dt>
                                <span class="sr-only">Total comments</span>
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-gray-400">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5zm6-10.125a1.875 1.875 0 11-3.75 0 1.875 1.875 0 013.75 0zm1.294 6.336a6.721 6.721 0 01-3.17.789 6.721 6.721 0 01-3.168-.789 3.376 3.376 0 016.338 0z" />
                                </svg>
                            </dt>
                            <dd class="text-sm leading-6 text-gray-900">{{ feedback_form.response_count }}</dd>
                        </div>
                    </dl>
                </li>
                {% endfor %}
            </ul>
            {% include "partials/pagination.html"%}
        </div>
    </div>
</div>


<script>
    function filterdraftfeedbacks() {
        let newURL = new URL(window.location);
        newURL.searchParams.set("status", "draft");
        window.location.href = newURL;
    }
    function filterpublishedfeedback() {
        let newURL = new URL(window.location);
        newURL.searchParams.set("status", "published");
        window.location.href = newURL;
    }
    function removefilters() {
        let newURL = new URL(window.location);
        newURL.searchParams.delete("status");
        window.location = newURL;
    }

    function selectedfeedbacks() {
        let selectedall = false;
        let selectedraft = false;
        let selectedpublished = false;
        let urlParams = new URLSearchParams(window.location.search);

        if (urlParams.get('status') === 'draft') {
            selectedraft = true;
        } else if (urlParams.get('status') === 'published') {
            selectedpublished = true;
        } else {
            selectedall = true;
        }

        return {
            selectedall: selectedall,
            selectedraft: selectedraft,
            selectedpublished: selectedpublished,
            init() {
                if (selectedall) {
                    this.selectedall = true;
                } else if (selectedraft) {
                    this.selectedraft = true;
                } else if (selectedpublished) {
                    this.selectedpublished = true;
                }
            }
        };
    }
</script>