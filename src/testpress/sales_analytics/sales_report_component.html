<script src="https://preline.co/pro/assets/vendor/lodash/lodash.min.js"></script>
<script src="https://preline.co/pro/assets/vendor/apexcharts/dist/apexcharts.min.js"></script>
<script src="https://preline.co/pro/assets/js/hs-apexcharts-helpers.js"></script>
  

<script>
  function salesAnalytics() {
    return {
      isCNO: false, // Set to true for CNO role
      selectedDateRange: 'last-30-days',
      customDateStart: null,
      customDateEnd: null,
      showCustomDatePicker: false,

      // KPI Data
      totalRevenue: 1545000,
      totalRegistrations: 1234,
      individualUsers: 856,
      cohortUsers: 378,

      // Growth percentages
      revenueGrowth: 15,
      registrationsGrowth: 14,
      individualGrowth: 12,
      cohortGrowth: 18,

      // Format currency
      formatCurrency(amount) {
        return new Intl.NumberFormat('en-IN', {
          style: 'currency',
          currency: 'INR',
          maximumFractionDigits: 0
        }).format(amount);
      },

      // Format number with commas
      formatNumber(num) {
        return new Intl.NumberFormat('en-IN').format(num);
      }
    }
  }

</script>
<script>
  window.addEventListener('load', () => {
    // Apex Curved Line Charts
    (function () {
      const responsesData = [12, 18, 22, 25, 28, 31, 20]; // update this array as needed
      const maxResponse = Math.max(...responsesData);
      // Always show up to 8 y-axis ticks, rounded up to nearest 5 or 10
      let step;
      if (maxResponse <= 40) {
        step = 5;
      } else if (maxResponse <= 80) {
        step = 10;
      } else {
        step = Math.ceil(maxResponse / 8 / 5) * 5;
      }
      const maxY = Math.ceil(maxResponse / step) * step;
      const tickAmount = Math.min(8, Math.floor(maxY / step));

      buildChart('#rating-over-time', (mode) => ({
        chart: {
          height: 300,
          type: 'line',
          toolbar: {
            show: false
          },
          zoom: {
            enabled: false
          }
        },
        series: [
          {
            name: 'Average Rating',
            data: [3.8, 4.0, 4.2, 4.1, 4.4, 4.5, 4.3]
          },
          {
            name: 'Responses',
            data: responsesData
          }
        ],
        dataLabels: {
          enabled: false
        },
        stroke: {
          curve: 'smooth',
          width: [4, 4],
          dashArray: [0, 10] // solid for blue, dashed for green
        },
        title: {
          show: false
        },
        legend: {
          show: false
        },
        xaxis: {
          type: 'category',
          categories: [
            'Week 1',
            'Week 2',
            'Week 3',
            'Week 4',
            'Week 5',
            'Week 6',
            'Week 7'
          ],
          axisBorder: {
            show: false
          },
          axisTicks: {
            show: false
          },
          tooltip: {
            enabled: false
          },
          labels: {
            show: true,
            style: {
              colors: 'oklch(0.707 0.022 261.325)',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            offsetX: 2,
            offsetY: 4,

            // Show all week labels
            formatter: function (value, index) {
              return value;
            }
          }
        },
        yaxis: {
          min: 0,
          max: maxY,
          tickAmount: tickAmount,
          labels: {
            align: 'left',
            minWidth: 0,
            maxWidth: 140,
            style: {
              colors: 'oklch(0.707 0.022 261.325)',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            offsetX: -2,
            formatter: (value) => {
              // Show only multiples of step up to maxY, max 8 values
              if (value % step === 0 && value <= maxY) return value;
              return '';
            }
          }
        },
        tooltip: {
          custom: function (props) {
            const { categories } = props.ctx.opts.xaxis;
            const { dataPointIndex } = props;
            const title = categories[dataPointIndex];

            return buildTooltip(props, {
              title: title,
              mode,
              hasTextLabel: true,
              wrapperExtClasses: 'min-w-36',
              labelDivider: ':',
              labelExtClasses: 'ms-2',
              valuePrefix: '',
            });
          }
        },
      }), {
        colors: ['#2563EB', '#22c55e'], // blue for Average Rating, green for Responses
        xaxis: {
          labels: {
            style: {
              colors: '#9ca3af',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#9ca3af'
            }
          }
        },
        grid: {
          borderColor: '#e5e7eb'
        }
      }, {
        colors: ['#3b82f6', '#22c55e'],
        xaxis: {
          labels: {
            style: {
              colors: '#a3a3a3',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#a3a3a3'
            }
          }
        },
        grid: {
          borderColor: '#404040'
        }
      });
    })();
  });
</script>