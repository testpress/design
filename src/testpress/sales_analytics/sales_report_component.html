<script src="https://preline.co/pro/assets/vendor/lodash/lodash.min.js"></script>
<script src="https://preline.co/pro/assets/vendor/apexcharts/dist/apexcharts.min.js"></script>
<script src="https://preline.co/pro/assets/js/hs-apexcharts-helpers.js"></script>


<script>
  function salesAnalytics() {
    return {
      isCNO: false, // Set to true for CNO role
      selectedDateRange: 'last-30-days',
      customDateStart: null,
      customDateEnd: null,
      showCustomDatePicker: false,

      // KPI Data
      totalRevenue: 1545000,
      totalRegistrations: 1234,
      individualUsers: 856,
      cohortUsers: 378,

      // Growth percentages
      revenueGrowth: 15,
      registrationsGrowth: 14,
      individualGrowth: 12,
      cohortGrowth: 18,

      // Format currency
      formatCurrency(amount) {
        return new Intl.NumberFormat('en-IN', {
          style: 'currency',
          currency: 'INR',
          maximumFractionDigits: 0
        }).format(amount);
      },

      // Format number with commas
      formatNumber(num) {
        return new Intl.NumberFormat('en-IN').format(num);
      }
    }
  }

</script>
<script>
  window.addEventListener('load', () => {
    // Registrations Over Time Chart
    (function () {
      const individualData = [120, 180, 160, 220, 200, 280, 250, 300];
      const cohortData = [80, 140, 120, 180, 160, 200, 180, 220];
      const maxValue = Math.max(...individualData, ...cohortData);

      // Calculate step for y-axis
      let step;
      if (maxValue <= 40) {
        step = 5;
      } else if (maxValue <= 80) {
        step = 10;
      } else {
        step = Math.ceil(maxValue / 8 / 5) * 5;
      }
      const maxY = Math.ceil(maxValue / step) * step;
      const tickAmount = Math.min(8, Math.floor(maxY / step));

      buildChart('#hs-registrations-line-chart', (mode) => ({
        chart: {
          height: 300,
          type: 'line',
          toolbar: {
            show: false
          },
          zoom: {
            enabled: false
          }
        },
        series: [
          {
            name: 'Individual Users',
            data: individualData
          },
          {
            name: 'Cohort Users',
            data: cohortData
          }
        ],
        dataLabels: {
          enabled: false
        },
        stroke: {
          curve: 'straight',
          width: [2, 2],
          dashArray: [0, 0] // both solid lines
        },
        title: {
          show: false
        },
        legend: {
          show: false
        },
        xaxis: {
          type: 'category',
          categories: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
          axisBorder: {
            show: false
          },
          axisTicks: {
            show: false
          },
          tooltip: {
            enabled: false
          },
          labels: {
            show: true,
            style: {
              colors: '#9ca3af',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            offsetX: 2,
            offsetY: 4,
            formatter: function (value, index) {
              return value;
            }
          }
        },
        yaxis: {
          min: 0,
          max: maxY,
          tickAmount: tickAmount,
          labels: {
            align: 'left',
            minWidth: 0,
            maxWidth: 140,
            style: {
              colors: '#9ca3af',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            offsetX: -2,
            formatter: (value) => {
              if (value % step === 0 && value <= maxY) return value;
              return '';
            }
          }
        },
        tooltip: {
          custom: function (props) {
            const { categories } = props.ctx.opts.xaxis;
            const { dataPointIndex } = props;
            const title = categories[dataPointIndex];

            return buildTooltip(props, {
              title: title,
              mode,
              hasTextLabel: true,
              wrapperExtClasses: 'min-w-36',
              labelDivider: ':',
              labelExtClasses: 'ms-2',
              valuePrefix: '',
            });
          }
        },
      }), {
        colors: ['#2563EB', '#14B8A6'], // blue for Individual, teal for Cohort
        xaxis: {
          labels: {
            style: {
              colors: '#9ca3af',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#9ca3af'
            }
          }
        },
        grid: {
          borderColor: '#e5e7eb'
        }
      }, {
        colors: ['#3b82f6', '#06B6D4'],
        xaxis: {
          labels: {
            style: {
              colors: '#a3a3a3',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#a3a3a3'
            }
          }
        },
        grid: {
          borderColor: '#404040'
        }
      });
    })();

    // Revenue Over Time Chart
    (function () {
      const individualSalesData = [150000, 200000, 180000, 240000, 220000, 280000, 260000, 300000];
      const cohortSalesData = [100000, 180000, 160000, 220000, 200000, 250000, 230000, 280000];
      const maxValue = Math.max(...individualSalesData, ...cohortSalesData);

      // Calculate step for y-axis
      let step;
      if (maxValue <= 40000) {
        step = 5000;
      } else if (maxValue <= 80000) {
        step = 10000;
      } else {
        step = Math.ceil(maxValue / 8 / 50000) * 50000;
      }
      const maxY = Math.ceil(maxValue / step) * step;
      const tickAmount = Math.min(8, Math.floor(maxY / step));

      buildChart('#hs-revenue-line-chart', (mode) => ({
        chart: {
          height: 300,
          type: 'line',
          toolbar: {
            show: false
          },
          zoom: {
            enabled: false
          }
        },
        series: [
          {
            name: 'Individual Sales',
            data: individualSalesData
          },
          {
            name: 'Cohort Sales',
            data: cohortSalesData
          }
        ],
        dataLabels: {
          enabled: false
        },
        stroke: {
          curve: 'straight',
          width: [2, 2],
          dashArray: [0, 0] // both solid lines
        },
        title: {
          show: false
        },
        legend: {
          show: false
        },
        xaxis: {
          type: 'category',
          categories: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
          axisBorder: {
            show: false
          },
          axisTicks: {
            show: false
          },
          tooltip: {
            enabled: false
          },
          labels: {
            show: true,
            style: {
              colors: '#9ca3af',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            offsetX: 2,
            offsetY: 4,
            formatter: function (value, index) {
              return value;
            }
          }
        },
        yaxis: {
          min: 0,
          max: maxY,
          tickAmount: tickAmount,
          labels: {
            align: 'left',
            minWidth: 0,
            maxWidth: 140,
            style: {
              colors: '#9ca3af',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            offsetX: -2,
            formatter: (value) => {
              if (value % step === 0 && value <= maxY) {
                if (value >= 100000) {
                  return `₹${(value / 100000).toFixed(1)}L`;
                } else if (value >= 1000) {
                  return `₹${(value / 1000).toFixed(0)}k`;
                }
                return `₹${value}`;
              }
              return '';
            }
          }
        },
        tooltip: {
          custom: function (props) {
            const { categories } = props.ctx.opts.xaxis;
            const { dataPointIndex } = props;
            const title = categories[dataPointIndex];

            return buildTooltip(props, {
              title: title,
              mode,
              hasTextLabel: true,
              wrapperExtClasses: 'min-w-36',
              labelDivider: ':',
              labelExtClasses: 'ms-2',
              valuePrefix: '',
            });
          }
        },
      }), {
        colors: ['#2563EB', '#14B8A6'], // blue for Individual, teal for Cohort
        xaxis: {
          labels: {
            style: {
              colors: '#9ca3af',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#9ca3af'
            }
          }
        },
        grid: {
          borderColor: '#e5e7eb'
        }
      }, {
        colors: ['#3b82f6', '#06B6D4'],
        xaxis: {
          labels: {
            style: {
              colors: '#a3a3a3',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: '#a3a3a3'
            }
          }
        },
        grid: {
          borderColor: '#404040'
        }
      });
    })();

    // Revenue by User Type Donut Chart
    (function () {
      buildChart('#hs-revenue-donut-chart', (mode) => ({
        chart: {
          height: 230,
          width: 230,
          type: 'donut',
          zoom: {
            enabled: false
          },
          events: {
            dataPointSelection: (event, chartContext, config) => {
              chartContext.toggleDataPointSelection(config.seriesIndex);
            }
          }
        },
        plotOptions: {
          pie: {
            donut: {
              size: '76%'
            }
          }
        },
        series: [850000, 695000],
        labels: ['Individual Sales', 'Cohort Sales'],
        legend: {
          show: false
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          width: 5,
          colors: ['#ffffff']
        },
        grid: {
          padding: {
            top: -12,
            bottom: -11,
            left: -12,
            right: -12
          }
        },
        states: {
          hover: {
            filter: {
              type: 'none',
              value: 0
            }
          },
          active: {
            allowMultipleDataPointsSelection: false
          }
        },
        tooltip: {
          enabled: true,
          custom: ({ seriesIndex, w }) => {
            if (seriesIndex < 0 || !w.globals.labels[seriesIndex]) return '';
            const label = w.globals.labels[seriesIndex];
            const value = w.globals.series[seriesIndex];
            const total = w.globals.series.reduce((a, b) => a + b, 0);
            const percentage = ((value / total) * 100).toFixed(1);
            const color = w.globals.colors[seriesIndex];
            return `
              <div class="border border-gray-300 bg-white w-48 text-gray-900 shadow-xl dark:bg-neutral-800 dark:border-neutral-700">
                <div class="px-2 py-1.5 font-semibold text-[13px] flex items-center dark:text-neutral-200">
                  <span>${label}</span>
                  <span class="ms-auto">${percentage}%</span>
                </div>
                <div class="border-t border-gray-200 dark:border-neutral-700"></div>
                <div class="space-y-1.5 p-2">
                  <div class="flex items-center gap-x-2 text-xs text-gray-600 dark:text-neutral-400">
                    <span class="w-3 h-3 rounded-sm inline-block" style="background:${color}"></span>
                    <span>Revenue</span>
                    <span class="ms-auto">₹${new Intl.NumberFormat('en-IN').format(value)}</span>
                  </div>
                </div>
              </div>
            `;
          }
        }
      }), {
        colors: ['#2563EB', '#14B8A6'], // blue for Individual, teal for Cohort
        stroke: {
          colors: ['#ffffff']
        }
      }, {
        colors: ['#3b82f6', '#06B6D4'],
        stroke: {
          colors: ['#ffffff']
        }
      });
    })();
  });
</script>