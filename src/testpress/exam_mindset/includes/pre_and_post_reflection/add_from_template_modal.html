<div x-cloak x-show="openAddTemplateModal" id="em-add-template-modal" class="hs-overlay hidden size-full fixed top-0 start-0 z-[80] w-full h-full overflow-x-hidden overflow-y-auto [--close-when-click-inside:true] pointer-events-none" aria-labelledby="hs-pro-add-label" role="dialog" aria-modal="true">
  <div class="hs-overlay-open:mt-7 hs-overlay-open:opacity-100 hs-overlay-open:duration-500 mt-0 opacity-0 ease-out transition-all sm:max-w-xl sm:w-full mx-3 mb-7 h-[calc(100%-56px)] min-h-[calc(100%-56px)] sm:mx-auto flex items-center">
    <div @click.away="closeAllModals()" class="w-full max-h-full flex flex-col bg-white rounded-xl pointer-events-auto shadow-xl">
      <div class="w-full flex flex-col">
        <div class="py-2.5 px-4 flex justify-between items-center border-b border-gray-200">
          <h3 id="hs-pro-add-label" class="font-medium text-gray-800">
            Add Questions from Template
          </h3>
          <button type="button" data-hs-overlay="#em-add-template-modal" class="size-8 shrink-0 flex justify-center items-center gap-x-2 rounded-full border border-transparent bg-gray-100 text-gray-800 hover:bg-gray-200" aria-label="Close">
            <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
          </button>
        </div>
        <div class="overflow-y-auto p-4 space-y-5 max-h-96">
          <p class="text-sm text-gray-700">
            Select questions to add to the 
            <span x-text="navigationTab === 'pre' ? 'pre-exam' : 'post-exam'"></span>
            reflection question set.
          </p>
          <div class="space-y-3">
            <template x-if="availableTemplates.length === 0">
              <p class="text-sm text-gray-500 text-center py-4">All available templates for this section have already been added.</p>
            </template>
            <template x-for="template in availableTemplates" :key="template.id">
              <label :for="'template-' + template.id" class="flex items-start p-3 w-full bg-white border border-gray-200 rounded-lg text-sm hover:bg-gray-50 cursor-pointer relative">
                <input type="checkbox" :id="'template-' + template.id" :value="template.id" x-model="selectedTemplates" class="shrink-0 mt-0.5 border-gray-200 rounded text-emerald-600 focus:ring-emerald-500">
                <span class="ms-3 flex-1">
                  <span class="block font-medium text-gray-800" x-text="template.name"></span>
                  <span class="block text-gray-600 pr-12" x-text="template.text"></span>
                </span>
                <span class="absolute top-3 right-3 inline-flex items-center gap-x-1.5 py-0.5 px-1.5 rounded-md text-xs font-medium bg-gray-100 text-gray-800 capitalize" x-text="template.response_type"></span>
              </label>
            </template>
          </div>
        </div>
        <div class="p-4 flex justify-end items-center gap-2 border-t bg-gray-50 rounded-b-xl">
          <button type="button" data-hs-overlay="#em-add-template-modal" class="py-2 px-3 inline-flex justify-center items-center text-sm font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50">
            Cancel
          </button>
          <button @click="saveFromTemplates()" type="button" :disabled="selectedTemplates.length === 0" class="py-2 px-3 inline-flex justify-center items-center gap-x-2 text-sm font-medium rounded-lg border border-transparent bg-emerald-600 text-white hover:bg-emerald-700 shadow-sm disabled:opacity-50 disabled:pointer-events-none">
            Add Selected
          </button>
        </div>
      </div>
    </div>
  </div>
</div>