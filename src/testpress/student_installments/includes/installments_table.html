<div class="overflow-hidden" x-data="installmentsData()">
  <table class="min-w-full divide-y divide-gray-200">
    <thead>
      <tr>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-left text-sm font-semibold text-gray-900">
          Product
        </th>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-right text-sm font-semibold text-gray-900">
          Paid
        </th>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-right text-sm font-semibold text-gray-900">
          Remaining
        </th>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-left text-sm font-semibold text-gray-900">
          Due
        </th>
        <th scope="col" class="bg-gray-50 px-6 py-3 text-left text-sm font-semibold text-gray-900">
          Last Paid
        </th>
      </tr>
    </thead>
    <template x-for="installment in installments" :key="installment.id">
      <tbody class="divide-y divide-gray-200 bg-white" 
             x-show="selectedFilter === 'all' || (selectedFilter === 'paid' && installment.isPaid) || (selectedFilter === 'pending' && !installment.isPaid && !installment.isOverdue) || (selectedFilter === 'overdue' && installment.isOverdue)">
        
        <tr class="cursor-pointer select-none hover:bg-gray-50 transition-colors duration-150" 
            :class="{ 'bg-gray-100': installment.id == selected }"
            @click="if (selected !== installment.id) { showLoader=true; selected = installment.id; setTimeout(() => { showLoader=false }, 600) } else { selected = null }">
          
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500 text-left truncate sm:max-w-44">
            <div class="font-medium text-gray-900" x-text="installment.product"></div>
            <div class="text-xs text-gray-400" x-text="installment.course"></div>
          </td>
          
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500 text-right">
            <span class="font-medium text-gray-900" x-text="'₹' + (installment.amountPaid || 0).toLocaleString()"></span>
            INR
          </td>
          
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500 text-right">
            <span class="font-medium text-gray-900" x-text="'₹' + (installment.amountDue || 0).toLocaleString()"></span>
            INR
          </td>
          
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500 text-left">
            <template x-if="installment.isPaid">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Paid</span>
            </template>
            <template x-if="installment.isDueSoon && !installment.isPaid">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800" x-text="installment.dueDate"></span>
            </template>
            <template x-if="installment.isOverdue && !installment.isPaid">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800" x-text="installment.overdueDays == -1 ? 'Since yesterday' : 'Overdue by ' + installment.overdueDays + ' days'"></span>
            </template>
            <template x-if="!installment.isPaid && !installment.isDueSoon && !installment.isOverdue">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800" x-text="'In ' + installment.daysUntilDue + ' days'"></span>
            </template>
          </td>
          
          <td class="whitespace-nowrap px-6 py-4 text-sm text-gray-500 text-left">
            <span x-text="installment.lastPaid"></span>
          </td>
        </tr>
        
        <tr x-cloak x-show="selected == installment.id">
          <td colspan="5" class="p-0">
            <template x-if="showLoader">
              <div class="flex items-center justify-center py-12">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"></div>
              </div>
            </template>
            <template x-if="!showLoader">
              <div class="bg-gray-100 border-t border-gray-200">
                {% include "./installment_details.html" %}
              </div>
            </template>
          </td>
        </tr>
      </tbody>
    </template>
    
    <tbody x-show="!installments || installments.length === 0">
      <tr>
        <td colspan="5" class="p-12 text-center text-sm text-gray-500">
          No User Installments
        </td>
      </tr>
    </tbody>
  </table>
</div>
