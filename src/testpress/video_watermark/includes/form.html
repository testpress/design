<head>
    <link href="https://vjs.zencdn.net/7.10.2/video-js.css" rel="stylesheet" />
    <script defer src="https://unpkg.com/alpinejs@3.x.x" ></script>
    <style>
        .vjs-watermark {
            position: absolute;
            top: 0;
            left: 100%;
            white-space: nowrap;
            font-weight: bold;
            z-index: 10;
        }
        .vjs-big-play-button {
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            font-size: 3em;
        }

        @keyframes scrollWatermark {
            0% {
                left: 100%;
            }
            50% {
                left: 50%;
            }
            100% {
                left: -50%;
            }
        }
    </style>
    <!-- Include Pickr.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/themes/classic.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr/dist/pickr.min.js"></script>
</head>
<header class = "m-4">
<h2 class="text-lg font-semibold leading-7 text-gray-900">Video Watermark Settings</h2>
<p class="mt-1 text-base leading-6 text-gray-600">Configure the settings for the watermark that will be displayed on your videos.</p>
</header>
<div class="flex w-full flex-wrap">
<form x-data="watermarkForm()" class = "m-4 box-border w-full lg:w-1/2">
    <div class="space-y-12">
        <div class="border-b border-gray-900/10 pb-12">

            <div class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                <div class="sm:col-span-6">
                    <label for="type" class="block text-sm font-medium leading-6 text-gray-900">Watermark Type</label>
                    <div class="mt-2">
                      <select id="type" x-model="type" name="watermark_type" autocomplete="watermark_type" class="block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6 w-full" @change='selectType'>
                        <option value="dynamic">Dynamic</option>
                        <option value="static">Static</option>
                        <option value="none">None</option>
                      </select>
                    </div>
                </div>

                <div x-show="type === 'static'" class="sm:col-span-4">
                    <label for="position" class="block text-sm font-medium leading-6 text-gray-900">Watermark Position</label>
                    <div class="mt-2">
                      <select id="position" x-model="position" name="watermark_position" autocomplete="country-name" class="block rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:max-w-xs sm:text-sm sm:leading-6 w-full" @change="staticWatermark">
                        <option value="top-left">Top Left</option>
                        <option value="top-right">Top Right</option>
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-right">Bottom Right</option>
                        <option value="middle">Middle</option>
                      </select>
                    </div>
                </div>

                <div x-show="type === 'dynamic'" class="sm:col-span-6">
                    <label for="interval" class="block text-sm font-medium leading-6 text-gray-900">Interval (seconds)</label>
                    <div class="mt-2">
                      <input type="number" id="interval" name="watermark_interval" x-model="interval" min="1" autocomplete="email" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                    </div>
                </div>
                <div x-show="type === 'dynamic'" class="sm:col-span-6">
                    <label for="skip" class="block text-sm font-medium leading-6 text-gray-900">Skip (seconds)</label>
                    <div c]lass="mt-2">
                      <input type="number" id="skip" name="watermark_skip" x-model="skip" min="1" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6">
                    </div>
                </div>
                <div x-show="type !== 'none'" class="sm:col-span-6">
                    <label for="size" class="block text-sm font-medium leading-6 text-gray-900">Size</label>
                    <div class="mt-2">
                      <input type="number" id="size" name="watermark_size" x-model="size" min="1" max="100" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6" @change="setFontSize">
                    </div>
                </div>
                <div x-show="type !== 'none'" class="sm:col-span-4">
                    <label for="color" class="block text-sm font-medium leading-6 text-gray-900">Color & Opacity</label>
                    <div class="mt-2 flex items-center gap-2">
                        <div class="pickr">
                            <button id="color" name="watermark_color" x-model="color" type="button" class="pcr-button" role="button" aria-label="toggle color picker dialog" 
                                style="transition: none; --pcr-color: rgba(3, 164, 235, 1);"  readonly></button>
                        </div>
                        <input type="range" id="opacity" name="watermark_opacity" x-model="opacity" min="0" max="100"  step="0.5" class="w-full h-2 rounded-lg appearance-none cursor-pointer bg-gray-100 dark:bg-gray-700 border-1" @change="setOpacity">                  
                    </div>
                </div>
           
            </div>
        </div>
        <div class="mt-4 flex items-center justify-end gap-x-6">
            <button type="button" class="text-sm font-semibold leading-6 text-gray-900">Cancel</button>
            <button type="submit" class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Save</button>
        </div>
    </div>
</form>
<div x-show="type !== 'none'" class="space-y-12">
    <div class="relative my-4 w-full truncate rounded-lg shadow-md">
        <video id="my-video" class="video-js vjs-default-skin h-[169px] lg:h-[299px] w-[350px] md:w-[400px] lg:w-[530px]" controls preload="auto" poster="https://www.w3schools.com/html/mov_bbb.jpg" data-setup="{}" height="299px" muted autoplay>
            <source src='http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4' type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>
</div>
</div>

    <!-- Video.js CDN -->
    <script src="https://vjs.zencdn.net/7.17.0/video.min.js"></script>

    <script>
        function watermarkForm() {
            return {
                watermarkText: 'Watermark',
                type: 'dynamic',
                position: 'top-left',
                interval: 5,
                skip: 3,
                size: 15,
                color: '#03A4EB',
                opacity: 50,
                positionY: 10,

                init() {
                    this.initializeColorPicker();
                    this.initializePlayer();
                },

                setColor() {
                    const red = parseInt(this.color.slice(1, 3), 16);
                    const green = parseInt(this.color.slice(3, 5), 16);
                    const blue = parseInt(this.color.slice(5, 7), 16);
                    const gradient = `linear-gradient(to right, rgba(${red}, ${green}, ${blue}, 0) 0%, rgba(${red}, ${green}, ${blue}, 1) 100%)`;
        
                    document.getElementById('opacity').style.background = gradient;
                },

                selectType() {
                    this.watermark.style = '';
                    if(this.type === "static"){
                        this.watermark.style.color=this.rgbaColor
                        this.watermark.style.fontSize=`${this.size}px`
                        this.staticWatermark();
                    }else if(this.type === "none"){
                        this.watermark.style.animation="none"
                        this.watermark.style.display = "none"
                    }else{
                    }
                },

                setFontSize() {
                    this.watermark.style.fontSize = `${this.size}px`;
                },

                setOpacity() {
                    this.watermark.style.color = `${this.rgbaColor}`
                },

                get rgbaColor() {
                    let hex = this.color.replace('#', '');
                    let r = parseInt(hex.substring(0, 2), 16);
                    let g = parseInt(hex.substring(2, 4), 16);
                    let b = parseInt(hex.substring(4, 6), 16);
                    let a = this.opacity / 100;
                    return `rgba(${r}, ${g}, ${b}, ${a})`;
                },

                initializePlayer() {
                    var myplayer = videojs('my-video', {
                        controls: true,
                        autoplay: true,
                        preload: 'auto',
                    });

                    myplayer.on('ready', () => {
                        this.addScrollingWatermark(myplayer);
                    });
                },

                addScrollingWatermark(player) {
                    watermark = document.createElement('div');
                    watermark.classList.add('vjs-watermark');
                    watermark.textContent = this.watermarkText;

                    var videoContainer = player.el();
                    videoContainer.appendChild(watermark);
                    watermark.style.color = this.color
                    this.watermark = watermark;

                    this.scrollWatermark(watermark);
                },

                scrollWatermark(watermarkElement) {
                    setInterval(() => {
                        if(this.type !=="dynamic"){
                        return;
                        }
                        watermarkElement.style.animation = 'scrollWatermark ' + this.interval + 's linear';
                        watermarkElement.style.display = 'block';
                        watermarkElement.style.top = `${this.positionY}%`;
                        watermarkElement.style.color = this.rgbaColor;
                        watermarkElement.style.fontSize = `${this.size}px`;

                        setTimeout(() => {
                            watermarkElement.style.animation = '';
                        }, this.interval * 1000);
                        this.positionY += 20;
                        if (this.positionY > 100) {
                            this.positionY = 10;
                        }
                    }, (this.interval + this.skip) * 1000);
                },

                staticWatermark() {
                    this.watermark.style.animation = "none";
                    if(this.position === "top-left"){
                        this.watermark.style.top = '10%';
                        this.watermark.style.left = '10%';
                    }else if(this.position === "top-right"){
                        this.watermark.style.top = '10%';
                        this.watermark.style.left = '80%';
                    }else if(this.position === "bottom-left"){
                        this.watermark.style.top = '80%';
                        this.watermark.style.left = '10%';
                    }else if(this.position === "bottom-right"){
                        this.watermark.style.top = '80%';
                        this.watermark.style.left = '80%';
                    }else{
                        this.watermark.style.top = '50%';
                        this.watermark.style.left = '50%';
                    }

                },

                initializeColorPicker() {
                    const pickr = Pickr.create({
                        el: '.pcr-button',
                        theme: 'classic',
                        default: 'rgba(3, 164, 235, 1)',
                
                        swatches: [
                            'rgba(0, 0, 0, 1)',
                            'rgba(244, 67, 54, 1)',
                            'rgba(255, 255, 255, 1)',
                            'rgba(233, 30, 99, 1)',
                            'rgba(156, 39, 176, 1)',
                            'rgba(103, 58, 183, 1)',
                            'rgba(63, 81, 181, 1)',
                            'rgba(3, 164, 235, 1)',
                            'rgba(0, 150, 136, 1)',
                            'rgba(76, 175, 80, 1)',
                            'rgba(139, 195, 74, 1)',
                            'rgba(205, 220, 57, 1)',
                            'rgba(255, 235, 59, 1)',
                            'rgba(255, 193, 7, 1)'
                        ],
                
                        components: {
                            preview: true,
                            opacity: false,
                            hue: true,
                
                            interaction: {
                                hex: false,
                                rgba: false,
                                input: true,
                                clear: false,
                                save: false,
                                opacity: false
                            }
                        }
                    });
                    pickr.on('change', (color) => {
                        const hexaColor = color.toHEXA().toString();
                        this.color = hexaColor;
                        this.watermark.style.color = `${this.rgbaColor}`;
                        document.getElementsByClassName('pcr-button')[0].style = `--pcr-color: ${hexaColor}`;
                        //this.setColor();
                    });
                }                
            
            };
        }
    </script>
</form>
