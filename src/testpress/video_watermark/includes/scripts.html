<!-- Video.js CDN -->
<script src="https://vjs.zencdn.net/7.17.0/video.min.js"></script>
<script>
  let watermarkText = 'Watermark';
  let type = 'dynamic';
  let position = 'top-left';
  let interval = 5;
  let skip = 3;
  let size = 15;
  let color = '#03A4EB';
  let opacity = 50;
  let positionY = 10;

  const formElements = document.querySelectorAll("#form-body>div");
  const watermarkTypeElement = document.getElementById('type');
  const watermarkPositionElement = document.getElementById('position');
  const watermarkIntervalElement = document.getElementById('interval');
  const watermarkSkipElement = document.getElementById('skip');
  const watermarkSizeElement = document.getElementById('size');
  const watermarkOpacityElement = document.getElementById('opacity');
  watermarkTypeElement.addEventListener('change', (e) => {
    type = e.target.value;
    formElements[4].style.display = "block";
    formElements[5].style.display = "block";
    watermark.style.color = rgbaColor();
    watermark.style.fontSize = `${size}px`;
    if(type === "dynamic"){
        formElements[1].style.display = "none";
        formElements[2].style.display = "block";
        formElements[3].style.display = "block";
        watermark.style = "";
    }else if(type === "static"){
        formElements[1].style.display = "block";
        formElements[2].style.display = "none";
        formElements[3].style.display = "none";
        staticWatermark()
    }else{
        formElements[1].style.display = "none";
        formElements[2].style.display = "none";
        formElements[3].style.display = "none";
        formElements[4].style.display = "none";
        formElements[5].style.display = "none";
        watermark.style = "";
    }
  })
  watermarkPositionElement.addEventListener('change', (e) => {
      position = e.target.value;
      staticWatermark()
  })
  watermarkIntervalElement.addEventListener('change', (e) => {
      interval = Number(e.target.value);
  })
  watermarkSkipElement.addEventListener('change', (e) => {
      skip = Number(e.target.value);
      scrollWatermark()
  })
  watermarkSizeElement.addEventListener('change', (e) => {
      size = e.target.value;
      watermark.style.fontSize = `${size}px`;
  })
  watermarkOpacityElement.addEventListener('change', (e) => {
      opacity = e.target.value;
      watermark.style.color = rgbaColor();
  })

  function setColor(hexaColor) {
    color = hexaColor;
    const red = parseInt(color.slice(1, 3), 16);
    const green = parseInt(color.slice(3, 5), 16);
    const blue = parseInt(color.slice(5, 7), 16);
    
    const gradient = `linear-gradient(to right, rgba(${red}, ${green}, ${blue}, 0) 0%, rgba(${red}, ${green}, ${blue}, 1) 100%)`;

    document.getElementById('opacity').style.background = gradient;
    watermark.style.color = rgbaColor();
  }

  initializeColorPicker()
  function initializeColorPicker() {
    const pickr = Pickr.create({
        el: '.pcr-button',
        theme: 'classic',
        default: 'rgba(3, 164, 235, 1)',

        swatches: [
            'rgba(0, 0, 0, 1)',
            'rgba(244, 67, 54, 1)',
            'rgba(255, 255, 255, 1)',
            'rgba(233, 30, 99, 1)',
            'rgba(156, 39, 176, 1)',
            'rgba(103, 58, 183, 1)',
            'rgba(63, 81, 181, 1)',
            'rgba(3, 164, 235, 1)',
            'rgba(0, 150, 136, 1)',
            'rgba(76, 175, 80, 1)',
            'rgba(139, 195, 74, 1)',
            'rgba(205, 220, 57, 1)',
            'rgba(255, 235, 59, 1)',
            'rgba(255, 193, 7, 1)'
        ],

        components: {
            preview: true,
            opacity: false,
            hue: true,

            interaction: {
                hex: false,
                rgba: false,
                input: true,
                clear: false,
                save: false,
                opacity: false
            }
        }
    });
    pickr.on('change', (color) => {
        const hexaColor = color.toHEXA().toString();
        document.getElementsByClassName('pcr-button')[0].style = `--pcr-color: ${hexaColor}`;
        setColor(hexaColor);
    });
  }

  function rgbaColor() {
    let hex = color.replace('#', '');
    let r = parseInt(hex.substring(0, 2), 16);
    let g = parseInt(hex.substring(2, 4), 16);
    let b = parseInt(hex.substring(4, 6), 16);
    let a = opacity / 100;
    return `rgba(${r}, ${g}, ${b}, ${a})`;
  }

  (function init() {
      initializePlayer();
  })()

  function initializePlayer() {
    var myplayer = videojs('my-video', {
        controls: true,
        autoplay: true,
        preload: 'auto',
    });

    myplayer.on('ready', () => {
        addScrollingWatermark(myplayer);
    });
  }

  let watermark;

  function addScrollingWatermark(player) {
    watermark = document.createElement('div');
    watermark.classList.add('vjs-watermark');
    watermark.textContent = watermarkText;

    var videoContainer = player.el();
    videoContainer.appendChild(watermark);
    watermark.style.color = rgbaColor();

    scrollWatermark();
  }

  let scrollInterval = null;
  function scrollWatermark() {
    if (scrollInterval !== null) {
        clearInterval(scrollInterval);
    }
    scrollInterval = setInterval(() => {
        if(type !=="dynamic"){
        return;
        }
        watermark.style.animation = 'scrollWatermark ' + interval + 's linear';
        watermark.style.display = 'block';
        watermark.style.top = `${positionY}%`;
        watermark.style.color = rgbaColor();
        watermark.style.fontSize = `${size}px`;

        setTimeout(() => {
            watermark.style.animation = '';
        }, interval * 1000);
        positionY += 20;
        if (positionY > 100) {
            positionY = 10;
        }
    }, (interval + skip) * 1000);
  }

  function staticWatermark() {
    watermark.style.animation = "none";
    if(position === "top-left"){
        watermark.style.top = '10%';
        watermark.style.left = '10%';
    }else if(position === "top-right"){
        watermark.style.top = '10%';
        watermark.style.left = '80%';
    }else if(position === "bottom-left"){
        watermark.style.top = '80%';
        watermark.style.left = '10%';
    }else if(position === "bottom-right"){
        watermark.style.top = '80%';
        watermark.style.left = '80%';
    }else{
        watermark.style.top = '50%';
        watermark.style.left = '50%';
    }
  }
</script>