<template x-for="request in filteredRequests" :key="request.id">
  <tr>
    <td class="size-px whitespace-nowrap px-4 py-3">
      <div class="w-full flex items-center gap-x-3">
        <template x-if="request.avatar">
          <img class="shrink-0 size-12 rounded-full" :src="request.avatar" :alt="request.user_name + ' Image'">
        </template>
        <template x-if="!request.avatar">
          <span
            class="flex shrink-0 justify-center items-center size-12 bg-white border border-gray-200 text-gray-700 text-lg font-medium uppercase rounded-full dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-300">
            <span x-text="request.user_name.split(' ').map(n => n[0]).join('').substring(0, 2)"></span>
          </span>
        </template>
        <div class="grow">
          <div class="flex items-center gap-x-2">
            <span class="text-sm font-medium text-gray-800 dark:text-neutral-200" x-text="request.user_name"></span>
            <template x-if="request.is_resubmission">
              <span
                class="inline-flex items-center gap-x-1.5 py-1 px-2 text-xs font-medium bg-amber-100 text-amber-800 rounded-full dark:bg-amber-500/10 dark:text-amber-500">
                Resubmission
              </span>
            </template>
          </div>
          <div class="mt-1">
            <span class="text-xs text-gray-500 dark:text-neutral-400" x-text="request.user_email"></span>
          </div>
          <div class="mt-0.5">
            <span class="text-xs text-gray-400 dark:text-neutral-500">ID: <span x-text="request.user_id"></span></span>
          </div>
        </div>
      </div>
    </td>

    <td class="size-px whitespace-nowrap px-4 py-1">
      <span class="text-sm text-gray-600 dark:text-neutral-400" x-text="request.location"></span>
    </td>

    <td class="size-px whitespace-nowrap px-4 py-1">
      <span class="text-sm text-gray-600 dark:text-neutral-400" x-text="request.cohort"></span>
    </td>

    <td class="size-px whitespace-nowrap px-4 py-1">
      <span class="text-sm text-gray-600 dark:text-neutral-400" x-text="request.submitted_at"></span>
    </td>

    <td class="size-px whitespace-nowrap px-4 py-1">
      <template x-if="request.status === 'pending'">
        <span
          class="capitalize py-1.5 px-2 inline-flex items-center gap-x-1.5 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full dark:bg-yellow-500/10 dark:text-yellow-500">
          Pending
        </span>
      </template>
      <template x-if="request.status === 'approved'">
        <span
          class="capitalize py-1.5 px-2 inline-flex items-center gap-x-1.5 text-xs font-medium bg-green-100 text-green-800 rounded-full dark:bg-green-500/10 dark:text-green-500">
          Approved
        </span>
      </template>
      <template x-if="request.status === 'rejected'">
        <span
          class="capitalize py-1.5 px-2 inline-flex items-center gap-x-1.5 text-xs font-medium bg-red-100 text-red-800 rounded-full dark:bg-red-500/10 dark:text-red-500">
          Rejected
        </span>
      </template>
    </td>

    <td class="size-px whitespace-nowrap px-4 pt-5 pb-1 align-top">
      <template x-if="request.status === 'pending'">
        <!-- Button Group -->
        <div class="flex justify-end items-center -space-x-px">
          <button type="button" @click="openApproveModal(request)"
            class="py-2 px-2.5 inline-flex items-center gap-x-1.5 text-xs font-medium first:rounded-s-lg last:rounded-e-lg border border-emerald-200 bg-emerald-600 text-white shadow-xs hover:bg-emerald-700 disabled:opacity-50 disabled:pointer-events-none focus:outline-hidden focus:bg-emerald-700 dark:bg-emerald-600 dark:border-emerald-600 dark:text-white dark:hover:bg-emerald-700 dark:focus:bg-emerald-700">
            <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m4.5 12.75 6 6 9-13.5"></path>
            </svg>
            Approve
          </button>
          <div
            class="hs-dropdown relative inline-flex [--auto-close:inside] [--placement:bottom-right] first:rounded-s-lg last:rounded-e-lg border border-gray-200 bg-white shadow-xs hover:bg-gray-50 dark:bg-neutral-800 dark:border-neutral-700 dark:hover:bg-neutral-700">
            <button id="hs-pro-ertmd-request-1" type="button"
              class="size-8 inline-flex justify-center items-center gap-x-2 rounded-e-lg text-gray-800 disabled:opacity-50 disabled:pointer-events-none focus:outline-hidden focus:bg-gray-50 dark:text-neutral-300 dark:focus:bg-neutral-700"
              aria-haspopup="menu" aria-expanded="false" aria-label="Dropdown">
              <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round">
                <circle cx="12" cy="12" r="1"></circle>
                <circle cx="12" cy="5" r="1"></circle>
                <circle cx="12" cy="19" r="1"></circle>
              </svg>
            </button>

            <div
              class="hs-dropdown-menu hs-dropdown-open:opacity-100 w-40 transition-[opacity,margin] duration opacity-0 hidden z-10 bg-white rounded-xl shadow-[0_10px_40px_10px_rgba(0,0,0,0.08)] dark:shadow-[0_10px_40px_10px_rgba(0,0,0,0.2)] dark:bg-neutral-900"
              role="menu" aria-orientation="vertical" aria-labelledby="hs-pro-ertmd-request-1">
              <div class="p-1">
                <button type="button" @click="openRejectModal(request)"
                  class="w-full flex items-center gap-x-3 py-1.5 px-2 rounded-lg text-[13px] text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none focus:outline-none focus:bg-gray-100 dark:text-neutral-300 dark:hover:bg-neutral-800 dark:focus:bg-neutral-800">
                  <svg class="shrink-0 size-3.5 text-red-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M6 18 18 6M6 6l12 12"></path>
                  </svg>
                  Reject
                </button>
                <button type="button" @click="openCustomFieldsModal(request)"
                  class="w-full flex items-center gap-x-3 py-1.5 px-2 rounded-lg text-[13px] text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:pointer-events-none focus:outline-none focus:bg-gray-100 dark:text-neutral-300 dark:hover:bg-neutral-800 dark:focus:bg-neutral-800">
                  <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                    viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <path d="M14 2v6h6"></path>
                    <path d="M16 13H8"></path>
                    <path d="M16 17H8"></path>
                    <path d="M10 9H8"></path>
                  </svg>
                  View Details
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- End Button Group -->
      </template>
      <template x-if="request.status !== 'pending'">
        <div class="flex justify-end">
          <button type="button" @click="openCustomFieldsModal(request)"
            class="py-2 px-2.5 inline-flex items-center gap-x-1.5 text-xs font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-xs hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none focus:outline-hidden focus:bg-gray-50 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-700 dark:focus:bg-neutral-700">
            <svg class="shrink-0 size-3.5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <path d="M14 2v6h6"></path>
              <path d="M16 13H8"></path>
              <path d="M16 17H8"></path>
              <path d="M10 9H8"></path>
            </svg>
            View Details
          </button>
        </div>
      </template>
    </td>
  </tr>

  <!-- Approval History Row (if resubmission) -->
  <template x-if="request.is_resubmission && request.approval_history && request.approval_history.length > 0">
    <tr class="bg-gray-50 dark:bg-neutral-800/50">
      <td colspan="6" class="px-4 py-3">
        {% include "./approval_history.html" %}
      </td>
    </tr>
  </template>
</template>