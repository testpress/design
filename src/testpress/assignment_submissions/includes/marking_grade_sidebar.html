<section x-data="markingGuide()" aria-labelledby="announcements-title">
  <div class="bg-white border border-gray-200 overflow-hidden rounded-xl">
    <div class="p-6">
      <h2 class="text-base font-medium text-gray-900">Assign Marks</h2>
      <div class="mt-2">
        <template x-for="(criterion, index) in criteria" :key="index">
          <div :class="index === 0 ? '' : 'mt-4'">
            <div class="flex space-x-2">
              <label
                class="text-sm font-medium text-gray-800 dark:text-neutral-200"
                :for="'marking-' + index"
                x-text="criterion.title"
              ></label>
              <div x-data="popOver()" class="relative">
                <button
                  tabindex="-1"
                  x-ref="popoverButton"
                  @click="popoverOpen=!popoverOpen"
                  class="cursor-pointer"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-4 h-5 text-gray-400 hover:cursor-pointer"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"
                    ></path>
                  </svg>
                </button>
                <div
                  x-ref="popover"
                  x-show="popoverOpen"
                  x-init="setTimeout(function(){ popoverHeightCalculate(); }, 100);"
                  @click.away="popoverOpen=false;"
                  @keydown.escape.window="popoverOpen=false"
                  :class="{ 'top-0 mt-6' : popoverPosition == 'bottom', 'bottom-0 mb-6' : popoverPosition == 'top' }"
                  class="z-50 absolute w-[300px] max-w-lg -translate-x-1/2 left-1/2"
                  x-cloak
                >
                  <div
                    x-ref="popoverInner"
                    x-show="popoverOpen"
                    class="w-full p-4 bg-white border rounded-md shadow-sm border-neutral-200/70"
                  >
                    <div
                      x-show="popoverArrow && popoverPosition == 'bottom'"
                      class="absolute top-0 inline-block w-5 mt-px overflow-hidden -translate-x-2 -translate-y-2.5 left-1/2"
                    >
                      <div
                        class="w-2.5 h-2.5 origin-bottom-left transform rotate-45 bg-white border-t border-l rounded-sm"
                      ></div>
                    </div>
                    <div
                      x-show="popoverArrow  && popoverPosition == 'top'"
                      class="absolute bottom-0 inline-block w-5 mb-px overflow-hidden -translate-x-2 translate-y-2.5 left-1/2"
                    >
                      <div
                        class="w-2.5 h-2.5 origin-top-left transform -rotate-45 bg-white border-b border-l rounded-sm"
                      ></div>
                    </div>
                    <div class="grid gap-4">
                      <span
                        x-text="criterion.marking_guide_for_evaluator"
                        class="block text-sm text-gray-600 dark:text-neutral-400"
                      >
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="w-28 relative px-3 py-2 border border-gray-300 rounded-md shadow-sm focus-within:ring-1 focus-within:ring-emerald-600 focus-within:border-emerald-600"
            >
              <input
                type="number"
                x-model="grade"
                name="score"
                class="block w-24 p-0 text-gray-900 placeholder-gray-500 border-0 focus:ring-0 sm:text-sm"
                :placeholder="'Marks / ' + criterion.maximum_marks"
                :max="criterion.maximum_marks"
                @input="if ($event.target.value > criterion.maximum_marks) $event.target.value = ''"
                step="1"
              />
            </div>
            <textarea
              class="mt-2 p-3 sm:p-4 block w-full border-gray-200 rounded-md sm:text-sm focus:border-emerald-500 focus:ring-emerald-500 resize-none disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600"
              placeholder="Feedback for the student"
            ></textarea>
          </div>
        </template>
      </div>

      <h2
        class="block mt-4 text-sm font-medium text-gray-800 dark:text-neutral-200"
      >
        Overall feedback for the student
      </h2>
      <textarea
        class="mt-1 p-3 sm:p-4 block w-full border-gray-200 rounded-md sm:text-sm focus:border-emerald-500 focus:ring-emerald-500 resize-none disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-neutral-400 dark:placeholder-neutral-500 dark:focus:ring-neutral-600"
      ></textarea>

      <!-- Drag 'n Drop -->
      <div class="space-y-2 mt-4">
        <label
          class="block mb-2 text-sm font-medium text-gray-800 dark:text-neutral-200"
        >
          Feedback Files (If any)
        </label>
        <div
          id="hs-file-upload-with-limited-file-size"
          data-hs-file-upload='{
        "url": "/upload",
        "maxFilesize": 10,
        "extensions": {
          "default": {
            "class": "shrink-0 size-5"
          },
          "xls": {
            "class": "shrink-0 size-5"
          },
          "zip": {
            "class": "shrink-0 size-5"
          },
          "csv": {
            "icon": "<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4\"/><path d=\"M14 2v4a2 2 0 0 0 2 2h4\"/><path d=\"m5 12-3 3 3 3\"/><path d=\"m9 18 3-3-3-3\"/></svg>",
            "class": "shrink-0 size-5"
          }
        }
      }'
        >
          <template data-hs-file-upload-preview="">
            <div
              class="p-3 bg-white border border-solid border-gray-300 rounded-xl dark:bg-neutral-800 dark:border-neutral-600"
            >
              <div class="mb-1 flex justify-between items-center">
                <div class="flex items-center gap-x-3">
                  <span
                    class="size-10 flex justify-center items-center border border-gray-200 text-gray-500 rounded-lg dark:border-neutral-700 dark:text-neutral-500"
                    data-hs-file-upload-file-icon=""
                  >
                    <img class="rounded-lg hidden" data-dz-thumbnail="" />
                  </span>
                  <div>
                    <p
                      class="text-sm font-medium text-gray-800 dark:text-white"
                    >
                      <span
                        class="truncate inline-block max-w-[300px] align-bottom"
                        data-hs-file-upload-file-name=""
                      ></span
                      >.<span data-hs-file-upload-file-ext=""></span>
                    </p>
                    <p
                      class="text-xs text-gray-500 dark:text-neutral-500"
                      data-hs-file-upload-file-size=""
                      data-hs-file-upload-file-success=""
                    ></p>
                    <p
                      class="text-xs text-red-500"
                      style="display: none"
                      data-hs-file-upload-file-error=""
                    >
                      File exceeds size limit.
                    </p>
                  </div>
                </div>
                <div class="flex items-center gap-x-2">
                  <span
                    class="hs-tooltip [--placement:top] inline-block"
                    style="display: none"
                    data-hs-file-upload-file-error=""
                  >
                    <span
                      class="hs-tooltip-toggle text-red-500 hover:text-red-800 focus:outline-none focus:text-red-800 dark:text-red-500 dark:hover:text-red-200 dark:focus:text-red-200"
                    >
                      <svg
                        class="shrink-0 size-4"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" x2="12" y1="8" y2="12"></line>
                        <line x1="12" x2="12.01" y1="16" y2="16"></line>
                      </svg>
                      <span
                        class="hs-tooltip-content max-w-[100px] hs-tooltip-shown:opacity-100 hs-tooltip-shown:visible opacity-0 transition-opacity inline-block absolute invisible z-10 py-1 px-2 bg-gray-900 text-xs font-medium text-white rounded shadow-sm dark:bg-neutral-700"
                        role="tooltip"
                      >
                        Please try to upload a file smaller than 1MB.
                      </span>
                    </span>
                  </span>
                  <button
                    type="button"
                    class="text-gray-500 hover:text-gray-800 focus:outline-none focus:text-gray-800 dark:text-neutral-500 dark:hover:text-neutral-200 dark:focus:text-neutral-200"
                    data-hs-file-upload-reload=""
                  >
                    <svg
                      class="shrink-0 size-4"
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path
                        d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"
                      ></path>
                      <path d="M21 3v5h-5"></path>
                    </svg>
                  </button>
                  <button
                    type="button"
                    class="text-gray-500 hover:text-gray-800 focus:outline-none focus:text-gray-800 dark:text-neutral-500 dark:hover:text-neutral-200 dark:focus:text-neutral-200"
                    data-hs-file-upload-remove=""
                  >
                    <svg
                      class="shrink-0 size-4"
                      xmlns="http://www.w3.org/2000/svg"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d="M3 6h18"></path>
                      <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                      <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                      <line x1="10" x2="10" y1="11" y2="17"></line>
                      <line x1="14" x2="14" y1="11" y2="17"></line>
                    </svg>
                  </button>
                </div>
              </div>

              <div class="flex items-center gap-x-3 whitespace-nowrap">
                <div
                  class="flex w-full h-2 bg-gray-200 rounded-full overflow-hidden"
                  role="progressbar"
                  aria-valuenow="0"
                  aria-valuemin="0"
                  aria-valuemax="100"
                  data-hs-file-upload-progress-bar=""
                >
                  <div
                    class="flex flex-col justify-center rounded-full overflow-hidden bg-emerald-600 text-xs text-white text-center whitespace-nowrap transition-all duration-500 hs-file-upload-complete:bg-emerald-500"
                    style="width: 0"
                    data-hs-file-upload-progress-bar-pane=""
                  ></div>
                </div>
                <div class="w-10 text-end">
                  <span class="text-sm text-gray-800">
                    <span data-hs-file-upload-progress-bar-value="">0</span>%
                  </span>
                </div>
              </div>
            </div>
          </template>
          <div
            class="cursor-pointer p-12 flex justify-center bg-white border border-dashed border-gray-300 rounded-xl dark:bg-neutral-800 dark:border-neutral-600"
            data-hs-file-upload-trigger=""
          >
            <div class="text-center">
              <svg
                class="w-16 text-gray-400 mx-auto"
                width="70"
                height="46"
                viewBox="0 0 70 46"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M6.05172 9.36853L17.2131 7.5083V41.3608L12.3018 42.3947C9.01306 43.0871 5.79705 40.9434 5.17081 37.6414L1.14319 16.4049C0.515988 13.0978 2.73148 9.92191 6.05172 9.36853Z"
                  fill="currentColor"
                  stroke="currentColor"
                  stroke-width="2"
                  class="fill-white stroke-gray-400"
                />
                <path
                  d="M63.9483 9.36853L52.7869 7.5083V41.3608L57.6982 42.3947C60.9869 43.0871 64.203 40.9434 64.8292 37.6414L68.8568 16.4049C69.484 13.0978 67.2685 9.92191 63.9483 9.36853Z"
                  fill="currentColor"
                  stroke="currentColor"
                  stroke-width="2"
                  class="fill-white stroke-gray-400"
                />
                <rect
                  x="17.0656"
                  y="1.62305"
                  width="35.8689"
                  height="42.7541"
                  rx="5"
                  fill="currentColor"
                  stroke="currentColor"
                  stroke-width="2"
                  class="fill-white stroke-gray-400"
                />
                <path
                  d="M47.9344 44.3772H22.0655C19.3041 44.3772 17.0656 42.1386 17.0656 39.3772L17.0656 35.9161L29.4724 22.7682L38.9825 33.7121C39.7832 34.6335 41.2154 34.629 42.0102 33.7025L47.2456 27.5996L52.9344 33.7209V39.3772C52.9344 42.1386 50.6958 44.3772 47.9344 44.3772Z"
                  stroke="currentColor"
                  stroke-width="2"
                  class="stroke-gray-400"
                />
                <circle
                  cx="39.5902"
                  cy="14.9672"
                  r="4.16393"
                  stroke="currentColor"
                  stroke-width="2"
                  class="stroke-gray-400 dark:stroke-neutral-500"
                />
              </svg>

              <div
                class="mt-4 flex flex-wrap justify-center text-sm leading-6 text-gray-600"
              >
                <span class="pe-1 font-medium text-gray-800">
                  Drop your files here or
                </span>
                <label
                  for="@@browseID"
                  class="relative cursor-pointer bg-white font-semibold text-emerald-600 hover:text-emerald-700 rounded-lg decoration-2 hover:underline focus-within:outline-none focus-within:ring-2 focus-within:ring-emerald-600 focus-within:ring-offset-2"
                >
                  <span>browse</span>
                  <input id="@@browseID" type="file" class="sr-only" />
                </label>
              </div>

              <p class="mt-1 text-xs text-gray-400 dark:text-neutral-400">
                CSV, XLS, DOCX
              </p>
            </div>
          </div>
          <div
            class="mt-4 space-y-2 empty:mt-0"
            data-hs-file-upload-previews=""
          ></div>
        </div>
      </div>
      <!-- End Drag 'n Drop -->
    </div>
  </div>
</section>
