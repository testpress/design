<script src="https://cdn.jsdelivr.net/npm/values.js"></script>
<script>
  function iconBackgroundComponents() {
    return {
      // --- SVG pattern generators ---
      patterns: {
        polkadots(fill) {
          return `data:image/svg+xml,${encodeURIComponent(`
            <svg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'>
              <g fill='${fill}' fill-opacity='0.4' fill-rule='evenodd'>
                <circle cx='3' cy='3' r='3'/>
                <circle cx='13' cy='13' r='3'/>
              </g>
            </svg>
          `)}`;
        },
hexagons(fill) {
  return `data:image/svg+xml,${encodeURIComponent(`
    <svg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'>
      <g fill-rule='evenodd'>
        <g id='hexagons' fill='${fill}' fill-opacity='0.4' fill-rule='nonzero'>
          <path d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5z
                   M3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9z
                   M0 15l12.98-7.5V0h-2v6.35L0 12.69v2.3z
                   M0 33.5L12.98 41v8h-2v-6.85L0 35.81v-2.3z
                   M15 0v7.5L27.99 15H28v-2.31h-.01L17 6.35V0h-2z
                   M15 49v-8l12.99-7.5H28v2.31h-.01L17 42.15V49h-2z'/>
        </g>
      </g>
    </svg>
  `)}`;
},

        zigzag(fill) {
          return `data:image/svg+xml,${encodeURIComponent(`
            <svg width='40' height='12' viewBox='0 0 40 12' xmlns='http://www.w3.org/2000/svg'>
              <path d='M0 6.172L6.172 0h5.656L0 11.828V6.172zm40 5.656L28.172 0h5.656L40 6.172v5.656zM6.172 12l12-12h3.656l12 12h-5.656L20 3.828 11.828 12H6.172zm12 0L20 10.172 21.828 12h-3.656z' fill='${fill}' fill-opacity='0.4' fill-rule='evenodd'/>
            </svg>
          `)}`;
        },
graphpaper(fill) {
  return `data:image/svg+xml,${encodeURIComponent(`
    <svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'>
      <g fill-rule='evenodd'>
        <g fill='${fill}' fill-opacity='0.4'>
          <path opacity='.5' d='M96 95h4v1h-4v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4h-9v4h-1v-4H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15v-9H0v-1h15V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h9V0h1v15h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9h4v1h-4v9zm-1 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm9-10v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-10 0v-9h-9v9h9zm-9-10h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9zm10 0h9v-9h-9v9z'/>
          <path d='M6 5V0H5v5H0v1h5v94h1V6h94V5H6z'/>
        </g>
      </g>
    </svg>
  `)}`;
},



        flippeddiamonds(fill) {
          return `data:image/svg+xml,${encodeURIComponent(`
            <svg width='16' height='20' viewBox='0 0 16 20' xmlns='http://www.w3.org/2000/svg'>
              <g fill='${fill}' fill-opacity='0.4' fill-rule='evenodd'>
                <path d='M8 0v20L0 10M16 0v10L8 0M16 10v10H8'/>
              </g>
            </svg>
          `)}`;
        },
        diagonallines(fill) {
          return `data:image/svg+xml,${encodeURIComponent(`
            <svg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'>
              <g fill='${fill}' fill-opacity='0.4' fill-rule='evenodd'>
                <path d='M5 0h1L0 6V5zM6 5v1H5z'/>
              </g>
            </svg>
          `)}`;
        },
eyes(fill) {
  return `data:image/svg+xml,${encodeURIComponent(`
    <svg width='20' height='12' viewBox='0 0 20 12' xmlns='http://www.w3.org/2000/svg'>
      <path d='M6 12c0-.622-.095-1.221-.27-1.785A5.982 5.982 0 0 0 10 12c1.67 0 3.182-.683 4.27-1.785A5.998 5.998 0 0 0 14 12h2a4 4 0 0 1 4-4V6c-1.67 0-3.182.683-4.27 1.785C15.905 7.22 16 6.622 16 6c0-.622-.095-1.221-.27-1.785A5.982 5.982 0 0 0 20 6V4a4 4 0 0 1-4-4h-2c0 .622.095 1.221.27 1.785A5.982 5.982 0 0 0 10 0C8.33 0 6.818.683 5.73 1.785 5.905 1.22 6 .622 6 0H4a4 4 0 0 1-4 4v2c1.67 0 3.182.683 4.27 1.785A5.998 5.998 0 0 1 4 6c0-.622.095-1.221.27-1.785A5.982 5.982 0 0 1 0 6v2a4 4 0 0 1 4 4h2zm-4 0a2 2 0 0 0-2-2v2h2zm16 0a2 2 0 0 1 2-2v2h-2zM0 2a2 2 0 0 0 2-2H0v2zm20 0a2 2 0 0 1-2-2h2v2zm-10 8a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm0-2a2 2 0 1 0 0-4 2 2 0 0 0 0 4z' fill='${fill}' fill-opacity='0.4' fill-rule='evenodd'/>
    </svg>
  `)}`;
},

      },



      // --- Main style generator ---
set_icon_bg({ icon_bg_color, icon_bg_pattern }) {
  if (!icon_bg_color || !icon_bg_pattern) return '';

  // ensure valid format
  const colorStr = icon_bg_color.includes('rgb')
    ? icon_bg_color
    : `rgb${icon_bg_color}`;

  const vals = new Values(colorStr);
  const bg100 = vals.tint(87).rgbString();
  const hexFill = vals.tint(20).hexString();

  const patternFunc = this.patterns[icon_bg_pattern];
  const patternUrl = patternFunc ? patternFunc(hexFill) : 'none';

  return `
    background-color: ${bg100};
    background-image: url("${patternUrl}");
    background-size: auto;
  `;
}

    };
  }
</script>
