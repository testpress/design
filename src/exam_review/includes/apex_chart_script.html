<script src="https://preline.co/pro/assets/vendor/lodash/lodash.min.js"></script>
<script src="https://preline.co/pro/assets/vendor/apexcharts/dist/apexcharts.min.js"></script>
<script src="https://preline.co/pro/assets/js/hs-apexcharts-helpers.js"></script>

<script>
  window.addEventListener('load', () => {
    initDonutChart();
  });

  function initDonutChart() {
    buildChart('#hs-pie-chart', getDonutChartOptions, getDonutThemeOptions(), getDonutThemeOptions());
  }

  function getDonutChartOptions(mode) {
    return {
      chart: getDonutChartBaseConfig(),
      plotOptions: getDonutChartPlotOptions(),
      series: [10, 5, 5],
      labels: ['Correct', 'Incorrect', 'Unanswered'],
      legend: { show: false },
      dataLabels: { enabled: false },
      stroke: { width: 5 },
      grid: getGridPadding(),
      states: getChartStates(),
      tooltip: getCustomTooltip()
    };
  }

  function getDonutChartBaseConfig() {
    return {
      height: 230,
      width: 230,
      type: 'donut',
      zoom: { enabled: false },
      events: {
        dataPointSelection: (event, chartContext, config) => {
          chartContext.toggleDataPointSelection(config.seriesIndex);
        }
      }
    };
  }

  function getDonutChartPlotOptions() {
    return {
      pie: {
        donut: {
          size: '76%'
        }
      }
    };
  }

  function getGridPadding() {
    return {
      padding: {
        top: -12,
        bottom: -11,
        left: -12,
        right: -12
      }
    };
  }

  function getChartStates() {
  return {
    hover: {
      filter: { type: 'none', value: 0 }
    },
    active: {
      allowMultipleDataPointsSelection: false,
    }
  };
}

  function getCustomTooltip() {
    return {
      enabled: true,
      custom: ({ series, seriesIndex, w }) => {
        const label = w.globals.labels[seriesIndex];
        const value = series[seriesIndex];
        const total = series.reduce((a, b) => a + b, 0);
        const percentage = ((value / total) * 100).toFixed(1);
        const color = w.globals.colors[seriesIndex];

        return `
          <div class="border border-gray-300 bg-white w-36 text-gray-900 shadow-xl">
            <div class="px-2 py-1.5 font-semibold text-[13px] flex items-center">
              <span>${label}</span>
              <span class="ms-auto">${percentage}%</span>
            </div>
            <div class="border-t border-gray-200"></div>
            <div class="space-y-1.5 p-2">
              <div class="flex items-center gap-x-2 text-xs text-gray-600">
                <span class="w-3 h-3 rounded-sm inline-block" style="background:${color}"></span>
                <span>Questions</span>
                <span class="ms-auto">${value}</span>
              </div>
            </div>
          </div>
        `;
      }
    };
  }

  function getDonutThemeOptions() {
    return {
      colors: ['#22c55e', '#ef4444', '#f97316'],
      stroke: {
        colors: ['#ffffff']
      }
    };
  }
</script>


<script>
  window.addEventListener('load', () => {
    initSectionWiseReportChart();
  });

  function initSectionWiseReportChart() {
    buildChart('#section_wise_report', getSectionWiseChartOptions, getThemeOptions());
  }

  function getSectionWiseChartOptions(mode) {
    return {
      chart: getChartBaseConfig(),
      series: getChartSeries(),
      colors: getChartColors(),
      plotOptions: getPlotOptions(),
      legend: { show: false },
      dataLabels: { enabled: false },
      stroke: getStrokeOptions(),
      xaxis: getXAxisOptions(),
      yaxis: getYAxisOptions(),
      tooltip: getTooltipConfig(mode),
      states: getHoverState(),
      responsive: getResponsiveOptions()
    };
  }

  function getChartBaseConfig() {
    return {
      type: 'bar',
      height: 300,
      toolbar: { show: false },
      zoom: { enabled: false }
    };
  }

  function getChartSeries() {
    return [
      { name: 'Total Questions', data: [35, 35, 30] },
      { name: 'Correct', data: [24, 28, 20] },
      { name: 'Incorrect', data: [6, 4, 8] },
      { name: 'Unanswered', data: [5, 3, 2] }
    ];
  }

  function getChartColors() {
    return ['#3b82f6', '#22c55e', '#ef4444', '#f97316'];
  }

  function getPlotOptions() {
    return {
      bar: {
        horizontal: false,
        columnWidth: '40%',
        borderRadius: 0
      }
    };
  }

  function getStrokeOptions() {
    return {
      show: true,
      width: 2,
      colors: ['transparent']
    };
  }

  function getXAxisOptions() {
    return {
      categories: ['Quantitative Aptitude', 'Reasoning Ability', 'English Language'],
      axisBorder: { show: false },
      axisTicks: { show: false },
      crosshairs: { show: false },
      labels: getLabelStyle(13)
    };
  }

  function getYAxisOptions() {
    return {
      labels: {
        align: 'left',
        minWidth: 0,
        maxWidth: 140,
        ...getLabelStyle(13)
      }
    };
  }

  function getLabelStyle(fontSize) {
    return {
      style: {
        colors: '#a8a29e',
        fontSize: `${fontSize}px`,
        fontFamily: 'Inter, ui-sans-serif',
        fontWeight: 400
      },
      offsetX: -2,
      formatter: (val) => val
    };
  }

  function getTooltipConfig(mode) {
    return {
      custom: function (props) {
        const { categories } = props.ctx.opts.xaxis;
        const { dataPointIndex } = props;

        return buildTooltip(props, {
          title: categories[dataPointIndex],
          mode,
          hasCategory: false,
          hasTextLabel: true,
          wrapperExtClasses: 'min-w-36',
          isValueDivided: false,
          valuePrefix: '',
          labelDivider: ':',
          labelExtClasses: 'ms-2'
        });
      }
    };
  }

  function getHoverState() {
    return {
      hover: {
        filter: {
          type: 'none',
          value: 0.9
        }
      }
    };
  }

  function getResponsiveOptions() {
    return [{
      breakpoint: 568,
      options: {
        chart: { height: 300 },
        plotOptions: {
          bar: { columnWidth: '100%' }
        },
        stroke: { width: 10 },
        xaxis: {
          labels: getLabelStyle(11)
        },
        yaxis: {
          labels: {
            align: 'left',
            minWidth: 0,
            maxWidth: 140,
            ...getLabelStyle(11)
          }
        }
      }
    }];
  }

  function getThemeOptions() {
    return {
      colors: getChartColors(),
      grid: {
        borderColor: '#e5e5e5'
      },
      xaxis: {
        labels: {
          style: {
            colors: '#a8a29e'
          }
        }
      },
      yaxis: {
        labels: {
          style: {
            colors: '#a8a29e'
          }
        }
      }
    };
  }
</script>
