<div id="hs-pro-mistake-reflection" class="hs-overlay pointer-events-none fixed start-0 top-0 z-[99] hidden size-full overflow-x-hidden overflow-y-auto [--close-when-click-inside:true]" role="dialog" tabindex="-1" aria-labelledby="hs-pro-mistake-reflection-label">
  <div class="hs-overlay-open:mt-7 hs-overlay-open:opacity-100 hs-overlay-open:duration-500 m-3 mt-0 flex h-[calc(100%-56px)] min-h-[calc(100%-56px)] items-center opacity-0 transition-all ease-out sm:mx-auto sm:w-full sm:max-w-xl">
    <div class="pointer-events-auto flex w-full flex-col rounded-xl bg-white shadow-xl dark:bg-neutral-800">
      <div class="flex items-center justify-between border-b border-stone-200 px-4 py-2.5 dark:border-neutral-700">
        <h3 id="hs-pro-mistake-reflection-label" class="font-medium text-stone-800 dark:text-neutral-200">Reasons for Errors</h3>
        <button type="button" class="flex size-8 shrink-0 items-center justify-center gap-x-2 rounded-full border border-transparent bg-stone-100 text-stone-800 hover:bg-stone-200 focus:bg-stone-200 focus:outline-hidden disabled:pointer-events-none disabled:opacity-50 dark:bg-neutral-700 dark:text-neutral-400 dark:hover:bg-neutral-600 dark:focus:bg-neutral-600" aria-label="Close" data-hs-overlay="#hs-pro-mistake-reflection">
          <span class="sr-only">Close</span>
          <svg class="size-4 shrink-0" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 6 6 18" />
            <path d="m6 6 12 12" />
          </svg>
        </button>
      </div>

      <div id="hs-modal-mistake-reflection-body" class="max-h-[75dvh] space-y-6 overflow-y-auto p-4 [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:bg-stone-300 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500 [&::-webkit-scrollbar-track]:bg-stone-100 dark:[&::-webkit-scrollbar-track]:bg-neutral-700">
        <div class="rounded-lg border border-gray-200 bg-gray-50 p-3 dark:border-neutral-700 dark:bg-neutral-900">
          <p class="text-xs font-medium text-gray-500 dark:text-neutral-400 mb-1">Question No. <span x-text="currentQuestion.q_no"></span></p>
          <p class="text-sm text-gray-800 dark:text-neutral-200 line-clamp-2" x-text="currentQuestion.question"></p>
        </div>

        <div>
          <h4 class="text-sm font-medium text-gray-900 dark:text-neutral-200 mb-3">Why did you get this question wrong?</h4>
          <div class="mt-3">
            <div class="grid grid-cols-1 gap-2 sm:grid-cols-2">
              {% for reason in question_mistake_reflection %}
                <label for="hs-pro-mistake-reason-{{ reason.value }}" class="relative flex cursor-pointer rounded-lg bg-white px-3 py-2 text-sm focus:outline-hidden dark:bg-neutral-800">
                  <input 
                    type="radio" 
                    id="hs-pro-mistake-reason-{{ reason.value }}" 
                    name="hs-pro-mistake-reason" 
                    value="{{ reason.value }}"
                    data-description="{{ reason.description | escape }}"
                    onchange="showMistakeDescription(this)"
                    class="peer absolute start-0 top-0 size-full cursor-pointer rounded-lg border border-gray-200 bg-transparent text-transparent after:relative after:-z-1 after:block after:size-full after:rounded-lg checked:border-emerald-600 checked:bg-none checked:text-transparent checked:hover:border-emerald-600 focus:border-emerald-600 focus:ring-0 focus:ring-offset-0 checked:focus:border-emerald-600 disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-700 dark:checked:border-emerald-500 dark:checked:after:bg-emerald-500/10 dark:focus:border-neutral-600"
                  />
                  <span class="peer-checked:text-emerald-600 dark:text-white dark:peer-checked:text-emerald-500">
                    {{ reason.name }}
                  </span>
                </label>
              {% endfor %}
            </div>
          </div>
        </div>
  
        <div id="mistake-description-display" class="hidden">
          <label class="block text-sm font-medium text-gray-900 dark:text-neutral-200 mb-2">Description</label>
          <div class="rounded-lg border border-gray-200 bg-gray-50 p-3 dark:border-neutral-700 dark:bg-neutral-900">
            <p id="mistake-description-text" class="text-sm text-gray-800 dark:text-neutral-200"></p>
          </div>
        </div>
      </div>
  
      <div class="flex justify-between gap-x-2 border-t border-stone-200 p-4 dark:border-neutral-700">
        <div class="flex flex-1 items-center justify-end gap-2">
          <button type="button" class="inline-flex items-center justify-center rounded-lg border border-gray-200 bg-white px-3 py-2 text-start align-middle text-sm font-medium text-nowrap whitespace-nowrap text-gray-800 shadow-2xs hover:bg-gray-50 focus:bg-gray-50 focus:outline-hidden disabled:pointer-events-none disabled:opacity-50 dark:border-neutral-700 dark:bg-neutral-800 dark:text-neutral-300 dark:hover:bg-neutral-700 dark:focus:bg-neutral-700" data-hs-overlay="#hs-pro-mistake-reflection">Skip</button>
          <button type="button" class="inline-flex items-center justify-center gap-x-2 rounded-lg border border-emerald-600 bg-emerald-600 px-3 py-2 text-start align-middle text-sm font-medium text-nowrap whitespace-nowrap text-white shadow-2xs hover:bg-emerald-700 focus:ring-1 focus:ring-emerald-300 focus:outline-hidden disabled:pointer-events-none disabled:opacity-50 dark:focus:ring-emerald-500" data-hs-overlay="#hs-pro-mistake-reflection">Save Reflection</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function showMistakeDescription(radioElement) {
    const desc = radioElement.getAttribute('data-description') || '';
    const descriptionContainer = document.getElementById('mistake-description-display');
    const descriptionText = document.getElementById('mistake-description-text');

    if (desc.trim()) {
      descriptionText.textContent = desc;
      descriptionContainer.classList.remove('hidden');
    } else {
      descriptionText.textContent = '';
      descriptionContainer.classList.add('hidden');
    }
  }
</script>