<script>
  function reviewAnswerComponent() {
    return {
      sections: [
  {
    id:1,
    name: "Quantitative Aptitude",
    questions: [
      {
        id: 1,
        q_no: 1,
        type:'mcq',
        question: "What is the value of (15 + 25) × 2?",
        options: ["80", "70", "60", "90"],
        correctIndex: 1,
        selectedIndex: 1,
        explanation: "(15 + 25) × 2 = 40 × 2 = 80.",
        total: 1,
        negative: 0.25,
        awarded: 1,
        subject: "Time and Work",
        time_taken: "01:10",
        trivia: 92,
        response_status: "correct",  
      },

      {
        id: 2,
        q_no: 2,
        type:'mcq',
        question: "A train runs at 60 km/h. How long will it take to cover 180 km?",
        options: ["2 hours", "3 hours", "4 hours", "2.5 hours"],
        correctIndex: 1,
        selectedIndex: 0,
        explanation: "Time = Distance / Speed = 180 / 60 = 3 hours.",
        total: 1,
        negative: 0.25,
        awarded: 0,
        subject: "Simplification",
        time_taken: "01:45",
        trivia: 67,
        response_status: "incorrect",  
      },
      {
        id: 3,
        q_no: 3,
        type:'mcq',
        question: "What is the simple interest on ₹5000 at 5% per annum for 2 years?",
        options: ["₹500", "₹400", "₹450", "₹550"],
        correctIndex: 0,
        selectedIndex: null,
        explanation: "SI = (P × R × T) / 100 = (5000 × 5 × 2) / 100 = ₹500.",
        total: 1,
        negative: 0.25,
        awarded: 0,
        subject: "Data Interpretation",
        time_taken: "02:00",
        trivia: 74,
        response_status: "unanswered",  
      },
      {
        id: 4,
        q_no: 4,
        type:'mcq',
        question: "If the ratio of boys to girls is 3:2, how many girls are there in a class of 30 students?",
        options: ["12", "15", "18", "10"],
        correctIndex: 0,
        selectedIndex: 0,
        explanation: "Total parts = 3+2 = 5; Girls = (2/5)×30 = 12.",
        total: 1,
        negative: 0.25,
        awarded: 1,
        subject: "Data Interpretation",
        time_taken: "1:30",
        trivia: 86,
        response_status: "correct",  
      },
      {
      id: 21,
      q_no: 5,
      type: "essay",
      question: "Discuss the impact of climate change on global agriculture.",
      user_answer: "Climate change affects agriculture through changes in rainfall patterns, increased pests, and extreme weather events. These disrupt crop yields, especially in developing nations.",
      response_status:"correct",
      options:[],
      feedback:
        {
          "responder": "Evaluator A",
          "response": "Good understanding of key issues. Could improve by including mitigation strategies."
        },
      total: 10,
      awarded: 8,
      negative:0,
      subject: "Environment",
      explanation: "An ideal answer should mention the effects of climate change such as altered precipitation, rising temperatures, soil degradation, and increased pest pressure. It should also discuss how these affect crop productivity, food security, and highlight adaptation or mitigation measures.",
      time_taken: "07:30",
      trivia: 82,
      show_answer: false
    },
    {
      id: 22,
      q_no: 6,
      type: "essay",
      question: "Evaluate the effectiveness of public health policies during the COVID-19 pandemic.",
      user_answer: "Public health policies such as lockdowns, mass vaccination, and social distancing played a crucial role in slowing down the spread. However, the implementation and outcomes varied significantly across countries.",
      response_status: "pending_evaluation",
      options: [],
      feedback: {},
      total: 10,
      awarded: '_',
      negative: 0,
      subject: "Public Health",
      explanation: "An effective answer should address global policy responses, assess successes and failures, and mention data-driven decisions, resource allocation, and public compliance.",
      time_taken: "12:45",
      trivia: 67,
      show_answer: false
    }
    ],
  },
  {
    id:2,
    name: "Logical Reasoning",
    questions: [
      {
        id: 5,
        q_no: 1,
        type:'mcq',
        question: "What comes next in the series: 3, 6, 12, 24, __?",
        options: ["36", "40", "48", "60"],
        correctIndex: 2,
        selectedIndex: 2,
        explanation: "Series doubles: 3×2=6, 6×2=12, etc. Next is 24×2=48.",
        total: 1,
        negative: 0.25,
        awarded: 1,
        subject: "Syllogism",
        time_taken: "00:55",
        trivia: 89,
        response_status: "correct",  
      },
      {
      id: 10,
      q_no: 2,
      question: "Match the following",
      type:'match',
      options: ["Apple", "Carrot", "Rose"],
      answer:["Fruit","Vegetable","Flower"],
      user_answer:[null,"Vegetable","Flower"],
      explanation: "Apple is a Fruit, Carrot is a Vegetable, and Rose is a Flower.",
      total: 2,
      negative: 0.5,
      awarded: 0,
      subject: "Matching Type",
      time_taken: "01:30",
      trivia: 72,
      show_answer: false,
      response_status: "incorrect",  
    },
    {
    id: 3,
    q_no: 4,
    type: "gap_fill",
    question: "If all cats are [], and some [] are animals, then some cats are animals.",
    options: [],
    correctIndex: null,
    selectedIndex: null,
    user_answer: ["mammals", "dogs"],
    correct_answer: ["mammals", "mammals"],
    explanation: "To conclude that some cats are animals, the second blank must also be 'mammals' to maintain logical consistency.",
    total: 1,
    negative: 0.25,
    awarded: 0,
    subject: "Logical Reasoning",
    time_taken: "01:20",
    trivia: 76,
    response_status: "incorrect"
  },
  {
  id: 5,
  q_no: 5,
  type: "mcq",
  question_passage: "A man walks 30 meters towards the north. Then he turns right and walks 20 meters. He again turns right and walks 30 meters. Finally, he turns left and walks 10 meters.",
  question: "How far is he from the starting point?",
  options: ["10 meters", "20 meters", "30 meters", "40 meters"],
  correctIndex: 0,
  selectedIndex: 0,
  explanation: "After the movement, he ends up 10 meters to the east of his starting point.",
  total: 1,
  negative: 0.25,
  awarded: 1,
  subject: "Direction Sense",
  time_taken: "01:05",
  trivia: 86,
  response_status: "correct"
},
{
  id: 6,
  q_no: 6,
  type: "file",
  question: "Write an essay on the challenges of urbanization in developing countries. Your answer should include causes, consequences, and possible policy solutions.",
  options: [],
  correctIndex: null,
  selectedIndex: null,
  user_answer: {
    file_url: "https://example.com/uploads/urbanization_essay_karthik.pdf",
    filename: "urbanization_essay_karthik.pdf"
  },
  correct_answer: null,
  explanation: "An ideal essay should analyze how rapid population growth, lack of infrastructure, housing shortages, and environmental degradation impact urban development. It should also propose viable urban planning and governance strategies.",
  total: 10,
  negative: 0,
  awarded: "_",
  subject: "Urban Studies",
  time_taken: "25:40",
  trivia: 73,
  response_status: "pending_evaluation",
  show_answer: false
},
    ],
  },
  {
    id:3,
    name: "English Language",
    questions: [
      {
        id: 6,
        q_no: 1,
        type:'mcq',
        question: "Choose the word that is most similar in meaning to 'Benevolent'.",
        options: ["Cruel", "Kind", "Harsh", "Lazy"],
        correctIndex: 1,
        selectedIndex: null,
        explanation: "'Benevolent' means kind and well-meaning. Hence, the correct answer is 'Kind'.",
        total: 1,
        negative: 0.25,
        awarded: 0,
        subject: "Reading Comprehension",
        time_taken: "01:20",
        trivia: 78,
        show_answer: false,
        response_status: "unanswered",  
      },
      {
        id: 7,
        q_no: 2,
        type:'mcq',
        question: "Identify the grammatically correct sentence.",
        options: [
          "She don't like coffee.",
          "He go to school every day.",
          "They enjoys playing football.",
          "I have been waiting for an hour."
        ],
        correctIndex: 3,
        selectedIndex: null,
        explanation: "Option D is grammatically correct. Others have subject-verb agreement errors.",
        total: 1,
        negative: 0.25,
        awarded: 0,
        subject: "Close Test",
        time_taken: "02:00",
        trivia: 61,
        show_answer: false,
        response_status: "unanswered",  
      },
      {
        id: 8,
        q_no: 3,
        type:'mcq',
        question: "Fill in the blank: He is confident _____ his success.",
        options: ["of", "for", "about", "to"],
        correctIndex: 0,
        selectedIndex: 0,
        explanation: "The correct preposition is 'of' — 'confident of success' is the correct phrase.",
        total: 1,
        negative: 0.25,
        awarded: 1,
        subject: " Error Spotting",
        time_taken: "00:45",
        trivia: 83,
        show_answer: false,
        response_status: "correct",  
      }
    ]
  }
],

  
      selectedSectionIndex: 0,
      selectedQuestionIndex: 0,
      showAllAnswersOption: 'hide',
      filter: "all", // All, Correct, Incorrect, Unanswered
      view_preference: "one",
      selected_view_preference: "one",
      selectedfilter: "all",
      selectedshowAllAnswersOption: 'hide',
  
      get currentSection() {
        return this.sections[this.selectedSectionIndex];
      },
  
      get filteredQuestions() {
      return this.currentSection.questions.filter(q => {
        if (this.filter === 'correct') {
          return q.response_status === 'correct';
        }
        if (this.filter === 'incorrect') {
          return q.response_status === 'incorrect';
        }
        if (this.filter === 'unanswered') {
          return q.response_status === 'unanswered';
        }

        if (this.filter === 'pending_evaluation') {
          return q.response_status === 'pending_evaluation';
        }
        // 'All'
        return true;
      });
    },

  

      get currentQuestion() {
        const questions = this.filteredQuestions;
        return questions.length > 0 ? questions[this.selectedQuestionIndex] : {};
      },
  
      hasNext() {
        return this.selectedQuestionIndex < this.filteredQuestions.length - 1;
      },

      hasPrevious() {
        return this.selectedQuestionIndex > 0;
      },
  
      nextQuestion() {
        if (this.selectedQuestionIndex < this.filteredQuestions.length - 1) {
          this.selectedQuestionIndex++;
        } else if (this.selectedSectionIndex < this.sections.length - 1) {
          this.selectedSectionIndex++;
          this.selectedQuestionIndex = 0;
        }
      },
  
      previousQuestion() {
        if (this.selectedQuestionIndex > 0) {
          this.selectedQuestionIndex--;
        } else if (this.selectedSectionIndex > 0) {
          this.selectedSectionIndex--;
          this.selectedQuestionIndex = this.filteredQuestions.length - 1;
        }
      },
  
      jumpToQuestion(qIndex) {
        this.selectedQuestionIndex = qIndex;
      },
  
      setFilter(type) {
        this.filter = type;
        this.filteredQuestions;
      },

      applyAnswerPreference() {
    this.showAllAnswers = this.showAllAnswersOption === 'show';
    this.sections.forEach(section =>
      section.questions.forEach(q => q.show_answer = this.showAllAnswers)
    );
  },

renderGapFill(questionObj) {
  if (!questionObj || !questionObj.question) return '';

  const parts = questionObj.question.split('[]');
  const userAnswers = questionObj.user_answer || [];
  const correctAnswers = questionObj.correct_answer || [];

  let result = '';
  parts.forEach((part, i) => {
    result += part;
    if (i < userAnswers.length) {
      const userAns = userAnswers[i]?.trim();
      const correctAns = correctAnswers[i]?.trim();
      let style = '';

      if (!userAns) {
        style = 'border-b border-gray-500 inline-block min-w-[40px]';
        result += `<span class="${style}"></span>`;
      } else if (userAns === correctAns) {
        style = 'text-green-600 font-semibold border-b-2 border-green-500 px-1';
        result += `<span class="${style}">${userAns}</span>`;
      } else {
        style = 'text-red-600 font-semibold border-b-2 border-red-500 px-1';
        result += `<span class="${style}">${userAns}</span>`;
      }
    }
  });

  return result;
},

renderCorrectAnswers(q) {
  if (!q || !q.question) return '';
  const parts = q.question.split('[]');
  const correct = q.correct_answer || [];

  let html = '';
  parts.forEach((text, i) => {
    html += text;
    if (i < correct.length) {
      const c = correct[i]?.trim();
      const style = 'text-green-600 font-medium border-b border-green-600 font-semibold px-1';
      html += `<span class="${style}">${c}</span>`;
    }
  });

  return html;
},


  goToQuestion(i) {
  if (this.view_preference === 'one') {
    this.selectedQuestionIndex = i;
  } else {
    const target = document.getElementById(`q_${this.currentSection.id}_${i}`);
    if (target) {
      const topOffset = 140; // 8.75rem ≈ 140px
      const elementPosition = target.getBoundingClientRect().top + window.scrollY;
      const offsetPosition = elementPosition - topOffset;

      window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
    }
  }
},

  applyChanges() {
    this.view_preference = this.selected_view_preference;
    this.filter = this.selectedfilter;
    this.showAllAnswersOption = this.selectedshowAllAnswersOption;
    this.applyAnswerPreference()
  },
    };
  }

  function toggleModalVisibility(modal_button_id, should_show) {
    if (should_show) {
      let modal = new HSOverlay(document.querySelector(`#${modal_button_id}`));
      modal.open()
    } else {
      const {
        element
      } = HSOverlay.getInstance(`#${modal_button_id}`, true);
      element.close()
    }
  }
  </script>
  