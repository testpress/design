<div class="flex flex-col bg-white border border-gray-200 shadow-2xs rounded-xl dark:bg-neutral-800 dark:border-neutral-700">
  <div class="py-3 px-5 flex justify-between items-center border-b border-gray-200 dark:border-neutral-700">
    <h2 class="inline-block font-semibold text-gray-800 dark:text-neutral-200">
      Steps you can take to improve
    </h2>
  </div>

  <div x-show="loading.pathway">
    {% include "./loader.html" %}
  </div>

  <template x-if="!loading.pathway">
    <div class="p-5" x-cloak>
      <template x-if="pathway.topErrors && pathway.topErrors.length > 0">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-10">
          <div class="flex flex-col bg-white border border-gray-200 shadow-xs rounded-xl dark:bg-neutral-800 dark:border-neutral-700">
            <div class="p-5 pb-4 grid grid-cols-2 items-center gap-x-4 relative z-10">
              <div>
                <h2 class="inline-block font-semibold text-lg text-gray-800 dark:text-neutral-200">
                  Top Error Reasons
                </h2>
              </div>
            </div>
            <div class="p-5 pt-0">
              <div class="w-full h-64 md:h-72 lg:h-80 flex items-center justify-center">
                <div id="hs-devices-bubble-chart" class="w-full h-full" x-show="pathway.topErrors.length > 0"></div>
                <p class="text-gray-500" x-show="pathway.topErrors.length === 0">No error reflections provided.</p>
              </div>
            </div>
            <div class="p-5 border-t border-gray-200 dark:border-neutral-700" x-show="pathway.topErrors.length > 0">
              <ul class="space-y-1">
                <li class="py-3 grid grid-cols-2 justify-between items-center gap-x-4 border-b last:border-b-0 border-gray-200 dark:border-neutral-700">
                  <div>
                    <h4 class="font-medium text-gray-800 dark:text-neutral-200">
                      Error Reason
                    </h4>
                  </div>
                  <div class="text-end">
                    <h4 class="font-medium text-gray-800 dark:text-neutral-200">
                      Count
                    </h4>
                  </div>
                </li>
                <template x-for="error in pathway.topErrors" :key="error.id">
                  <li class="py-3 grid grid-cols-2 justify-between items-center gap-x-4 border-b last:border-b-0 border-gray-200 dark:border-neutral-700">
                    <div class="flex items-center">
                      <span
                        class="shrink-0 size-2.5 inline-block rounded-xs me-2.5"
                        :style="`background-color: ${colorMapper.getColor(error.reason)}`"
                      ></span>
                      <span class="text-sm text-gray-800 dark:text-neutral-200" x-text="error.reason"></span>
                    </div>
                    <div class="flex justify-end items-center gap-x-1.5">
                      <span class="text-sm text-gray-500 dark:text-neutral-500" x-text="error.count"></span>
                      <span class="text-sm text-gray-500 dark:text-neutral-500" x-text="`(${error.percentage}%)`"></span>
                    </div>
                  </li>
                </template>
              </ul>
              <template x-if="pathway.topErrors.length > 0">
                <div
                  x-data="{
                    firstErrorReason: pathway.topErrors[0].reason,
                    secondErrorReason: pathway.topErrors.length > 1 ? pathway.topErrors[1].reason : null,
                    improvementPhrase: pathway.topErrors[0].improvementPhrase
                  }"
                  class="mt-4 p-3.5 bg-emerald-50 border border-emerald-200 rounded-lg dark:bg-emerald-900/20 dark:border-emerald-700/50"
                >
                  <div class="flex">
                    <div class="flex-shrink-0">
                      <svg class="shrink-0 size-5 text-emerald-600 dark:text-emerald-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                      </svg>
                    </div>
                    <div class="ms-3">
                      <p class="text-sm text-emerald-700 dark:text-emerald-300">
                        The two prominent reasons for the mistakes you did during the exam are
                        <strong x-text="firstErrorReason"></strong>
                        <template x-if="secondErrorReason">
                          <span> and <strong x-text="secondErrorReason"></strong></span>
                        </template>
                        as per your reflections.
                        This indicates that <strong x-text="improvementPhrase"></strong> will be most effective in boosting your score.
                      </p>
                    </div>
                  </div>
                </div>
              </template>
            </div>
          </div>
          <div>
            <div class="flex flex-col gap-6 lg:gap-10">
              <template x-for="error in pathway.topErrors.slice(0, 2)" :key="error.id">
                <template x-data="{ strategyKey: strategyMap[error.id], strategy: improvementStrategies[strategyMap[error.id]] }" x-if="strategy">
                <div class="flex flex-col bg-white border border-gray-200 shadow-xs p-5 rounded-xl dark:bg-neutral-800 dark:border-neutral-700">
                    <div class="mb-4 flex items-start justify-between gap-x-3">
                      <div class="grow">
                        <p class="font-semibold text-xl md:text-2xl text-gray-800 dark:text-neutral-200" x-text="strategy.name"></p>
                      </div>
                      <div>
                        <svg class="shrink-0 size-6 text-gray-400" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M5 12h14"/>
                          <path d="m12 5 7 7-7 7"/>
                        </svg>
                      </div>
                    </div>
                    <div class="space-y-3">
                      <p class="text-sm text-gray-500 dark:text-neutral-500" x-text="'This strategy helps with errors like: ' + error.reason + '.'"></p>
                      <div>
                        <h4 class="text-sm font-semibold text-gray-800 dark:text-neutral-200">About This Strategy</h4>
                        <p class="mt-1 text-sm text-gray-700 dark:text-neutral-300" x-text="strategy.description"></p>
                      </div>
                      <div>
                        <h4 class="text-sm font-semibold text-gray-800 dark:text-neutral-200">Recommended Focus</h4>
                        <p class="mt-1 text-sm text-gray-700 dark:text-neutral-300" x-text="strategy.guidance"></p>
                      </div>
                      <div>
                        <h4 class="text-sm font-semibold text-gray-800 dark:text-neutral-200">Actionable Steps</h4>
                        <p class="mt-1 text-sm text-gray-700 dark:text-neutral-300" x-text="strategy.studentBehavior"></p>
                      </div>
                    </div>
                  </div>
                </template>
              </template>
            </div>
          </div>
        </div>
      </template>
      <template x-if="!pathway.topErrors || pathway.topErrors.length === 0">
        <div class="w-full text-center py-10">
          <p class="text-gray-500">No improvement suggestions are available for this attempt.</p>
          <p class="text-sm text-gray-500 mt-1">Complete your error reflections to build your path to improvement.</p>
        </div>
      </template>
    </div>
  </template>
</div>