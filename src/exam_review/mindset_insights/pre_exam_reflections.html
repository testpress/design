<div class="flex flex-col bg-white border border-gray-200 shadow-2xs rounded-xl dark:bg-neutral-800 dark:border-neutral-700">
  <div class="py-3 px-5 flex justify-between items-center border-b border-gray-200 dark:border-neutral-700">
    <h2 class="inline-block font-semibold text-gray-800 dark:text-neutral-200">
      Pre-Exam Mindset
    </h2>
  </div>

  <div x-show="loading.preTest">
    {% include "./loader.html" %}
  </div>

  <div class="p-5" x-cloak x-show="!loading.preTest">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 items-start">
      <div class="text-gray-700 space-y-5">
        <div class="space-y-2">
          <h3 class="text-base/7 font-semibold text-gray-900 underline underline-offset-2">About Pre-Exam Mindset</h3>
          <p class="text-sm text-gray-600">
            Doing your best on a exam starts with the right mindset.
            This screener provides insight into how you were
            feeling in the moments just before the exam began. A low score on a positive trait (like Focus) or a high score on a negative one (like Anxiety) can indicate a barrier to performing your best.
          </p>
        </div>

        <template x-if="preTestNotes && preTestNotes.length > 0">
          <dl class="divide-y divide-gray-200 dark:divide-neutral-700">
            <template x-for="(note, idx) in preTestNotes" :key="note.id || idx">
              <div class="py-6 first:pt-0 last:pb-0">
                <dt class="flex w-full items-start justify-between text-left text-gray-900 dark:text-neutral-200">
                  <span class="text-sm font-semibold" x-text="note.label"></span>
                  <span class="inline-flex items-center rounded-md bg-gray-50 dark:bg-neutral-700 px-2 py-1 text-xs font-medium text-gray-600 dark:text-neutral-300 ring-1 ring-inset ring-gray-500/10 dark:ring-neutral-600">Text Response</span>
                </dt>
                <dd class="mt-2 pr-12">
                  <p class="text-sm text-gray-600 dark:text-neutral-400" x-text="note.response || 'No response provided.'"></p>
                </dd>
              </div>
            </template>
          </dl>
        </template>
        <template x-if="!preTestNotes || preTestNotes.length === 0">
          <div class="text-sm text-gray-500">
            No pre-exam text responses were provided.
          </div>
        </template>
      </div>

      <div>
        <template x-if="preTestRatings && preTestRatings.length > 0">
          <div>
            <template x-for="(rating, index) in preTestRatings" :key="rating.id">
              <div class="mb-4 space-y-2" x-data="{ showTooltip: false }">
                <div class="flex items-center gap-x-2">
                  <h4 class="text-sm text-gray-900 dark:text-neutral-200" x-text="rating.label"></h4>                </div>
                <div
                  class="relative"
                  role="progressbar"
                  :aria-valuenow="Math.round(sanitizeScore(rating.score))"
                  aria-valuemin="1"
                  aria-valuemax="5"
                  @mouseenter="showTooltip = true"
                  @mouseleave="showTooltip = false"
                >
                  <div
                    class="w-full h-2.5 rounded-full dark:bg-neutral-700 overflow-hidden"
                    :class="rating.type === 'negative'
                      ? 'bg-gradient-to-r from-emerald-400 via-yellow-400 to-red-500'
                      : 'bg-gradient-to-r from-red-500 via-yellow-400 to-emerald-400'"
                  ></div>
                  <div
                    class="absolute top-1/2 w-2 h-5 border-2 border-white rounded-full transform -translate-y-1/2 dark:border-neutral-800"
                    :style="`left: calc(${((sanitizeScore(rating.score) - 1) / 4) * 100}% + 1.25rem - 0.6rem)`"
                  >
                    <div
                      class="w-full h-full rounded-full"
                      :class="{
                        'bg-emerald-500': (rating.type === 'negative' && Math.round(sanitizeScore(rating.score)) <= 2) ||
                                         (rating.type === 'positive' && Math.round(sanitizeScore(rating.score)) >= 4),
                        'bg-yellow-500': Math.round(sanitizeScore(rating.score)) === 3,
                        'bg-red-500': (rating.type === 'positive' && Math.round(sanitizeScore(rating.score)) <= 2) ||
                                      (rating.type === 'negative' && Math.round(sanitizeScore(rating.score)) >= 4),
                        'bg-gray-400': rating.type === 'neutral'
                      }"
                    ></div>
                    <div
                      x-show="showTooltip"
                      x-transition
                      class="absolute -top-8 left-1/2 -translate-x-1/2 whitespace-nowrap bg-white text-gray-800 text-xs font-medium py-1 px-2 rounded shadow-md border border-gray-200 z-10"
                    >
                      <span x-text="`${Math.round(sanitizeScore(rating.score))} / 5`"></span>
                    </div>
                  </div>
                </div>
                <div class="flex justify-between items-center gap-5 text-xs text-gray-500 dark:text-neutral-500 mt-1 pl-[1.25rem]">
                  <div class="flex items-center gap-2">
                    <span class="font-medium">1</span>
                    <span>Low</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="font-medium">3</span>
                    <span>Neutral</span>
                  </div>
                  <div class="flex items-center gap-2">
                    <span class="font-medium">5</span>
                    <span>High</span>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </template>
        <template x-if="!preTestRatings || preTestRatings.length === 0">
          <div class="text-sm text-gray-500">
            No pre-exam scale responses were provided.
          </div>
        </template>
      </div>
    </div>
  </div>
</div>