<div class="relative">
  <div class="flex flex-col bg-white border border-gray-200 shadow-2xs rounded-xl dark:bg-neutral-800 dark:border-neutral-700">
    <div class="py-3 px-5 flex justify-between items-center border-b border-gray-200 dark:border-neutral-700">
      <h2 class="inline-block font-semibold text-gray-800 dark:text-neutral-200">
        Reasons for Errors
        <span
          x-show="selectedSectionId !== 'overall'"
          x-text="`(${sections.find(s => s.section_id === selectedSectionId)?.section_name || ''})`"
        ></span>
        <span x-show="selectedSectionId === 'overall'">(Overall)</span>
      </h2>
      <div x-show="!loading.errors && errorSummaryForChart.series && errorSummaryForChart.series.length > 0" class="flex items-center gap-x-2">
        <span class="text-sm font-medium text-gray-600 dark:text-neutral-300">
          Total Reflected Errors:
          <span class="text-sm font-semibold text-gray-900 dark:text-neutral-100">
            <span x-text="errorSummaryForChart.totalErrors"></span>
            <span class="text-gray-500 dark:text-neutral-400"> / </span>
            <span x-text="errorSummaryForChart.totalIncorrect"></span>
          </span>
        </span>
      </div>
    </div>

  <div x-show="loading.errors">
    {% include "./loader.html" %}
  </div>

  <div class="p-5" x-show="!loading.errors">
    <p class="text-sm text-gray-600 dark:text-neutral-400 mb-4">
      This chart breaks down the reasons you selected for your incorrect answers.
      Use it to identify and address your most common exam-taking patterns.
    </p>

    <div class="flex flex-col lg:flex-row justify-center items-center lg:justify-around gap-5">
      <div
        x-show="errorSummaryForChart.series && errorSummaryForChart.series.length > 0"
        class="flex justify-center items-center h-[310px] w-[310px]"
      >
        <div id="error-reason-chart"></div>
      </div>

      <div
        class="w-full lg:w-1/2"
        x-show="errorSummaryForChart.series && errorSummaryForChart.series.length > 0"
      >
        <ul class="space-y-2">
          <template
            x-for="(label, index) in errorSummaryForChart.labels"
            :key="label"
          >
            <li
              @click="showQuestionsForReason(label)"
              class="flex items-center justify-between p-3 bg-gray-50 rounded-lg dark:bg-neutral-900 cursor-pointer transition-all duration-200 ease-out hover:bg-gray-100 hover:shadow-md"
            >
              <div class="flex items-center gap-x-2">
                <span
                  class="size-3 rounded-sm inline-block"
                  :style="`background-color: ${colorMapper.getColor(label)}`"
                ></span>
                <span
                  class="text-sm text-gray-700 dark:text-neutral-300"
                  x-text="label"
                ></span>
              </div>
              <span
                class="text-sm font-medium text-gray-800 dark:text-neutral-200"
                x-text="
                  errorSummaryForChart.series[index] +
                  ' (' +
                  (errorSummaryForChart.totalErrors > 0
                    ? (errorSummaryForChart.series[index] / errorSummaryForChart.totalErrors * 100).toFixed(0)
                    : 0
                  ) +
                  '%)'
                "
              ></span>
            </li>
          </template>
        </ul>
      </div>

      <div
        x-show="!errorSummaryForChart || errorSummaryForChart.series.length === 0"
        class="w-full text-center py-10"
      >
        <p class="text-gray-500">
          No error reflections were provided for this section.
        </p>
        <p class="text-sm text-gray-500 mt-1">
          Reflect on your incorrect answers during review to unlock this insight.
        </p>
      </div>
    </div>
  </div>
  </div>
  <!-- Hidden button to trigger modal opening - always accessible -->
  <button
    id="hs-pro-shflo-trigger"
    data-hs-overlay="#hs-pro-shflo"
    class="hidden"
    aria-label="Open questions modal"
  ></button>
  {% include "./questions/mistake_reason_questions.html" %}
</div>