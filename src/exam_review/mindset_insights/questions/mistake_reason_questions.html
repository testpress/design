<div x-cloak
  class="absolute inset-0 will-change-transform"
  data-questions-container
  x-show="showQuestionsView"
  x-effect="syncContainerHeights()"
  x-transition:enter="transition-all duration-[1500ms] ease-[cubic-bezier(0.22,1,0.36,1)]"
  x-transition:enter-start="opacity-0 translate-x-full"
  x-transition:enter-end="opacity-100 translate-x-0"
  x-transition:leave="transition-all duration-[1500ms] ease-[cubic-bezier(0.55,0,0.1,1)]"
  x-transition:leave-start="opacity-100 translate-x-0"
  x-transition:leave-end="opacity-0 translate-x-full"
>
  <div
    x-ref="questionsContainer"
    :style="`height: ${$refs.errorSummaryContainer?.offsetHeight || 'auto'}px`"
    class="flex flex-col bg-white border border-gray-200 shadow-2xs rounded-xl dark:bg-neutral-800 dark:border-neutral-700 overflow-hidden"
  >
    <!-- Header -->
    <div class="py-3 px-3 flex justify-between items-center border-b border-gray-200 dark:border-neutral-700">
      <div class="flex items-center gap-3">
        <button
          @click="hideQuestionsView()"
          class="flex items-center justify-center size-8 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100 dark:text-neutral-400 dark:hover:text-neutral-200 dark:hover:bg-neutral-700 transition-colors"
          title="Back to Error Reasons"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m12 19-7-7 7-7"></path>
            <path d="M19 12H5"></path>
          </svg>
        </button>

        <h2 class="inline-block font-semibold text-gray-800 dark:text-neutral-200">
          Questions for Mistake Reasons
          <span x-show="selectedErrorReason" class="text-sm font-normal text-gray-600 dark:text-neutral-400">
            (<span x-text="selectedErrorReason"></span>)
          </span>
        </h2>
      </div>
    </div>

    <!-- Loader -->
    <div x-show="loading.errors">{% include "../loader.html" %}</div>

    <!-- Content -->
    <div class="flex-1 p-5 overflow-y-auto min-h-0 [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-track]:bg-neutral-700 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500">
      {% for item in question_mistake_reasons %}  
      {% set mistake_reason_name = '{{item.mistake_reason.name}}' %} 

      <div
        x-show="!selectedErrorReason && '{{ item.mistake_reason.name }}' === selectedErrorReason"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        class="mb-8 border border-gray-200 rounded-lg p-6 dark:border-neutral-700"
      >
        {% set question_type = item.user_selected_answer.question.type %} 
        {% if question_type == 'R' or question_type == 'C' %} 
          {% include "./mcq_question.html" %} 
        {% elif question_type == 'S' or question_type == 'E' %} 
          {% include "./essay_question.html" %} 
        {% elif question_type == 'G' %} 
          {% include "./gap_fill_question.html" %} 
        {% elif question_type == 'MATCH' %}
          {% include "./match_question.html" %} 
        {% elif question_type == 'F' %} 
          {% include "./file_question.html" %} 
        {% elif question_type == 'N' %} 
          {% include "./numerical_question.html" %} 
        {% elif question_type == 'M' %} 
          {% include "./match_question.html" %} 
        {% elif question_type == 'F' %}
          {% include "./file_question.html" %} 
        {%else %}
        <div class="p-4">
          <p
            class="font-medium text-gray-800 dark:text-neutral-200 prose prose-sm max-w-none"
          >
            {{ item.user_selected_answer.question.question_html|safe }}
          </p>

          {% if item.user_selected_answer.user_answer %}
          <div class="mt-4">
            <p class="font-medium text-gray-700 dark:text-neutral-300">
              Your Answer
            </p>
            <div
              class="mt-2 text-gray-600 dark:text-neutral-400 prose prose-sm max-w-none"
            >
              {{ item.user_selected_answer.user_answer|safe }}
            </div>
          </div>
          {% endif %}
        </div>
        {% endif %}

        <!-- Notes Section -->
        {% if item.notes %}
        <div class="mt-6 pt-6 border-t border-gray-200 dark:border-neutral-700">
          <div class="flex items-start gap-3">
            <div class="flex-shrink-0">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="text-gray-500 dark:text-neutral-400"
              >
                <path
                  d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
                ></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
              </svg>
            </div>

            <div class="flex-1 min-w-0">
              <p class="font-medium text-gray-700 dark:text-neutral-300 mb-2">
                Mistake Reason
              </p>
              <div class="text-gray-600 dark:text-neutral-400 prose prose-sm max-w-none">
                {{ item.notes|safe }}
              </div>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>
</div>
