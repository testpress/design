<!-- Conversations Tab Content -->
<div>
  <!-- Large Screen Layout -->
  <div class="hidden lg:block">
    <div class="grid transition-all duration-300 gap-5"
      :class="$store.conversationComponent.selectedConversation ? 'lg:grid-cols-5' : 'lg:grid-cols-1'">
      <!-- Left Column - Scrollable Conversation List -->
      <div :class="$store.conversationComponent.selectedConversation ? 'lg:col-span-3' : 'lg:col-span-full'"
        class="space-y-4 transition-all duration-300">
        {% include "./conversation_component.html" %}
      </div>
      <!-- End Left Column -->

      <!-- Right Column - Sticky Sidebar -->
      <div class="lg:col-span-2" x-show="$store.conversationComponent.selectedConversation !== null"
        x-transition:enter="transition ease-out duration-300" x-transition:enter-start="translate-x-full"
        x-transition:enter-end="translate-x-0" x-transition:leave="transition ease-in duration-300"
        x-transition:leave-start="translate-x-0" x-transition:leave-end="translate-x-full">
        <div class="lg:sticky lg:top-20 h-[calc(100vh-6rem)]">
          <div
            class="flex flex-col bg-white border border-stone-200 overflow-hidden rounded-xl shadow-2xs dark:bg-neutral-800 dark:border-neutral-700 h-full">
            <!-- Header -->
            <div
              class="py-3 px-4 border-b border-gray-200 dark:border-neutral-700 flex justify-between items-center flex-shrink-0">
              <h4 class="font-medium text-gray-900 dark:text-neutral-200">Conversation Detail</h4>
              <button type="button" @click="$store.conversationComponent.selectedConversation = null"
                class="size-8 inline-flex justify-center items-center gap-x-2 rounded-full border border-transparent bg-gray-100 text-gray-800 hover:bg-gray-200 disabled:opacity-50 disabled:pointer-events-none focus:outline-hidden focus:bg-gray-200 dark:bg-neutral-700 dark:hover:bg-neutral-600 dark:text-neutral-400 dark:focus:bg-neutral-600"
                aria-label="Close">
                <span class="sr-only">Close</span>
                <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                  viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                  stroke-linejoin="round">
                  <path d="M18 6 6 18" />
                  <path d="m6 6 12 12" />
                </svg>
              </button>
            </div>
            <!-- End Header -->

            <!-- Body - Scrollable Chat Messages -->
            <div
              class="flex-1 overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-track]:bg-neutral-700 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500">
              <div class="p-5 space-y-5">
                <!-- Conversation Details -->
                <div class="space-y-4">
                  <div>
                    <h4 class="font-semibold text-lg text-gray-800 dark:text-neutral-200 mb-2"
                      x-text="$store.conversationComponent.selectedConversation?.title || ''"></h4>
                    <p class="text-sm text-gray-600 dark:text-neutral-400"
                      x-text="$store.conversationComponent.selectedConversation?.description || ''"></p>
                  </div>

                  <!-- Stats Grid -->
                  <div class="grid grid-cols-2 gap-4">
                    <div class="bg-gray-50 dark:bg-neutral-700/50 rounded-lg p-3">
                      <div class="flex items-center gap-2 mb-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                          class="w-4 h-4 text-gray-500 dark:text-neutral-400">
                          <circle cx="12" cy="12" r="10"></circle>
                          <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span class="text-xs text-gray-600 dark:text-neutral-400">Duration</span>
                      </div>
                      <p class="text-sm font-medium text-gray-900 dark:text-neutral-200"
                        x-text="$store.conversationComponent.selectedConversation?.duration || ''"></p>
                      <p class="text-xs text-gray-500 dark:text-neutral-500 mt-0.5"
                        x-text="$store.conversationComponent.selectedConversation?.time || ''"></p>
                    </div>
                    <div class="bg-gray-50 dark:bg-neutral-700/50 rounded-lg p-3">
                      <div class="flex items-center gap-2 mb-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                          class="w-4 h-4 text-gray-500 dark:text-neutral-400">
                          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <span class="text-xs text-gray-600 dark:text-neutral-400">Messages</span>
                      </div>
                      <p class="text-sm font-medium text-gray-900 dark:text-neutral-200"
                        x-text="($store.conversationComponent.selectedConversation?.messageCount || 0) + ' exchanges'">
                      </p>
                      <p class="text-xs text-gray-500 dark:text-neutral-500 mt-0.5"
                        x-text="($store.conversationComponent.selectedConversation?.tokens || 0).toLocaleString() + ' tokens'">
                      </p>
                    </div>
                  </div>

                  <!-- Badges -->
                  <div class="flex flex-wrap items-center gap-2">
                    <span
                      class="inline-flex items-center justify-center rounded-md border border-gray-200 px-2 py-0.5 text-xs font-medium text-gray-800 dark:text-neutral-200 dark:border-neutral-700"
                      x-text="$store.conversationComponent.selectedConversation?.aiTypeLabel || ''"></span>
                    <span
                      class="inline-flex items-center justify-center rounded-md px-2 py-0.5 text-xs font-medium border"
                      :class="{
                          'bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800': $store.conversationComponent.selectedConversation?.riskLevel === 'low',
                          'bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-300 dark:border-yellow-800': $store.conversationComponent.selectedConversation?.riskLevel === 'medium',
                          'bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/20 dark:text-orange-300 dark:border-orange-800': $store.conversationComponent.selectedConversation?.riskLevel === 'high',
                          'bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-300 dark:border-red-800': $store.conversationComponent.selectedConversation?.riskLevel === 'critical'
                        }"
                      x-text="$store.conversationComponent.selectedConversation?.riskLevel ? ($store.conversationComponent.selectedConversation.riskLevel.charAt(0).toUpperCase() + $store.conversationComponent.selectedConversation.riskLevel.slice(1) + ' Risk') : ''"></span>
                    <span x-show="$store.conversationComponent.selectedConversation?.type"
                      class="inline-flex items-center justify-center rounded-md border border-transparent bg-red-600 text-white px-2 py-0.5 text-xs font-medium dark:bg-red-500"
                      x-text="$store.conversationComponent.selectedConversation?.typeLabel || ''"></span>
                  </div>

                  <!-- Flagged Alert -->
                  <div x-show="$store.conversationComponent.selectedConversation?.usageType === 'non-academic'"
                    class="bg-red-50 border border-red-200 rounded-lg p-3 dark:bg-red-900/10 dark:border-red-800">
                    <div class="flex items-start gap-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5">
                        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"></path>
                        <path d="M12 9v4"></path>
                        <path d="M12 17h.01"></path>
                      </svg>
                      <div>
                        <p class="text-sm font-medium text-red-900 dark:text-red-200">Flagged for Review</p>
                        <p class="text-xs text-red-700 dark:text-red-300 mt-1">This conversation has been identified as
                          non-academic usage</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Conversation Messages -->
                <div class="border-t border-gray-200 dark:border-neutral-700 pt-5">
                  <!-- Academic Conversation Messages -->
                  <div x-show="$store.conversationComponent.selectedConversation?.usageType === 'academic'">
                    {% include "./academic_conversation_modal.html" %}
                  </div>
                  <!-- Non-Academic Conversation Messages -->
                  <div x-show="$store.conversationComponent.selectedConversation?.usageType === 'non-academic'">
                    {% include "./non_academic_conversation_modal.html" %}
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- End Body -->
        </div>
      </div>
    </div>
    <!-- End Right Column -->
  </div>
</div>

<!-- Medium and Small Screen Layout: Modal -->
<div class="lg:hidden">
  <!-- Conversation List -->
  <div>
    {% include "./conversation_component.html" %}
  </div>

  <!-- Modal for Conversation Details -->
  <div x-show="$store.conversationComponent.selectedConversation !== null"
    x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-300"
    x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
    class="fixed inset-0 z-[70] bg-gray-900 bg-opacity-50 dark:bg-opacity-80 backdrop-blur-sm" style="display: none;"
    @click="$store.conversationComponent.selectedConversation = null">
  </div>

  <div x-show="$store.conversationComponent.selectedConversation !== null"
    x-transition:enter="transition ease-out duration-300" x-transition:enter-start="translate-y-full"
    x-transition:enter-end="translate-y-0" x-transition:leave="transition ease-in duration-300"
    x-transition:leave-start="translate-y-0" x-transition:leave-end="translate-y-full"
    class="fixed bottom-0 left-0 right-0 z-[80] flex flex-col bg-white dark:bg-neutral-800 rounded-t-xl max-h-[90vh]"
    style="display: none;" @click.away="$store.conversationComponent.selectedConversation = null"
    @keydown.escape.window="$store.conversationComponent.selectedConversation = null">
    <!-- Header -->
    <div
      class="py-3 px-4 border-b border-gray-200 dark:border-neutral-700 flex justify-between items-center flex-shrink-0">
      <h4 class="font-medium text-gray-900 dark:text-neutral-200">Conversation Detail</h4>
      <button type="button" @click="$store.conversationComponent.selectedConversation = null"
        class="size-8 inline-flex justify-center items-center gap-x-2 rounded-full border border-transparent bg-gray-100 text-gray-800 hover:bg-gray-200 disabled:opacity-50 disabled:pointer-events-none focus:outline-hidden focus:bg-gray-200 dark:bg-neutral-700 dark:hover:bg-neutral-600 dark:text-neutral-400 dark:focus:bg-neutral-600"
        aria-label="Close">
        <span class="sr-only">Close</span>
        <svg class="shrink-0 size-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
          fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6 6 18" />
          <path d="m6 6 12 12" />
        </svg>
      </button>
    </div>
    <!-- End Header -->

    <!-- Body - Scrollable Chat Messages -->
    <div
      class="flex-1 overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-track]:bg-neutral-700 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500">
      <div class="p-5 space-y-5">
        <!-- Conversation Details -->
        <div class="space-y-4">
          <div>
            <h4 class="font-semibold text-lg text-gray-800 dark:text-neutral-200 mb-2"
              x-text="$store.conversationComponent.selectedConversation?.title || ''"></h4>
            <p class="text-sm text-gray-600 dark:text-neutral-400"
              x-text="$store.conversationComponent.selectedConversation?.description || ''"></p>
          </div>

          <!-- Stats Grid -->
          <div class="grid grid-cols-2 gap-4">
            <div class="bg-gray-50 dark:bg-neutral-700/50 rounded-lg p-3">
              <div class="flex items-center gap-2 mb-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="w-4 h-4 text-gray-500 dark:text-neutral-400">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <span class="text-xs text-gray-600 dark:text-neutral-400">Duration</span>
              </div>
              <p class="text-sm font-medium text-gray-900 dark:text-neutral-200"
                x-text="$store.conversationComponent.selectedConversation?.duration || ''"></p>
              <p class="text-xs text-gray-500 dark:text-neutral-500 mt-0.5"
                x-text="$store.conversationComponent.selectedConversation?.time || ''"></p>
            </div>
            <div class="bg-gray-50 dark:bg-neutral-700/50 rounded-lg p-3">
              <div class="flex items-center gap-2 mb-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="w-4 h-4 text-gray-500 dark:text-neutral-400">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
                <span class="text-xs text-gray-600 dark:text-neutral-400">Messages</span>
              </div>
              <p class="text-sm font-medium text-gray-900 dark:text-neutral-200"
                x-text="($store.conversationComponent.selectedConversation?.messageCount || 0) + ' exchanges'"></p>
              <p class="text-xs text-gray-500 dark:text-neutral-500 mt-0.5"
                x-text="($store.conversationComponent.selectedConversation?.tokens || 0).toLocaleString() + ' tokens'">
              </p>
            </div>
          </div>

          <!-- Badges -->
          <div class="flex flex-wrap items-center gap-2">
            <span
              class="inline-flex items-center justify-center rounded-md border border-gray-200 px-2 py-0.5 text-xs font-medium text-gray-800 dark:text-neutral-200 dark:border-neutral-700"
              x-text="$store.conversationComponent.selectedConversation?.aiTypeLabel || ''"></span>
            <span class="inline-flex items-center justify-center rounded-md px-2 py-0.5 text-xs font-medium border"
              :class="{
                    'bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800': $store.conversationComponent.selectedConversation?.riskLevel === 'low',
                    'bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-300 dark:border-yellow-800': $store.conversationComponent.selectedConversation?.riskLevel === 'medium',
                    'bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/20 dark:text-orange-300 dark:border-orange-800': $store.conversationComponent.selectedConversation?.riskLevel === 'high',
                    'bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-300 dark:border-red-800': $store.conversationComponent.selectedConversation?.riskLevel === 'critical'
                  }"
              x-text="$store.conversationComponent.selectedConversation?.riskLevel ? ($store.conversationComponent.selectedConversation.riskLevel.charAt(0).toUpperCase() + $store.conversationComponent.selectedConversation.riskLevel.slice(1) + ' Risk') : ''"></span>
            <span x-show="$store.conversationComponent.selectedConversation?.type"
              class="inline-flex items-center justify-center rounded-md border border-transparent bg-red-600 text-white px-2 py-0.5 text-xs font-medium dark:bg-red-500"
              x-text="$store.conversationComponent.selectedConversation?.typeLabel || ''"></span>
          </div>

          <!-- Flagged Alert -->
          <div x-show="$store.conversationComponent.selectedConversation?.usageType === 'non-academic'"
            class="bg-red-50 border border-red-200 rounded-lg p-3 dark:bg-red-900/10 dark:border-red-800">
            <div class="flex items-start gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"></path>
                <path d="M12 9v4"></path>
                <path d="M12 17h.01"></path>
              </svg>
              <div>
                <p class="text-sm font-medium text-red-900 dark:text-red-200">Flagged for Review</p>
                <p class="text-xs text-red-700 dark:text-red-300 mt-1">This conversation has been identified as
                  non-academic usage</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Conversation Messages -->
        <div class="border-t border-gray-200 dark:border-neutral-700 pt-5">
          <!-- Academic Conversation Messages -->
          <div x-show="$store.conversationComponent.selectedConversation?.usageType === 'academic'">
            {% include "./academic_conversation_modal.html" %}
          </div>
          <!-- Non-Academic Conversation Messages -->
          <div x-show="$store.conversationComponent.selectedConversation?.usageType === 'non-academic'">
            {% include "./non_academic_conversation_modal.html" %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- End Body -->
</div>
</div>
</div>