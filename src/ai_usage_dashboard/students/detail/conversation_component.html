<!-- Conversation Component with Filters -->
<div x-data="conversationComponent()" class="space-y-4">
  <!-- Filters Section -->
  <div class="bg-white border border-gray-200 rounded-lg p-4 dark:bg-neutral-800 dark:border-neutral-700">
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <!-- Conversation Type Filter -->
      <div class="relative">
        <select x-model="filters.usageType" @change="applyFilters()" data-hs-select='{
          "placeholder": "All Conversation",
          "toggleTag": "<button type=\"button\" aria-expanded=\"false\"></button>",
          "toggleClasses": "hs-select-disabled:pointer-events-none hs-select-disabled:opacity-50 relative py-2 ps-3 pe-9 flex gap-x-2 text-nowrap w-full cursor-pointer bg-white border border-gray-200 rounded-lg text-start text-sm focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-neutral-600",
          "dropdownClasses": "mt-2 z-[50] w-full max-h-72 p-1 space-y-0.5 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-track]:bg-neutral-700 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500 dark:bg-neutral-900 dark:border-neutral-700",
          "optionClasses": "p-2 w-full text-sm text-gray-800 cursor-pointer hover:bg-gray-100 rounded-lg focus:outline-none focus:bg-gray-100 dark:bg-neutral-900 dark:hover:bg-neutral-800 dark:text-neutral-200 dark:focus:bg-neutral-800",
          "optionTemplate": "<div class=\"flex justify-between items-center w-full\"><span data-title></span><span class=\"hidden hs-selected:block\"><svg class=\"shrink-0 size-3.5 text-gray-800 dark:text-neutral-200\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"20 6 9 17 4 12\"/></svg></span></div>"
        }' class="hidden">
          <option value="">All Conversation</option>
          <option value="academic">Academic only</option>
          <option value="flagged">Flagged only</option>
        </select>
      </div>

      <!-- Risk Level Filter -->
      <div class="relative">
        <select x-model="filters.riskLevel" @change="applyFilters()" data-hs-select='{
          "placeholder": "All Risk Levels",
          "toggleTag": "<button type=\"button\" aria-expanded=\"false\"></button>",
          "toggleClasses": "hs-select-disabled:pointer-events-none hs-select-disabled:opacity-50 relative py-2 ps-3 pe-9 flex gap-x-2 text-nowrap w-full cursor-pointer bg-white border border-gray-200 rounded-lg text-start text-sm focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-neutral-600",
          "dropdownClasses": "mt-2 z-[50] w-full max-h-72 p-1 space-y-0.5 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-track]:bg-neutral-700 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500 dark:bg-neutral-900 dark:border-neutral-700",
          "optionClasses": "p-2 w-full text-sm text-gray-800 cursor-pointer hover:bg-gray-100 rounded-lg focus:outline-none focus:bg-gray-100 dark:bg-neutral-900 dark:hover:bg-neutral-800 dark:text-neutral-200 dark:focus:bg-neutral-800",
          "optionTemplate": "<div class=\"flex justify-between items-center w-full\"><span data-title></span><span class=\"hidden hs-selected:block\"><svg class=\"shrink-0 size-3.5 text-gray-800 dark:text-neutral-200\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"20 6 9 17 4 12\"/></svg></span></div>"
        }' class="hidden">
          <option value="">All Risk Levels</option>
          <option value="critical">Critical</option>
          <option value="high">High</option>
          <option value="medium">Medium</option>
          <option value="low">Low</option>
        </select>
      </div>

      <!-- AI Type Filter -->
      <div class="relative">
        <select x-model="filters.aiType" @change="applyFilters()" data-hs-select='{
          "placeholder": "All AI",
          "toggleTag": "<button type=\"button\" aria-expanded=\"false\"></button>",
          "toggleClasses": "hs-select-disabled:pointer-events-none hs-select-disabled:opacity-50 relative py-2 ps-3 pe-9 flex gap-x-2 text-nowrap w-full cursor-pointer bg-white border border-gray-200 rounded-lg text-start text-sm focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-neutral-600",
          "dropdownClasses": "mt-2 z-[50] w-full max-h-72 p-1 space-y-0.5 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-track]:bg-neutral-700 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500 dark:bg-neutral-900 dark:border-neutral-700",
          "optionClasses": "p-2 w-full text-sm text-gray-800 cursor-pointer hover:bg-gray-100 rounded-lg focus:outline-none focus:bg-gray-100 dark:bg-neutral-900 dark:hover:bg-neutral-800 dark:text-neutral-200 dark:focus:bg-neutral-800",
          "optionTemplate": "<div class=\"flex justify-between items-center w-full\"><span data-title></span><span class=\"hidden hs-selected:block\"><svg class=\"shrink-0 size-3.5 text-gray-800 dark:text-neutral-200\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"20 6 9 17 4 12\"/></svg></span></div>"
        }' class="hidden">
          <option value="">All AI</option>
          <option value="pdf">PDF only</option>
          <option value="doubts">Doubts only</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Conversation Cards List -->
  <div class="space-y-3">
    <template x-for="conversation in filteredConversations" :key="conversation.id">
      <div @click="openConversation(conversation)"
        class="bg-white border border-gray-200 rounded-lg p-4 cursor-pointer transition-all hover:shadow-md dark:bg-neutral-800 dark:border-neutral-700"
        :class="conversation.riskLevel === 'critical' || conversation.riskLevel === 'high' ? 'border-l-4 border-l-red-500 dark:border-l-red-500' : ''">
        <div class="flex items-start gap-3 mb-3">
          <div class="p-2 rounded-lg flex-shrink-0"
            :class="conversation.aiType === 'doubts' || conversation.aiType === 'ai' ? 'bg-blue-100 dark:bg-blue-900/20' : 'bg-purple-100 dark:bg-purple-900/20'">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"
              :class="conversation.aiType === 'doubts' || conversation.aiType === 'ai' ? 'text-blue-600 dark:text-blue-400' : 'text-purple-600 dark:text-purple-400'">
              <path x-show="conversation.aiType === 'pdf'"
                d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path>
              <path x-show="conversation.aiType === 'pdf'" d="M14 2v4a2 2 0 0 0 2 2h4"></path>
              <path x-show="conversation.aiType === 'pdf'" d="M10 9H8"></path>
              <path x-show="conversation.aiType === 'pdf'" d="M16 13H8"></path>
              <path x-show="conversation.aiType === 'pdf'" d="M16 17H8"></path>
              <path x-show="conversation.aiType !== 'pdf'"
                d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <div class="flex items-center gap-2 mb-1">
              <h4 class="font-medium text-gray-900 dark:text-neutral-200" x-text="conversation.title"></h4>
              <svg x-show="conversation.riskLevel === 'critical' || conversation.riskLevel === 'high'"
                xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="w-4 h-4 text-red-600 dark:text-red-400 flex-shrink-0">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"></path>
                <path d="M12 9v4"></path>
                <path d="M12 17h.01"></path>
              </svg>
            </div>
            <p class="text-sm text-gray-600 dark:text-neutral-400 line-clamp-2 mb-2" x-text="conversation.description">
            </p>
            <div class="flex items-center gap-3 text-xs text-gray-500 dark:text-neutral-500 mb-2">
              <div class="flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-3 h-3">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <span x-text="conversation.time"></span>
              </div>
              <span>•</span>
              <span x-text="conversation.duration"></span>
              <span>•</span>
              <span x-text="conversation.messageCount + ' messages'"></span>
              <span>•</span>
              <span x-text="conversation.tokens.toLocaleString() + ' tokens'"></span>
            </div>
            <div class="flex flex-wrap items-center gap-2">
              <span
                class="inline-flex items-center justify-center rounded-md border border-gray-200 px-2 py-0.5 text-xs font-medium text-gray-800 dark:text-neutral-200 dark:border-neutral-700"
                x-text="conversation.aiTypeLabel"></span>
              <span class="inline-flex items-center justify-center rounded-md px-2 py-0.5 text-xs font-medium border"
                :class="{
                  'bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800': conversation.riskLevel === 'low',
                  'bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-300 dark:border-yellow-800': conversation.riskLevel === 'medium',
                  'bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/20 dark:text-orange-300 dark:border-orange-800': conversation.riskLevel === 'high',
                  'bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-300 dark:border-red-800': conversation.riskLevel === 'critical'
                }"
                x-text="conversation.riskLevel.charAt(0).toUpperCase() + conversation.riskLevel.slice(1) + ' Risk'"></span>
              <span x-show="conversation.type"
                class="inline-flex items-center justify-center rounded-md border border-transparent bg-red-600 text-white px-2 py-0.5 text-xs font-medium dark:bg-red-500"
                x-text="conversation.typeLabel"></span>
              <span class="text-xs text-gray-400 dark:text-neutral-500 ml-auto" x-text="conversation.date"></span>
            </div>
          </div>
        </div>
      </div>
    </template>
  </div>
</div>

<script>
  document.addEventListener('alpine:init', () => {
    Alpine.store('conversationComponent', {
      selectedConversation: null,
      conversations: []
    });
  });

  function conversationComponent() {
    return {
      filters: {
        usageType: '',
        riskLevel: '',
        aiType: ''
      },
      get conversations() {
        return Alpine.store('conversationComponent').conversations;
      },
      init() {
        // Initialize Preline Select2 after Alpine renders
        this.$nextTick(() => {
          if (typeof HSStaticMethods !== 'undefined') {
            HSStaticMethods.autoInit();
          }
        });

        // Initialize conversations in store
        Alpine.store('conversationComponent').conversations = [
          {
            id: 1,
            conversationId: 'CONV-2026-001',
            title: 'Photosynthesis Process in C4 Plants',
            description: 'Discussion about photosynthesis mechanism in C4 plants, comparing with C3 pathway and understanding Kranz anatomy.',
            time: '9:15 AM',
            duration: '17 mins',
            messageCount: 8,
            tokens: 4520,
            date: 'Jan 12, 2026',
            usageType: 'academic',
            type: null,
            typeLabel: null,
            category: null,
            riskLevel: 'low',
            aiType: 'doubts',
            aiTypeLabel: 'Doubts AI'
          },
          {
            id: 2,
            conversationId: 'CONV-2026-002',
            title: 'Cell Division - Mitosis vs Meiosis',
            description: 'Detailed comparison of mitosis and meiosis stages, discussing differences in chromosome behavior and biological significance.',
            time: '2:45 PM',
            duration: '27 mins',
            messageCount: 12,
            tokens: 7890,
            date: 'Jan 12, 2026',
            usageType: 'academic',
            type: null,
            typeLabel: null,
            category: null,
            riskLevel: 'low',
            aiType: 'pdf',
            aiTypeLabel: 'PDF AI'
          },
          {
            id: 3,
            conversationId: 'CONV-2026-003',
            title: 'Entertainment Content - Movies & Games',
            description: 'Extended conversation about movies, video games, and social media trends - completely non-academic.',
            time: '8:30 PM',
            duration: '45 mins',
            messageCount: 23,
            tokens: 12340,
            date: 'Jan 11, 2026',
            usageType: 'non-academic',
            type: 'entertainment',
            typeLabel: 'Entertainment',
            category: 'critical',
            riskLevel: 'critical',
            aiType: 'doubts',
            aiTypeLabel: 'Doubts AI'
          },
          {
            id: 4,
            conversationId: 'CONV-2026-004',
            title: 'Human Digestive System Overview',
            description: 'Questions about digestive enzymes, their functions, and the journey of food through the alimentary canal.',
            time: '10:20 AM',
            duration: '25 mins',
            messageCount: 10,
            tokens: 6780,
            date: 'Jan 11, 2026',
            usageType: 'academic',
            type: null,
            typeLabel: null,
            category: null,
            riskLevel: 'low',
            aiType: 'pdf',
            aiTypeLabel: 'PDF AI'
          },
          {
            id: 5,
            conversationId: 'CONV-2026-005',
            title: 'Joke Generation & Casual Chat',
            description: 'Asking AI to generate jokes, riddles, and engaging in casual conversation unrelated to studies.',
            time: '7:45 PM',
            duration: '40 mins',
            messageCount: 19,
            tokens: 9870,
            date: 'Jan 10, 2026',
            usageType: 'non-academic',
            type: 'mild-non-academic',
            typeLabel: 'Time Wasting',
            category: null,
            riskLevel: 'high',
            aiType: 'doubts',
            aiTypeLabel: 'Doubts AI'
          }
        ];
      },
      get filteredConversations() {
        return Alpine.store('conversationComponent').conversations.filter(conv => {
          if (this.filters.usageType === 'academic' && conv.usageType !== 'academic') return false;
          if (this.filters.usageType === 'flagged' && conv.usageType !== 'non-academic') return false;
          if (this.filters.riskLevel && conv.riskLevel !== this.filters.riskLevel) return false;
          if (this.filters.aiType && conv.aiType !== this.filters.aiType) return false;
          return true;
        });
      },
      applyFilters() {
        // Filters are reactive, no need for explicit action
      },
      openConversation(conversation) {
        Alpine.store('conversationComponent').selectedConversation = conversation;
      }
    };
  }
</script>