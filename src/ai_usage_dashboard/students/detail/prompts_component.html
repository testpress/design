<!-- Prompts Component with Filters -->
<div x-data="promptsComponent()" class="space-y-4">
  <!-- Filters Section -->
  <div class="bg-white border border-gray-200 rounded-lg p-4 dark:bg-neutral-800 dark:border-neutral-700">
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <!-- AI Type Filter -->
      <div class="relative">
        <select x-model="filters.aiType" @change="applyFilters()" data-hs-select='{
          "placeholder": "All AI",
          "toggleTag": "<button type=\"button\" aria-expanded=\"false\"></button>",
          "toggleClasses": "hs-select-disabled:pointer-events-none hs-select-disabled:opacity-50 relative py-2 ps-3 pe-9 flex gap-x-2 text-nowrap w-full cursor-pointer bg-white border border-gray-200 rounded-lg text-start text-sm focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-neutral-600",
          "dropdownClasses": "mt-2 z-[50] w-full max-h-72 p-1 space-y-0.5 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-track]:bg-neutral-700 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500 dark:bg-neutral-900 dark:border-neutral-700",
          "optionClasses": "p-2 w-full text-sm text-gray-800 cursor-pointer hover:bg-gray-100 rounded-lg focus:outline-none focus:bg-gray-100 dark:bg-neutral-900 dark:hover:bg-neutral-800 dark:text-neutral-200 dark:focus:bg-neutral-800",
          "optionTemplate": "<div class=\"flex justify-between items-center w-full\"><span data-title></span><span class=\"hidden hs-selected:block\"><svg class=\"shrink-0 size-3.5 text-gray-800 dark:text-neutral-200\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"20 6 9 17 4 12\"/></svg></span></div>"
        }' class="hidden">
          <option value="all">All AI</option>
          <option value="pdf">PDF only</option>
          <option value="doubts">Doubts only</option>
        </select>
      </div>

      <!-- Conversation Type Filter -->
      <div class="relative">
        <select x-model="filters.usageType" @change="applyFilters()" data-hs-select='{
          "placeholder": "All Conversation",
          "toggleTag": "<button type=\"button\" aria-expanded=\"false\"></button>",
          "toggleClasses": "hs-select-disabled:pointer-events-none hs-select-disabled:opacity-50 relative py-2 ps-3 pe-9 flex gap-x-2 text-nowrap w-full cursor-pointer bg-white border border-gray-200 rounded-lg text-start text-sm focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-neutral-600",
          "dropdownClasses": "mt-2 z-[50] w-full max-h-72 p-1 space-y-0.5 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-track]:bg-neutral-700 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500 dark:bg-neutral-900 dark:border-neutral-700",
          "optionClasses": "p-2 w-full text-sm text-gray-800 cursor-pointer hover:bg-gray-100 rounded-lg focus:outline-none focus:bg-gray-100 dark:bg-neutral-900 dark:hover:bg-neutral-800 dark:text-neutral-200 dark:focus:bg-neutral-800",
          "optionTemplate": "<div class=\"flex justify-between items-center w-full\"><span data-title></span><span class=\"hidden hs-selected:block\"><svg class=\"shrink-0 size-3.5 text-gray-800 dark:text-neutral-200\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"20 6 9 17 4 12\"/></svg></span></div>"
        }' class="hidden">
          <option value="all">All Conversation</option>
          <option value="academic">Academic only</option>
          <option value="non-academic">Non Academic only</option>
        </select>
      </div>

      <!-- Risk Level Filter -->
      <div class="relative">
        <select x-model="filters.riskLevel" @change="applyFilters()" data-hs-select='{
          "placeholder": "All Risk Levels",
          "toggleTag": "<button type=\"button\" aria-expanded=\"false\"></button>",
          "toggleClasses": "hs-select-disabled:pointer-events-none hs-select-disabled:opacity-50 relative py-2 ps-3 pe-9 flex gap-x-2 text-nowrap w-full cursor-pointer bg-white border border-gray-200 rounded-lg text-start text-sm focus:outline-none focus:ring-2 focus:ring-green-500 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-400 dark:focus:outline-none dark:focus:ring-1 dark:focus:ring-neutral-600",
          "dropdownClasses": "mt-2 z-[50] w-full max-h-72 p-1 space-y-0.5 bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-track]:bg-gray-100 [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-track]:bg-neutral-700 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500 dark:bg-neutral-900 dark:border-neutral-700",
          "optionClasses": "p-2 w-full text-sm text-gray-800 cursor-pointer hover:bg-gray-100 rounded-lg focus:outline-none focus:bg-gray-100 dark:bg-neutral-900 dark:hover:bg-neutral-800 dark:text-neutral-200 dark:focus:bg-neutral-800",
          "optionTemplate": "<div class=\"flex justify-between items-center w-full\"><span data-title></span><span class=\"hidden hs-selected:block\"><svg class=\"shrink-0 size-3.5 text-gray-800 dark:text-neutral-200\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"20 6 9 17 4 12\"/></svg></span></div>"
        }' class="hidden">
          <option value="all">All Risk Levels</option>
          <option value="critical">Critical</option>
          <option value="high">High</option>
          <option value="medium">Medium</option>
          <option value="low">Low</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Prompts Cards List -->
  <div class="space-y-3">
    <!-- Empty State -->
    <div x-show="filteredPrompts.length === 0"
      class="bg-white min-h-96 border border-gray-200 rounded-lg p-5 flex flex-col justify-center items-center text-center dark:bg-neutral-800 dark:border-neutral-700">
      <svg class="w-48 mx-auto mb-4" width="178" height="90" viewBox="0 0 178 90" fill="none"
        xmlns="http://www.w3.org/2000/svg">
        <rect x="27" y="50.5" width="124" height="39" rx="7.5" fill="currentColor" class="fill-white" />
        <rect x="27" y="50.5" width="124" height="39" rx="7.5" stroke="currentColor" class="stroke-gray-50" />
        <rect x="34.5" y="58" width="24" height="24" rx="4" fill="currentColor" class="fill-gray-50" />
        <rect x="66.5" y="61" width="60" height="6" rx="3" fill="currentColor" class="fill-gray-50" />
        <rect x="66.5" y="73" width="77" height="6" rx="3" fill="currentColor" class="fill-gray-50" />
        <rect x="19.5" y="28.5" width="139" height="39" rx="7.5" fill="currentColor" class="fill-white" />
        <rect x="19.5" y="28.5" width="139" height="39" rx="7.5" stroke="currentColor" class="stroke-gray-100" />
        <rect x="27" y="36" width="24" height="24" rx="4" fill="currentColor" class="fill-gray-100" />
        <rect x="59" y="39" width="60" height="6" rx="3" fill="currentColor" class="fill-gray-100" />
        <rect x="59" y="51" width="92" height="6" rx="3" fill="currentColor" class="fill-gray-100" />
        <g filter="url(#filterPromptEmpty)">
          <rect x="12" y="6" width="154" height="40" rx="8" fill="currentColor" class="fill-white"
            shape-rendering="crispEdges" />
          <rect x="12.5" y="6.5" width="153" height="39" rx="7.5" stroke="currentColor" class="stroke-gray-100"
            shape-rendering="crispEdges" />
          <rect x="20" y="14" width="24" height="24" rx="4" fill="currentColor" class="fill-gray-200" />
          <rect x="52" y="17" width="60" height="6" rx="3" fill="currentColor" class="fill-gray-200" />
          <rect x="52" y="29" width="106" height="6" rx="3" fill="currentColor" class="fill-gray-200" />
        </g>
        <defs>
          <filter id="filterPromptEmpty" x="0" y="0" width="178" height="64" filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB">
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha" />
            <feOffset dy="6" />
            <feGaussianBlur stdDeviation="6" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.03 0" />
            <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_1187_14810" />
            <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1187_14810" result="shape" />
          </filter>
        </defs>
      </svg>

      <div class="max-w-sm mx-auto">
        <p class="mt-2 font-medium text-gray-800 dark:text-neutral-200">
          No prompts found.
        </p>
        <p class="mb-5 text-sm text-gray-500 dark:text-neutral-400">
          <template x-if="filters.usageType !== 'all' || filters.aiType !== 'all' || filters.riskLevel !== 'all'">
            <span>Try adjusting your filters or <button type="button" @click="clearAllFilters()"
                class="text-blue-600 hover:text-blue-700 underline dark:text-blue-400 dark:hover:text-blue-300">clear
                filters</button>.</span>
          </template>
          <template x-if="filters.usageType === 'all' && filters.aiType === 'all' && filters.riskLevel === 'all'">
            <span>There are no prompts to display at this time.</span>
          </template>
        </p>
      </div>
    </div>

    <!-- Prompt Cards -->
    <template x-for="prompt in filteredPrompts" :key="prompt.id">
      <div class="bg-white border rounded-lg p-4 dark:bg-neutral-800 dark:border-neutral-700"
        :class="prompt.classification === 'non-academic' ? 'border-l-4 border-l-red-500 dark:border-l-red-500' : 'border-gray-200'">
        <div class="space-y-3">
          <div class="flex items-start justify-between gap-3">
            <div class="flex items-center gap-2 flex-1 min-w-0">
              <div class="p-2 rounded-lg flex-shrink-0"
                :class="prompt.aiType === 'doubts' || prompt.aiType === 'ai' ? 'bg-blue-100 dark:bg-blue-900/20' : 'bg-purple-100 dark:bg-purple-900/20'">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"
                  :class="prompt.aiType === 'doubts' || prompt.aiType === 'ai' ? 'text-blue-600 dark:text-blue-400' : 'text-purple-600 dark:text-purple-400'">
                  <path x-show="prompt.aiType === 'pdf'" d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z">
                  </path>
                  <path x-show="prompt.aiType === 'pdf'" d="M14 2v4a2 2 0 0 0 2 2h4"></path>
                  <path x-show="prompt.aiType === 'pdf'" d="M10 9H8"></path>
                  <path x-show="prompt.aiType === 'pdf'" d="M16 13H8"></path>
                  <path x-show="prompt.aiType === 'pdf'" d="M16 17H8"></path>
                  <path x-show="prompt.aiType !== 'pdf'"
                    d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                </svg>
              </div>
              <div class="flex items-center gap-2 flex-wrap">
                <span class="inline-flex items-center justify-center rounded-md px-2 py-0.5 text-xs font-medium border"
                  :class="{
                    'bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800': prompt.classification === 'academic',
                    'bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-300 dark:border-red-800': prompt.classification === 'non-academic'
                  }" x-text="prompt.classification === 'academic' ? 'Academic' : 'Non-Academic'"></span>
                <span x-show="prompt.classification === 'non-academic'"
                  class="inline-flex items-center justify-center rounded-md px-2 py-0.5 text-xs font-medium border"
                  :class="{
                    'bg-green-100 text-green-700 border-green-200 dark:bg-green-900/20 dark:text-green-300 dark:border-green-800': prompt.riskLevel === 'low',
                    'bg-yellow-100 text-yellow-700 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-300 dark:border-yellow-800': prompt.riskLevel === 'medium',
                    'bg-orange-100 text-orange-700 border-orange-200 dark:bg-orange-900/20 dark:text-orange-300 dark:border-orange-800': prompt.riskLevel === 'high',
                    'bg-red-100 text-red-700 border-red-200 dark:bg-red-900/20 dark:text-red-300 dark:border-red-800': prompt.riskLevel === 'critical'
                  }" x-text="prompt.riskLevel.charAt(0).toUpperCase() + prompt.riskLevel.slice(1) + ' Risk'"></span>
                <span
                  class="inline-flex items-center justify-center rounded-md border border-gray-200 px-2 py-0.5 text-xs font-medium text-gray-800 dark:text-neutral-200 dark:border-neutral-700"
                  x-text="prompt.aiTypeLabel"></span>
              </div>
            </div>
            <div class="flex items-center gap-2 flex-shrink-0">
              <span class="text-xs text-gray-500 dark:text-neutral-400"
                x-text="prompt.date.split(',')[0] + ', ' + prompt.time"></span>
              <span class="text-xs text-gray-400 dark:text-neutral-500">â€¢</span>
              <span class="text-xs text-gray-500 dark:text-neutral-400"
                x-text="prompt.tokens.toLocaleString() + ' tokens'"></span>
            </div>
          </div>
          <div>
            <p class="text-xs font-medium text-gray-500 dark:text-neutral-400 mb-1">Student Question:</p>
            <p class="text-sm text-gray-900 dark:text-neutral-200" x-text="prompt.promptText"></p>
          </div>
          <div>
            <p class="text-xs font-medium text-gray-500 dark:text-neutral-400 mb-1">AI Response:</p>
            <p class="text-sm text-gray-700 dark:text-neutral-300 whitespace-pre-line" x-text="prompt.aiResponse"></p>
          </div>
          <div class="flex items-center gap-2 pt-2 border-t border-gray-200 dark:border-neutral-700">
            <button type="button" x-show="prompt.classification === 'non-academic'" @click="markAcademic(prompt.id)"
              class="inline-flex items-center justify-center gap-x-1.5 px-3 py-2 text-xs font-medium rounded-lg border border-gray-200 bg-white text-gray-800 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 dark:bg-neutral-800 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-700">
              <svg class="shrink-0 size-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20 6 9 17l-5-5"></path>
              </svg>
              Mark Academic
            </button>
            <button type="button" x-show="prompt.classification === 'academic'" @click="markNonAcademic(prompt.id)"
              class="inline-flex items-center justify-center gap-x-1.5 px-3 py-2 text-xs font-medium rounded-lg border border-gray-200 bg-white text-red-600 shadow-sm hover:bg-gray-50 hover:text-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 dark:bg-neutral-800 dark:border-neutral-700 dark:text-red-400 dark:hover:bg-neutral-700">
              <svg class="shrink-0 size-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 6 6 18"></path>
                <path d="m6 6 12 12"></path>
              </svg>
              Mark Non-Academic
            </button>
          </div>
        </div>
      </div>
    </template>
  </div>
</div>

<script>
  function promptsComponent() {
    return {
      filters: {
        usageType: 'all',
        aiType: 'all',
        riskLevel: 'all'
      },
      prompts: [
        {
          id: 1,
          promptText: 'Explain the process of photosynthesis in C4 plants and how it differs from C3 plants.',
          aiResponse: 'C4 photosynthesis is an adaptation found in certain plants to minimize photorespiration. In C4 plants, carbon dioxide is first fixed into a four-carbon compound (hence C4) in mesophyll cells using PEP carboxylase enzyme. This compound is then transported to bundle sheath cells where it releases CO2 for the Calvin cycle. This is different from C3 plants where CO2 is directly fixed in mesophyll cells using RuBisCO enzyme. C4 plants are more efficient in hot, dry conditions because they can maintain photosynthesis even when stomata are partially closed.',
          classification: 'academic',
          source: 'auto',
          aiType: 'doubts',
          aiTypeLabel: 'Doubts AI',
          riskLevel: 'low',
          type: null,
          typeLabel: null,
          tokens: 580,
          time: '9:16 AM',
          date: 'Jan 12, 2026'
        },
        {
          id: 2,
          promptText: 'What is Kranz anatomy?',
          aiResponse: 'Kranz anatomy is a specialized leaf structure found in C4 plants. The term \'Kranz\' means \'wreath\' in German, referring to the characteristic arrangement of cells. In Kranz anatomy, the vascular bundles are surrounded by two layers of cells: an inner layer of bundle sheath cells and an outer layer of mesophyll cells. The bundle sheath cells are large, thick-walled, and contain many chloroplasts. This anatomical arrangement is crucial for the C4 pathway to function efficiently.',
          classification: 'academic',
          source: 'auto',
          aiType: 'doubts',
          aiTypeLabel: 'Doubts AI',
          riskLevel: 'low',
          type: null,
          typeLabel: null,
          tokens: 420,
          time: '9:24 AM',
          date: 'Jan 12, 2026'
        },
        {
          id: 3,
          promptText: 'Tell me the plot of the latest Marvel movie',
          aiResponse: 'I\'m designed to help with academic questions related to your NEET preparation and coursework. I can\'t provide entertainment content. Do you have any biology, chemistry, or physics questions I can help with?',
          classification: 'non-academic',
          source: 'auto',
          aiType: 'doubts',
          aiTypeLabel: 'Doubts AI',
          riskLevel: 'critical',
          type: 'entertainment',
          typeLabel: 'Entertainment',
          tokens: 180,
          time: '8:32 PM',
          date: 'Jan 11, 2026'
        },
        {
          id: 4,
          promptText: 'Explain the difference between mitosis and meiosis',
          aiResponse: 'Mitosis and meiosis are both types of cell division, but they serve different purposes:\n\nMitosis:\n- Produces 2 daughter cells\n- Daughter cells are genetically identical to parent\n- Chromosome number remains same (diploid to diploid)\n- Occurs in somatic cells\n- One division cycle\n- Purpose: growth and repair\n\nMeiosis:\n- Produces 4 daughter cells\n- Daughter cells are genetically different\n- Chromosome number is halved (diploid to haploid)\n- Occurs in germ cells\n- Two division cycles (Meiosis I and II)\n- Purpose: sexual reproduction',
          classification: 'academic',
          source: 'auto',
          aiType: 'pdf',
          aiTypeLabel: 'PDF AI',
          riskLevel: 'low',
          type: null,
          typeLabel: null,
          tokens: 650,
          time: '2:48 PM',
          date: 'Jan 12, 2026'
        },
        {
          id: 5,
          promptText: 'Write me a funny story about a superhero who can\'t fly',
          aiResponse: 'I\'m here to assist with your academic studies. Let\'s focus on your NEET preparation. Do you have any questions about biology, physics, or chemistry?',
          classification: 'non-academic',
          source: 'auto',
          aiType: 'doubts',
          aiTypeLabel: 'Doubts AI',
          riskLevel: 'high',
          type: 'mild-non-academic',
          typeLabel: 'Time Wasting',
          tokens: 150,
          time: '8:45 PM',
          date: 'Jan 11, 2026'
        }
      ],
      init() {
        // Initialize Preline Select2 after Alpine renders
        this.$nextTick(() => {
          if (typeof HSStaticMethods !== 'undefined') {
            HSStaticMethods.autoInit();
          }
        });
      },
      get filteredPrompts() {
        return this.prompts.filter(prompt => {
          if (this.filters.usageType !== 'all' && this.filters.usageType === 'academic' && prompt.classification !== 'academic') return false;
          if (this.filters.usageType !== 'all' && this.filters.usageType === 'non-academic' && prompt.classification !== 'non-academic') return false;
          if (this.filters.aiType !== 'all' && prompt.aiType !== this.filters.aiType) return false;
          if (this.filters.riskLevel !== 'all' && prompt.riskLevel !== this.filters.riskLevel) return false;
          return true;
        });
      },
      applyFilters() {
        // Filters are reactive, no need for explicit action
        // Re-initialize Select2 to ensure proper display
        this.$nextTick(() => {
          if (typeof HSStaticMethods !== 'undefined') {
            HSStaticMethods.autoInit();
          }
        });
      },
      clearAllFilters() {
        this.filters.usageType = 'all';
        this.filters.aiType = 'all';
        this.filters.riskLevel = 'all';
        // Re-initialize Select2 after clearing to update the display
        this.$nextTick(() => {
          if (typeof HSStaticMethods !== 'undefined') {
            HSStaticMethods.autoInit();
          }
        });
      },
      markAcademic(promptId) {
        const prompt = this.prompts.find(p => p.id === promptId);
        if (prompt) {
          prompt.classification = 'academic';
          prompt.source = 'manual';
        }
      },
      markNonAcademic(promptId) {
        const prompt = this.prompts.find(p => p.id === promptId);
        if (prompt) {
          prompt.classification = 'non-academic';
          prompt.source = 'manual';
        }
      }
    };
  }
</script>