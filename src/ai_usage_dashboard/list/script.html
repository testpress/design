<script src="https://preline.co/pro/assets/vendor/lodash/lodash.min.js"></script>
<script src="https://preline.co/pro/assets/vendor/apexcharts/dist/apexcharts.min.js"></script>
<script src="https://preline.co/pro/assets/js/hs-apexcharts-helpers.js"></script>

<script>
  window.addEventListener('load', () => {
    // Apex Stacked Column Chart
    (function () {
      window.chartInstance = buildChart('#hs-pro-iresscch', (mode) => ({
        chart: {
          type: 'bar',
          height: 240,
          stacked: true,
          toolbar: {
            show: false
          },
          zoom: {
            enabled: false
          }
        },
        series: [
          {
            name: 'Academic',
            data: [120, 135, 145, 130, 150, 140, 160, 125]
          },
          {
            name: 'Mild Non-Academic',
            data: [12, 15, 18, 14, 16, 15, 20, 12]
          },
          {
            name: 'Entertainment',
            data: [8, 10, 12, 9, 11, 10, 15, 8]
          },
          {
            name: 'Serious Misuse',
            data: [3, 5, 4, 6, 4, 5, 7, 3]
          }
        ],
        colors: [
          '#10b981', // Green - Academic
          '#f59e0b', // Yellow/Amber - Mild Non-Academic
          '#f97316', // Orange - Entertainment
          '#ef4444'  // Red - Serious Misuse
        ],
        plotOptions: {
          bar: {
            horizontal: false,
            columnWidth: '50%',
            borderRadius: 3,
          }
        },
        legend: {
          show: false
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          show: true,
          width: 0,
          colors: ['transparent']
        },
        xaxis: {
          categories: [
            '25 July',
            '26 July',
            '27 July',
            '28 July',
            '29 July',
            '30 July',
            '31 July',
            '1 June'
          ],
          axisBorder: {
            show: false
          },
          axisTicks: {
            show: false
          },
          crosshairs: {
            show: false
          },
          labels: {
            style: {
              colors: 'oklch(0.707 0.022 261.325)',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
          }
        },
        yaxis: {
          labels: {
            align: 'left',
            minWidth: 0,
            maxWidth: 140,
            style: {
              colors: 'oklch(0.707 0.022 261.325)',
              fontSize: '13px',
              fontFamily: 'Inter, ui-sans-serif',
              fontWeight: 400
            },
            formatter: (value) => value >= 1000 ? `${value / 1000}k` : value
          }
        },
        tooltip: {
          custom: function (props) {
            const { categories } = props.ctx.opts.xaxis;
            const { dataPointIndex } = props;

            return buildTooltip(props, {
              title: categories[dataPointIndex],
              mode,
              valuePrefix: '',
              hasCategory: false,
              hasTextLabel: true,
              wrapperExtClasses: 'min-w-28',
              labelDivider: ':',
              labelExtClasses: 'ms-2'
            });
          }
        },
        states: {
          hover: {
            filter: {
              type: 'darken',
              value: 0.9
            }
          }
        },
      }), {
        colors: [
          '#10b981', // Emerald - Academic
          '#f59e0b', // Amber - Mild Non-Academic
          '#f97316', // Orange - Entertainment
          '#dc2626'  // Red-600 - Serious Misuse (softer red)
        ],
        grid: {
          borderColor: 'oklch(0.928 0.006 264.531)'
        },
        xaxis: {
          labels: {
            style: {
              colors: 'oklch(0.707 0.022 261.325)'
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: 'oklch(0.707 0.022 261.325)'
            }
          }
        }
      }, {
        grid: {
          borderColor: 'oklch(0.371 0 0)'
        },
        xaxis: {
          labels: {
            style: {
              colors: 'oklch(0.556 0 0)',
            }
          }
        },
        yaxis: {
          labels: {
            style: {
              colors: 'oklch(0.556 0 0)'
            }
          }
        }
      });
    })();
  });

  // Toggle series visibility on legend click
  function toggleSeries(seriesName) {
    if (window.chartInstance) {
      const seriesIndex = {
        'Academic': 0,
        'Mild Non-Academic': 1,
        'Entertainment': 2,
        'Serious Misuse': 3
      }[seriesName];

      if (seriesIndex !== undefined) {
        window.chartInstance.toggleSeries(seriesName);

        // Toggle legend opacity
        const legendId = {
          'Academic': 'legend-academic',
          'Mild Non-Academic': 'legend-mild',
          'Entertainment': 'legend-entertainment',
          'Serious Misuse': 'legend-serious'
        }[seriesName];

        const legendElement = document.getElementById(legendId);
        if (legendElement) {
          const currentOpacity = legendElement.style.opacity;
          legendElement.style.opacity = currentOpacity === '0.3' ? '1' : '0.3';
        }
      }
    }
  }
</script>