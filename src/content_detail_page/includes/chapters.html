{% for chapter in chapters %}
  <li>
    <a href="#" @click="expanded['chapter_{{ loop.index0 }}'] = !expanded['chapter_{{ loop.index0 }}']" class="text-gray-700 hover:text-emerald-600 group flex justify-between items-center gap-x-3 p-2 text-base leading-6 font-semibold border-t pt-4">
      {{ chapter.title }}
      <!-- SVG Icon -->
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" :class="{ '-rotate-180': expanded['chapter_{{ loop.index0 }}'] }" class="w-5 h-5 transition-transform duration-300 transform">
        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
      </svg>
    </a>
    <ul x-show="expanded['chapter_{{ loop.index0 }}']" x-collapse role="list" class="divide-y divide-gray-100 ml-2">
      {% if chapter.subchapters %} 
        {% for subchapter in chapter.subchapters %}
          <li>
            <a href="#" @click="expanded['subchapter_{{ loop.index0 }}'] = !expanded['subchapter_{{ loop.index0 }}']" class="text-gray-700 hover:text-emerald-600 group flex justify-between items-center gap-x-3 p-2 text-base leading-6 font-semibold border-t pt-4">
              {{ subchapter.name }}
              <!-- SVG Icon -->
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" :class="{ '-rotate-180': expanded['subchapter_{{ loop.index0 }}'] }" class="w-5 h-5 transition-transform duration-300 transform">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
              </svg>
            </a>
          </li>
          <ul x-show="expanded['subchapter_{{ loop.index0 }}']" x-collapse role="list" class="divide-y divide-gray-100 ml-2">
            {% if subchapter.nestedsubchapter %}
              {% for nestedsubchapter in subchapter.nestedsubchapter %}
              <li>
                <a href="#" @click="expanded['nestedsubchapter_{{ loop.index0 }}'] = !expanded['nestedsubchapter_{{ loop.index0 }}']" class="text-gray-700 hover:text-emerald-600 group flex justify-between items-center gap-x-3 p-2 text-base leading-6 font-semibold border-t pt-4">
                  {{ nestedsubchapter.name }}
                  <!-- SVG Icon -->
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" :class="{ '-rotate-180': expanded['nestedsubchapter_{{ loop.index0 }}'] }" class="w-5 h-5 transition-transform duration-300 transform">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5" />
                  </svg>
                </a>
              </li>
              <ul x-show="expanded['nestedsubchapter_{{ loop.index0 }}']" x-collapse role="list" class="divide-y divide-gray-100 ml-2">
                {% for content in nestedsubchapter.contents %}
                  {% include "./content.html" %}
                {% endfor %}
              </ul>
              {% endfor %}
            {% else %}
              {% for content in subchapter.contents %}
                {% include "./content.html" %}
              {% endfor %}
            {% endif %}
          </ul>
        {% endfor %}
      {% else %}
        {% for content in chapter.contents %}
          {% include "./content.html" %}
        {% endfor %}
      {% endif %}
    </ul>
  </li>              
{% endfor %}