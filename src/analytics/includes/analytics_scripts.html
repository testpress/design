<script>
  tailwind.config = {
    theme: {
      extend: {
        fontFamily: {
          sans: ['Inter var',],
        },
      }
    }
  }

  function getAnalyticsData() {
    return {
      allStats: JSON.parse(`{% include "../../_data/subject_analytics.json" %}`),
      filteredStats: [],
      breadcrumbSubjects: [],

      filterByParentId(parentId) {
        if (!parentId) {
          this.filteredStats = this.allStats.filter(item => item.parent_id == null);
        }
        else {
          this.filteredStats = this.allStats.filter(item => item.parent_id == parentId);
        }
      },

      parentSubjectChanged(parentId) {
        this.filterByParentId(parentId);
        this.updateBreadcrumbs(parentId);
      },

      updateBreadcrumbs(parentId) {
        if(!parentId) {
          this.breadcrumbSubjects = [];
          return;
        }

        let breadcrumbSubjectsIds = this.breadcrumbSubjects.map(subject => subject.id);
        if (breadcrumbSubjectsIds.includes(parentId)) {
          this.breadcrumbSubjects = this.breadcrumbSubjects.slice(0, breadcrumbSubjectsIds.indexOf(parentId) + 1);
        }
        else {
          let parentSubject = this.allStats.filter(item => item.id == parentId)[0];
          this.breadcrumbSubjects.push({"name": parentSubject.subject, "id": parentSubject.id});
        }
      }
    }
  }
</script>
