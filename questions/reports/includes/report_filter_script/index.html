<script>
  function report_filter_components(){
    return {
      showFilterReport:false,
      showMobileFilterReport:false,
      exams : JSON.parse('[{"id":1,"name":"Dinesh","profile_image":"https://static.testpress.in/static/img/default_small_image.png","rank":1,"first_attempt_correct":"14","first_attempt_incorrect":"4","first_attempt_trophies":"55","first_attempt_score":"52","attempts":[{"id":1,"date":"12 Sep, 2023","score":"10.00","correct":"4","incorrect":"2","trophies":"55"},{"id":2,"date":"11 Sep, 2023","score":"11.00","correct":"5","incorrect":"1","trophies":"5"},{"id":3,"date":"09 Sep, 2023","score":"20.00","correct":"7","incorrect":"3","trophies":"0"},{"id":4,"date":"07 Sep, 2023","score":"30.00","correct":"14","incorrect":"7","trophies":"0"},{"id":5,"date":"01 Sep, 2023","score":"5.00","correct":"4","incorrect":"3","trophies":"0"},{"id":1,"date":"01 Sep, 2023","score":"0.00","correct":"4","incorrect":"4","trophies":"0"}]},{"id":2,"name":"Kumar","profile_image":"https://static.testpress.in/static/img/default_small_image.png","rank":2,"first_attempt_correct":"10","first_attempt_incorrect":"4","first_attempt_trophies":"35","first_attempt_score":"42","attempts":[]},{"id":3,"name":"Shanmugam","profile_image":"https://static.testpress.in/static/img/default_small_image.png","rank":3,"first_attempt_correct":"11","first_attempt_incorrect":"8","first_attempt_trophies":"15","first_attempt_score":"4","attempts":[]},{"id":4,"name":"Anil","profile_image":"https://static.testpress.in/static/img/default_small_image.png","rank":4,"first_attempt_correct":"6","first_attempt_incorrect":"1","first_attempt_trophies":"12","first_attempt_score":"14","attempts":[]},{"id":5,"name":"Vimal","profile_image":"https://static.testpress.in/static/img/default_small_image.png","rank":5,"first_attempt_correct":"1","first_attempt_incorrect":"0","first_attempt_trophies":"5","first_attempt_score":"4","attempts":[]}]'),
      subjects : JSON.parse('[{"id":1,"name":"Physics","parent":null},{"id":2,"name":"Chemistry","parent":null},{"id":3,"name":"Math","parent":null},{"id":4,"name":"Computer Science","parent":null},{"id":5,"name":"English","parent":null},{"id":6,"name":"Tamil","parent":null},{"id":7,"name":"Hindi","parent":null}]'),
      chapters : JSON.parse('[{"id":1,"title":"Current Affairs 2023","subchapters":[{"id":1,"name":"Jan","contents":[{"id":1,"name":"JAN 1st week CA","type":"VIDEO"},{"id":2,"name":"Jan 1st week One liners","type":"ATTACHMENT"},{"id":3,"name":"Jan 1st week CA 2022","type":"PDF"}]},{"id":2,"name":"Feb","nestedsubchapter":[{"id":1,"name":"Day 1","contents":[{"id":1,"name":"Feb 1st week Current Affairs","type":"VIDEO"},{"id":2,"name":"Bank Feb 1st Week CA - 2023","type":"ATTACHMENT"},{"id":3,"name":"Feb 2nd  week Current Affairs","type":"PDF"}]},{"id":2,"name":"Day 2","contents":[{"id":1,"name":"Bank Feb 2nd Week CA - 2023","type":"VIDEO"},{"id":2,"name":"Feb 3rd week Current Affairs","type":"ATTACHMENT"},{"id":3,"name":"Bank Feb 3rd Week CA - 2023","type":"PDF"}]}]}]},{"id":2,"title":"BOI 2023","contents":[{"id":1,"name":"BOI Set 1 - 2023","type":"NOTES"},{"id":2,"name":"BOI Set 2 - 2023","type":"ZOOM"},{"id":3,"name":"BOI Set 3 - 2023","type":"EXAM"}]},{"id":3,"title":"Current Affairs 2022","contents":[{"id":1,"name":"JAN 1st week CA","type":"VIDEO"},{"id":2,"name":"Jan 1st week One liners","type":"ZOOM"},{"id":3,"name":"Jan 1st week CA 2022","type":"EXAM"}]},{"id":4,"title":"Bank Extreme Circle - October 2022","subchapters":[{"id":1,"name":"EXTREME CIRCLE","contents":[{"id":1,"name":"DAY 1 EXTREME CIRCLE - RATIO & PROPORTION SET - 1","type":"VIDEO"},{"id":2,"name":"DAY 1 EXTREME CIRCLE - RATIO & PROPORTION SET - 2","type":"ATTACHMENT"},{"id":3,"name":"DAY 1 EXTREME CIRCLE - RATIO & PROPORTION SET - 3","type":"PDF"},{"id":4,"name":"DAY 1 EXTREME CIRCLE - RATIO & PROPORTION SET - 4","type":"ZOOM"},{"id":5,"name":"DAY 1 EXTREME CIRCLE - RATIO & PROPORTION SET - 5","type":"EXAM"}]},{"id":2,"name":"SBI PO Prelims 2022","nestedsubchapter":[{"id":1,"name":"Day 1","contents":[{"id":1,"name":"SBI PO Prelims 1 - 2022","type":"VIDEO"},{"id":2,"name":"SBI PO Prelims 2 - 2022","type":"ATTACHMENT"},{"id":3,"name":"SBI PO Prelims 3 - 2022","type":"PDF"},{"id":4,"name":"SBI PO Prelims 4 - 2022","type":"PDF"},{"id":5,"name":"SBI PO Prelims 5 - 2022","type":"PDF"}]},{"id":2,"name":"Day 2","contents":[{"id":1,"name":"SBI PO Prelims 6 - 2022","type":"VIDEO"},{"id":2,"name":"SBI PO Prelims 7 - 2022","type":"ATTACHMENT"},{"id":3,"name":"SBI PO Prelims 8 - 2022","type":"PDF"}]}]}]},{"id":5,"title":"Pooja Test","contents":[{"id":1,"name":"Pooja Workout Test 1 - 2022","type":"NOTES"},{"id":2,"name":"Pooja Workout Test 2 - 2022","type":"ZOOM"},{"id":3,"name":"Pooja Workout Test 3 - 2022","type":"EXAM"},{"id":4,"name":"Pooja Workout Test 4 - 2022","type":"VIDEO"},{"id":5,"name":"Pooja Workout Test 4 - 2022","type":"PDF"}]}]'),
      selected_filters:[],
      showExamFilter:false,
      showChapterFilter:false,
      showSubjectFilter:false,
      active_filters:null,

      filterQuestionReport(key,value){
        const currentUrl = new URL(window.location);
        const searchParams = new URLSearchParams(currentUrl.search);
        searchParams.set(key, value);
        currentUrl.search = searchParams.toString();
        window.location.href = currentUrl.href;
      },
      
    initialize_selected_filter() {
      const searchParams = new URLSearchParams(window.location.search);

      for (let [key, value] of searchParams) {
        let filterItem;
        let type;
        this.active_filters = Array.from(searchParams.entries()).length;

        switch(key) {
          case 'exam':
            filterItem = this.exams.find(item => item.id === parseInt(value));
            type = 'exam';
            break;
          case 'subject':
            filterItem = this.subjects.find(item => item.id === parseInt(value));
            type = 'subject';
            break;
          case 'chapter':
            filterItem = this.chapters.find(item => item.id === parseInt(value));
            type = 'chapter';
            break;
        }
        if (filterItem) {
          filterItem.type = type;
          this.selected_filters.push(filterItem);
        }
      }
    },


      isItemSelected(item,type) {
        return this.selected_filters.some(e => e.id === item.id && e.type === type);
      },

      addToSelectedFilter(filter,type){
        if (this.isItemSelected(filter,type)){
          return
        }
        filter.type = type;
        this.selected_filters.push(filter)
      },

      removeSelectedFilter(filter) {
       this.selected_filters = this.selected_filters.filter(item => item.id !== filter.id || item.type !== filter.type);
    },

    submitReportFilter(){
      const params = this.selected_filters.map(filter => `${filter.type}=${filter.id}`).join('&');
      window.location.href = `${window.location.origin}${window.location.pathname}?${params}`;
    },

    getSearchParameterValue() {
    const searchParams = new URLSearchParams(window.location.search);
    for (let [key, value] of searchParams) {
        if (key) {
            return value;
        }
    }
    return ;
  }
    }
  }
</script>
